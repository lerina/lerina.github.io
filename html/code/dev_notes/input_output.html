<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>input_output input_output</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://lerina.github.io/css/styles_min.css" />
</head>
<body>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#input-output">Input / Output</a>
<ul>
<li><a href="#consoleterminal-user-input">Console/Terminal User input</a>
<ul>
<li><a href="#from-prompt">from prompt</a></li>
<li><a href="#from-env">from env</a></li>
</ul></li>
<li><a href="#display-trait">Display trait</a></li>
<li><a href="#write-string-to-file">Write String to File</a>
<ul>
<li><a href="#write-all-data-to-a-file-at-once">1. Write all data to a file at once</a></li>
<li><a href="#write-all-data-to-a-file-at-once-with-fsfile-write_all">2. Write all data to a file at once with fs::File &amp; write_all</a></li>
<li><a href="#fsopenoptions-builder">3. fs::OpenOptions builder</a></li>
<li><a href="#write-and-append-data-to-a-file-with-bufwriter">4. Write and Append data to a file with BufWriter</a></li>
</ul></li>
<li><a href="#read-file">Read File</a>
<ul>
<li><a href="#read-whole-file-into-string.">1. read whole file into String.</a></li>
<li><a href="#read-whole-file-into-vec-then-convert-string.">2. read whole file into Vec<u8> then convert string.</a></li>
<li><a href="#read-file-line-by-line-in-to-a-vec">3. read file line by line in to a Vec<String></a></li>
<li><a href="#read-file-byte-by-byte-in-to-a-vec">4. read file byte by byte in to a Vec<u8></a></li>
<li><a href="#read-file-byte-chunks-by-byte-chunk-in-to-an-array-u8">5. read file byte chunks by byte chunk in to an array [u8]</a></li>
<li><a href="#write-file-everything-together">Write File: Everything together</a></li>
<li><a href="#read-file-everything-together">Read File: Everything together</a></li>
</ul></li>
<li><a href="#removing-a-file-in-rust">Removing a File in Rust</a></li>
<li><a href="#serde">Serde</a>
<ul>
<li><a href="#using-derive">Using derive</a></li>
</ul></li>
<li><a href="#replacing-command-line-curl-with-rust-reqwest-tokio">Replacing command-line <code>curl</code> with Rust <code>reqwest</code> &amp; <code>tokio</code></a></li>
</ul></li>
</ul>
</nav>
<div class="navbar">
<a class="openbtn" onclick="openNav()">☰</a>
</div>
<main>
<p>⇦ <a href="../../../index.html">lerina.github.io</a> - <a href="../index.html">code</a></p>
<h1 id="input-output">Input / Output</h1>
<h2 id="consoleterminal-user-input">Console/Terminal User input</h2>
<h3 id="from-prompt">from prompt</h3>
<h4 id="iostdin.read_line">io::stdin().read_line</h4>
<p><strong>Struct std::io::Stdin</strong><br />
<em>A handle to the standard input stream of a process.</em></p>
<p><em>Each handle is a shared reference to a global buffer of input data to this process.</em></p>
<p><strong>Function std::io::stdin</strong><br />
<em>Constructs a new handle to the standard input of the current process.</em></p>
<p><em>Each handle returned is a reference to a shared global buffer whose access is synchronized via a mutex.</em></p>
<p><strong>io::stdin().read_line</strong><br />
<em>Locks this handle and reads a line of input, appending it to the specified buffer.</em></p>
<ul>
<li>Spike or example code</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>io<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> input <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>    <span class="kw">let</span> n <span class="op">=</span> <span class="pp">io::</span>stdin()<span class="op">.</span>read_line(<span class="op">&amp;</span><span class="kw">mut</span> input)<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;{} bytes read&quot;</span><span class="op">,</span> n)<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;{}&quot;</span><span class="op">,</span> input)<span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>Production code</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>io<span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> input <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>    <span class="kw">match</span> <span class="pp">io::</span>stdin()<span class="op">.</span>read_line(<span class="op">&amp;</span><span class="kw">mut</span> input) <span class="op">{</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>        <span class="cn">Ok</span>(n) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a>            <span class="pp">println!</span>(<span class="st">&quot;{} bytes read&quot;</span><span class="op">,</span> n)<span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>            <span class="pp">println!</span>(<span class="st">&quot;{}&quot;</span><span class="op">,</span> input)<span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>        <span class="cn">Err</span>(error) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;error: {error}&quot;</span>)<span class="op">,</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>Or</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>io<span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="kw">fn</span> main()<span class="op">{</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>    <span class="kw">let</span> input<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> get_input(<span class="st">&quot;Please type something...&quot;</span>)<span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;{}&quot;</span><span class="op">,</span>input)<span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="kw">fn</span> get_input(prompt<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">String</span><span class="op">{</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;{}&quot;</span><span class="op">,</span>prompt)<span class="op">;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> input <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a>    <span class="co">// io::stdin::().read_line(&amp;mut input)</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a>    <span class="co">//    .expect(&quot;error: unable to read user input&quot;);</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a>    <span class="kw">match</span> <span class="pp">io::</span>stdin()<span class="op">.</span>read_line(<span class="op">&amp;</span><span class="kw">mut</span> input) <span class="op">{</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a>        <span class="cn">Ok</span>(_data_is_in_input_above) <span class="op">=&gt;</span> <span class="op">{},</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a>        <span class="cn">Err</span>(_initial_empty_string_is_fine) <span class="op">=&gt;</span> <span class="op">{},</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true"></a>    input<span class="op">.</span>trim()<span class="op">.</span>to_string()</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p><a href="./dev_studies/input_output.html">more here</a></p>
<h3 id="from-env">from env</h3>
<p><strong>std::env</strong><br />
<em>This module contains functions to inspect various aspects such as environment variables, process arguments, the current directory, and various other important directories.</em></p>
<p><em>There are several functions and structs in this module that have a counterpart ending in os. Those ending in os will return an OsString and those without will return a String.</em></p>
<p><strong>env::args()</strong><br />
<em>Returns the arguments that this program was started with (normally passed via the command line).</em> <em>An iterator over the arguments of a process, yielding a String value for each argument.</em></p>
<p><em>The first element is traditionally the path of the executable</em>,<br />
but it can be set to arbitrary text, and might not even exist. This means this property should not be relied upon for security purposes.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>env<span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>    echo()<span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="kw">fn</span> echo() <span class="op">{</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>    <span class="kw">let</span> args<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">&gt;</span> <span class="op">=</span> <span class="pp">env::</span>args()<span class="op">.</span>collect()<span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;{args:?}&quot;</span>)<span class="op">;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p><strong>env::var</strong><br />
Fetches the environment variable key from the current process.</p>
<p>We can access shell variables such as <em>$HOME</em> with <code>var</code></p>
<p><strong>env!</strong><br />
Inspects an environment variable at compile time.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>env<span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>    </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>    <span class="kw">for</span> argument <span class="kw">in</span> <span class="pp">env::</span>args() <span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>        <span class="pp">println!</span>(<span class="st">&quot;{argument}&quot;</span>)<span class="op">;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>    <span class="kw">let</span> name <span class="op">=</span> <span class="st">&quot;USER&quot;</span><span class="op">;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a>    <span class="kw">match</span> <span class="pp">env::</span>var(name) <span class="op">{</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a>        <span class="cn">Ok</span>(v) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;{}: {}&quot;</span><span class="op">,</span> name<span class="op">,</span> v)<span class="op">,</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">panic!</span>(<span class="st">&quot;${} is not set ({})&quot;</span><span class="op">,</span> name<span class="op">,</span> e)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>    <span class="kw">let</span> shell <span class="op">=</span> <span class="pp">env!</span>(<span class="st">&quot;SHELL&quot;</span><span class="op">,</span> <span class="st">&quot;$SHELL is not set&quot;</span>)<span class="op">;</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;Shell is set to {}&quot;</span><span class="op">,</span> shell)<span class="op">;</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a>    <span class="kw">let</span> key <span class="op">=</span> <span class="st">&quot;RUST_BACKTRACE&quot;</span><span class="op">;</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a>        <span class="pp">env::</span>set_var(key<span class="op">,</span> <span class="st">&quot;1&quot;</span>)<span class="op">;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true"></a>    <span class="kw">match</span> <span class="pp">env::</span>current_dir() <span class="op">{</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true"></a>        <span class="cn">Ok</span>(path) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;The current directory is {}&quot;</span><span class="op">,</span> path<span class="op">.</span>display())<span class="op">,</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="ex">./env</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="ex">USER</span>: tac</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a><span class="ex">Shell</span> is set to /bin/bash</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a><span class="ex">The</span> current directory is /media/tac/Sikidy/Videos/Rs_Studies/io_Files/Display/Spike</span></code></pre></div>
<h2 id="display-trait">Display trait</h2>
<p><strong>fmt::Display</strong><br />
<em>Implementing this trait for a type will automatically implement the ToString trait for the type, allowing the usage of the .to_string() method. Prefer implementing the Display trait for a type, rather than ToString.</em></p>
<p><em>Display is similar to Debug, but Display is for user-facing output, and so cannot be derived.</em></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="co">// [source](https://doc.rust-lang.org/rust-by-example/hello/print/print_display.html)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fmt<span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a><span class="co">// Define a structure for which `fmt::Display` will be implemented. This is</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a><span class="co">// a tuple struct named `Structure` that contains an `i32`.</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a><span class="kw">struct</span> Structure(<span class="dt">i32</span>)<span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a><span class="co">// To use the `{}` marker, the trait `fmt::Display` must be implemented</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a><span class="co">// manually for the type.</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a><span class="kw">impl</span> <span class="pp">fmt::</span><span class="bu">Display</span> <span class="kw">for</span> Structure <span class="op">{</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a>    <span class="co">// This trait requires `fmt` with this exact signature.</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true"></a>    <span class="kw">fn</span> fmt(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> f<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> <span class="pp">fmt::</span>Formatter) <span class="op">-&gt;</span> <span class="pp">fmt::</span><span class="dt">Result</span> <span class="op">{</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true"></a>        <span class="co">// Write strictly the first element into the supplied output</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true"></a>        <span class="co">// stream: `f`. Returns `fmt::Result` which indicates whether the</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true"></a>        <span class="co">// operation succeeded or failed. Note that `write!` uses syntax which</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true"></a>        <span class="co">// is very similar to `println!`.</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true"></a>        <span class="pp">write!</span>(f<span class="op">,</span> <span class="st">&quot;{}&quot;</span><span class="op">,</span> <span class="kw">self</span><span class="op">.</span><span class="dv">0</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Debug</span><span class="at">)]</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true"></a><span class="kw">struct</span> MinMax(<span class="dt">i64</span><span class="op">,</span> <span class="dt">i64</span>)<span class="op">;</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true"></a><span class="kw">impl</span> <span class="pp">fmt::</span><span class="bu">Display</span> <span class="kw">for</span> MinMax <span class="op">{</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true"></a>    <span class="kw">fn</span> fmt(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> f<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> <span class="pp">fmt::</span>Formatter) <span class="op">-&gt;</span> <span class="pp">fmt::</span><span class="dt">Result</span> <span class="op">{</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true"></a>        <span class="co">// Use `self.number` to refer to each positional data point.</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true"></a>        <span class="pp">write!</span>(f<span class="op">,</span> <span class="st">&quot;({}, {})&quot;</span><span class="op">,</span> <span class="kw">self</span><span class="op">.</span><span class="dv">0</span><span class="op">,</span> <span class="kw">self</span><span class="op">.</span><span class="dv">1</span>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true"></a><span class="co">// Define a structure where the fields are nameable for comparison.</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Debug</span><span class="at">)]</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true"></a><span class="kw">struct</span> Point2D <span class="op">{</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true"></a>    x<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true"></a>    y<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true"></a><span class="co">// Similarly, implement `Display` for `Point2D`.</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true"></a><span class="kw">impl</span> <span class="pp">fmt::</span><span class="bu">Display</span> <span class="kw">for</span> Point2D <span class="op">{</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true"></a>    <span class="kw">fn</span> fmt(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> f<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> <span class="pp">fmt::</span>Formatter) <span class="op">-&gt;</span> <span class="pp">fmt::</span><span class="dt">Result</span> <span class="op">{</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true"></a>        <span class="co">// Customize so only `x` and `y` are denoted.</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true"></a>        <span class="pp">write!</span>(f<span class="op">,</span> <span class="st">&quot;x: {}, y: {}&quot;</span><span class="op">,</span> <span class="kw">self</span><span class="op">.</span>x<span class="op">,</span> <span class="kw">self</span><span class="op">.</span>y)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true"></a><span class="co">// Decimal floating point number to binary is a draft programming task. </span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true"></a><span class="co">// It is not yet considered ready to be promoted as a complete task,</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true"></a><span class="co">// The output might be something like this:</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true"></a><span class="co">//</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true"></a><span class="co">//       23.34375  =&gt; 10111.01011</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true"></a><span class="co">//     1011.11101  =&gt;    11.90625</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true"></a><span class="kw">impl</span> <span class="pp">fmt::</span><span class="bu">Binary</span> <span class="kw">for</span> Point2D <span class="op">{</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true"></a>    <span class="kw">fn</span> fmt(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> f<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> <span class="pp">fmt::</span>Formatter<span class="op">&lt;</span><span class="ot">&#39;_</span><span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="pp">fmt::</span><span class="dt">Result</span> <span class="op">{</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true"></a>        <span class="kw">let</span> binding <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>x<span class="op">.</span>to_string()<span class="op">;</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true"></a>        <span class="kw">let</span>  x<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>_<span class="op">&gt;</span> <span class="op">=</span> binding<span class="op">.</span>split(<span class="st">&quot;.&quot;</span>)<span class="op">.</span>collect()<span class="op">;</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true"></a>        <span class="kw">let</span> x_left <span class="op">=</span> x[<span class="dv">0</span>]<span class="op">.</span><span class="pp">parse::</span><span class="op">&lt;</span><span class="dt">i32</span><span class="op">&gt;</span>()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true"></a>        <span class="kw">let</span> x_right <span class="op">=</span> x[<span class="dv">1</span>]<span class="op">.</span><span class="pp">parse::</span><span class="op">&lt;</span><span class="dt">i32</span><span class="op">&gt;</span>()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true"></a>        </span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true"></a>        <span class="kw">let</span> binding <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>y<span class="op">.</span>to_string()<span class="op">;</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true"></a>        <span class="kw">let</span>  y<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>_<span class="op">&gt;</span> <span class="op">=</span> binding<span class="op">.</span>split(<span class="st">&quot;.&quot;</span>)<span class="op">.</span>collect()<span class="op">;</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true"></a>        <span class="kw">let</span> y_left <span class="op">=</span> y[<span class="dv">0</span>]<span class="op">.</span><span class="pp">parse::</span><span class="op">&lt;</span><span class="dt">i32</span><span class="op">&gt;</span>()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true"></a>        <span class="kw">let</span> y_right <span class="op">=</span> y[<span class="dv">1</span>]<span class="op">.</span><span class="pp">parse::</span><span class="op">&lt;</span><span class="dt">i32</span><span class="op">&gt;</span>()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true"></a></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true"></a>        <span class="pp">write!</span>( f<span class="op">,</span> <span class="st">&quot;x: {:08b}.{:08b}, y: {:08b}.{:08b}&quot;</span><span class="op">,</span> x_left<span class="op">,</span> x_right<span class="op">,</span> y_left<span class="op">,</span> y_right)</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true"></a></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true"></a>    <span class="kw">let</span> minmax <span class="op">=</span> MinMax(<span class="dv">0</span><span class="op">,</span> <span class="dv">14</span>)<span class="op">;</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true"></a></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;Compare structures:&quot;</span>)<span class="op">;</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;Display: {}&quot;</span><span class="op">,</span> minmax)<span class="op">;</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;Debug: {:?}&quot;</span><span class="op">,</span> minmax)<span class="op">;</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true"></a></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true"></a>    <span class="kw">let</span> big_range <span class="op">=</span> MinMax(<span class="op">-</span><span class="dv">300</span><span class="op">,</span> <span class="dv">300</span>)<span class="op">;</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true"></a>    <span class="kw">let</span> small_range <span class="op">=</span> MinMax(<span class="op">-</span><span class="dv">3</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true"></a></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true"></a>    <span class="pp">println!</span>(</span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true"></a>        <span class="st">&quot;The big range is {big} and the small is {small}&quot;</span><span class="op">,</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true"></a>        small <span class="op">=</span> small_range<span class="op">,</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true"></a>        big <span class="op">=</span> big_range</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true"></a>    )<span class="op">;</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true"></a></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true"></a>    <span class="kw">let</span> point <span class="op">=</span> Point2D <span class="op">{</span> x<span class="op">:</span> <span class="dv">3.3</span><span class="op">,</span> y<span class="op">:</span> <span class="dv">7.2</span> <span class="op">};</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true"></a></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;Compare points:&quot;</span>)<span class="op">;</span></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;Display: {}&quot;</span><span class="op">,</span> point)<span class="op">;</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;Debug: {:?}&quot;</span><span class="op">,</span> point)<span class="op">;</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;Binary: {:b}&quot;</span><span class="op">,</span> point)<span class="op">;</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true"></a></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h2 id="write-string-to-file">Write String to File</h2>
<h3 id="write-all-data-to-a-file-at-once">1. Write all data to a file at once</h3>
<p><strong>fs::write</strong><br />
<em>Write a slice as the entire contents of a file.</em></p>
<p><em>This function will create a file if it does not exist, and will entirely replace its contents if it does.</em> <em>This is a convenience function for using File::create and write_all with fewer imports.</em></p>
<p><strong>as_bytes</strong><br />
<em>Converts a string slice to a byte slice. To convert the byte slice back into a string slice, use the from_utf8 function.</em></p>
<h4 id="data-as-str">1.1 data as &amp;str</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="bu">Write</span><span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a><span class="co">// 1. Write all data to a file at once</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a><span class="co">// 1.1 data as &amp;str</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a><span class="kw">fn</span> write_data_to_file(path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> data<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>    <span class="pp">fs::</span>write(<span class="op">&amp;</span>path<span class="op">,</span> <span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> <span class="st">&quot;</span><span class="sc">\</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true"></a><span class="st">He he he</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true"></a><span class="st">plenty data</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true"></a><span class="st"> </span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true"></a><span class="st">here.&quot;</span><span class="op">;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true"></a>    <span class="co">// 1.1. Write all data to a file at once</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true"></a>    <span class="kw">match</span> write_data_to_file(<span class="op">&amp;</span><span class="st">&quot;db_1.1.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data) <span class="op">{</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Write all data to a file at once&quot;</span>)<span class="op">,</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h4 id="data-as-u8">1.2 data as [u8]</h4>
<p>call with data.as_bytes() if its a &amp;str</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="bu">Write</span><span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a><span class="co">// 1.2 data as [u8] (call with  data.as_bytes() if its a &amp;str)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a><span class="kw">fn</span> write_data_to_file_as_bytes(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u8</span>]) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a><span class="op">{</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a>    <span class="pp">fs::</span>write(<span class="op">&amp;</span>path<span class="op">,</span> <span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> <span class="st">&quot;</span><span class="sc">\</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true"></a><span class="st">He he he</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true"></a><span class="st">plenty data</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true"></a><span class="st"> </span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true"></a><span class="st">here.&quot;</span><span class="op">;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true"></a>    <span class="co">// 1.2. Write all data to a file at once as *[u8]</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true"></a>    <span class="kw">match</span> write_data_to_file_as_bytes(<span class="op">&amp;</span><span class="st">&quot;db_1.2.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data<span class="op">.</span>as_bytes()) <span class="op">{</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Write all data to a file at once as *[u8]&quot;</span>)<span class="op">,</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h4 id="the-code-together">The code together</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="bu">Write</span><span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a><span class="co">// 1. Write all data to a file at once</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a><span class="co">// 1.1 data as &amp;str</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a><span class="kw">fn</span> write_data_to_file(path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> data<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a>    <span class="pp">fs::</span>write(<span class="op">&amp;</span>path<span class="op">,</span> <span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a><span class="co">// 1.2 data as [u8] (call with  data.as_bytes() if its a &amp;str)</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a><span class="kw">fn</span> write_data_to_file_as_bytes(path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> data<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u8</span>]) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a>    <span class="pp">fs::</span>write(<span class="op">&amp;</span>path<span class="op">,</span> <span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> <span class="st">&quot;</span><span class="sc">\</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true"></a><span class="st">He he he</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true"></a><span class="st">plenty data</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true"></a><span class="st"> </span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true"></a><span class="st">here.&quot;</span><span class="op">;</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true"></a>    <span class="co">// 1.1. Write all data to a file at once</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true"></a>    <span class="kw">match</span> write_data_to_file(<span class="op">&amp;</span><span class="st">&quot;db_1.1.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data) <span class="op">{</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Write all data to a file at once&quot;</span>)<span class="op">,</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true"></a>    <span class="co">// 1.2. Write all data to a file at once as *[u8]</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true"></a>    <span class="kw">match</span> write_data_to_file_as_bytes(<span class="op">&amp;</span><span class="st">&quot;db_1.2.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data<span class="op">.</span>as_bytes()) <span class="op">{</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Write all data to a file at once as *[u8]&quot;</span>)<span class="op">,</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h3 id="write-all-data-to-a-file-at-once-with-fsfile-write_all">2. Write all data to a file at once with fs::File &amp; write_all</h3>
<p><strong>fs::File</strong><br />
<em>An object providing access to an open file on the filesystem.</em></p>
<p><em>An instance of a File can be read and/or written depending on what options it was opened with. Files also implement Seek to alter the logical cursor that the file contains internally.</em></p>
<p><em>Files are automatically closed when they go out of scope.</em></p>
<h4 id="write-str-all-at-once">2.1 write &amp;str all at once</h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="bu">Write</span><span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a><span class="co">// 2.1 write &amp;str all at once</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a><span class="kw">fn</span> write_data_to_file_with_fs_write_all(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::File::</span>create(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a>    file<span class="op">.</span>write_all(<span class="op">&amp;</span>data<span class="op">.</span>as_bytes())<span class="op">?;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> <span class="st">&quot;</span><span class="sc">\</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true"></a><span class="st">He he he</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true"></a><span class="st">plenty data</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true"></a><span class="st"> </span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true"></a><span class="st">here.&quot;</span><span class="op">;</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true"></a>    <span class="co">// 2. Write all data to a file at once with fs::File</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true"></a>    <span class="co">// 2.1 write &amp;str all at once </span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true"></a>    <span class="kw">match</span> write_data_to_file_with_fs_write_all(<span class="op">&amp;</span><span class="st">&quot;db_2.1.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data) <span class="op">{</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Write all data as &amp;str to a file at once with fs::File and write_all()&quot;</span>)<span class="op">,</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h4 id="write-bytes-all-at-once">2.2 write bytes all at once</h4>
<div class="sourceCode" id="cb12"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="bu">Write</span><span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a><span class="co">// 2.2 write bytes all at once</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a><span class="kw">fn</span> write_data_to_file_with_fs_with_write(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u8</span>]<span class="op">,</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::File::</span>create(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true"></a>    <span class="kw">let</span> remaining <span class="op">=</span> file<span class="op">.</span>write(<span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true"></a>    <span class="kw">if</span> remaining <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true"></a>        <span class="pp">println!</span>(<span class="st">&quot;{remaining} bytes not written&quot;</span>)<span class="op">;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> <span class="st">&quot;</span><span class="sc">\</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true"></a><span class="st">He he he</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true"></a><span class="st">plenty data</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true"></a><span class="st"> </span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true"></a><span class="st">here.&quot;</span><span class="op">;</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true"></a>    <span class="co">// 2. Write all data to a file at once with fs::File</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true"></a>    <span class="co">// 2.2 handle bytes</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true"></a>    <span class="kw">match</span> write_data_to_file_with_fs_with_write(<span class="op">&amp;</span><span class="st">&quot;db_2.2.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data<span class="op">.</span>as_bytes()) <span class="op">{</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Write all data as [u8] to a file with fs::File and write()&quot;</span>)<span class="op">,</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h4 id="the-code-together-1">The code together</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="bu">Write</span><span class="op">;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a><span class="co">// 2.1 write &amp;str all at once</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a><span class="kw">fn</span> write_data_to_file_with_fs_write_all(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::File::</span>create(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true"></a>    file<span class="op">.</span>write_all(<span class="op">&amp;</span>data<span class="op">.</span>as_bytes())<span class="op">?;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true"></a><span class="co">// 2.2 write bytes all at once</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true"></a><span class="kw">fn</span> write_data_to_file_with_fs_with_write(</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u8</span>]<span class="op">,</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::File::</span>create(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true"></a>    <span class="kw">let</span> remaining <span class="op">=</span> file<span class="op">.</span>write(<span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true"></a>    <span class="kw">if</span> remaining <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true"></a>        <span class="pp">println!</span>(<span class="st">&quot;{remaining} bytes not written&quot;</span>)<span class="op">;</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true"></a></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> <span class="st">&quot;</span><span class="sc">\</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true"></a><span class="st">He he he</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true"></a><span class="st">plenty data</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true"></a><span class="st"> </span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true"></a><span class="st">here.&quot;</span><span class="op">;</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true"></a>    <span class="co">// 2. Write all data to a file at once with fs::File</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true"></a>    <span class="co">// 2.1 all at once</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true"></a>    <span class="kw">match</span> write_data_to_file_with_fs_write_all(<span class="op">&amp;</span><span class="st">&quot;db_2.1.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data) <span class="op">{</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Write all data as &amp;str to a file at once with fs::File and write_all()&quot;</span>)<span class="op">,</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true"></a>    <span class="co">// 2.2 handle bytes</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true"></a>    <span class="kw">match</span> write_data_to_file_with_fs_with_write(<span class="op">&amp;</span><span class="st">&quot;db_2.2.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data<span class="op">.</span>as_bytes()) <span class="op">{</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Write all data as [u8] to a file with fs::File and write()&quot;</span>)<span class="op">,</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true"></a></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true"></a></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h3 id="fsopenoptions-builder">3. fs::OpenOptions builder</h3>
<p><strong>fs::OpenOptions</strong><br />
<em>Options and flags which can be used to configure how a file is opened.</em></p>
<p><em>This builder exposes the ability to configure how a File is opened and what operations are permitted on the open file. The File::open and File::create methods are aliases for commonly used options using this builder.</em></p>
<p><em>Generally speaking, when using OpenOptions, you’ll first call OpenOptions::new, then chain calls to methods to set each option, then call OpenOptions::open, passing the path of the file you’re trying to open. This will give you a io::Result with a File inside that you can further operate on.</em> _ <a href="https://doc.rust-lang.org/std/fs/struct.OpenOptions.html">Rust docs: fs::OpenOptions</a></p>
<h4 id="readwrite.-create-if-file-missing.">3.1 Read/Write. Create if file missing.</h4>
<p>Opening a file for both reading and writing, as well as creating it if it doesn’t exist</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::fs::</span>OpenOptions<span class="op">;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a><span class="co">// 3.1 Read/Write. Create if file missing.</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a><span class="kw">let</span> file <span class="op">=</span> <span class="pp">OpenOptions::</span>new()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>            <span class="op">.</span>read(<span class="cn">true</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a>            <span class="op">.</span>write(<span class="cn">true</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a>            <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a>            <span class="op">.</span>open(<span class="st">&quot;foo.txt&quot;</span>)<span class="op">;</span></span></code></pre></div>
<h4 id="append-data-to-a-file-with-fsopenoptions">3.2 Append data to a file with fs::OpenOptions</h4>
<p><em>Note that setting .write(true).append(true) has the same effect as setting only .append(true).</em><br />
<em>This function doesn’t create the file if it doesn’t exist. Use the OpenOptions::create method to do so.</em></p>
<h5 id="write_all-data-as-str">3.2.1 write_all data as &amp;str</h5>
<div class="sourceCode" id="cb15"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="bu">Write</span><span class="op">;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a><span class="co">// 3.2.1 write_all data as &amp;str</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a><span class="kw">fn</span> append_data_to_file_with_write_all(</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::OpenOptions::</span>new()</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a>        <span class="op">.</span>append(<span class="cn">true</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a>        <span class="op">.</span>open(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a>    file<span class="op">.</span>write_all(<span class="op">&amp;</span>data<span class="op">.</span>as_bytes())<span class="op">?;</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> <span class="st">&quot;</span><span class="sc">\</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true"></a><span class="st">He he he</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true"></a><span class="st">plenty data</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true"></a><span class="st"> </span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true"></a><span class="st">here.&quot;</span><span class="op">;</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true"></a>    <span class="co">// 3.2.1 data as &amp;str ([u8] if using as_bytes())</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true"></a>    <span class="kw">match</span> append_data_to_file_with_write_all(<span class="op">&amp;</span><span class="st">&quot;db_3.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data) <span class="op">{</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Append all data as &amp;str to a file at once using write_all()&quot;</span>)<span class="op">,</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h5 id="append-data.as_bytes-with-write">3.2.2 append data.as_bytes() with write()</h5>
<div class="sourceCode" id="cb16"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="bu">Write</span><span class="op">;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a><span class="co">// 3.2.2 append data.as_bytes() with write</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a><span class="kw">fn</span> append_data_to_file_with_write(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u8</span>]<span class="op">,</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::OpenOptions::</span>new()</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true"></a>        <span class="op">.</span>append(<span class="cn">true</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true"></a>        <span class="op">.</span>open(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true"></a>    <span class="kw">let</span> remaining <span class="op">=</span> file<span class="op">.</span>write(<span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true"></a>    <span class="kw">if</span> remaining <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true"></a>        <span class="pp">println!</span>(<span class="st">&quot;{remaining} bytes not written&quot;</span>)<span class="op">;</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> <span class="st">&quot;</span><span class="sc">\</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true"></a><span class="st">He he he</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true"></a><span class="st">plenty data</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true"></a><span class="st"> </span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true"></a><span class="st">here.&quot;</span><span class="op">;</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true"></a></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true"></a>    <span class="co">// 3.2.2 data as [u8] (&amp;str if not using as_bytes())</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true"></a>    <span class="kw">match</span> append_data_to_file_with_write(<span class="op">&amp;</span><span class="st">&quot;db_3.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data<span class="op">.</span>as_bytes()) <span class="op">{</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Append all data as [u8] to a file using write()&quot;</span>)<span class="op">,</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h5 id="the-code-together-2">The Code together</h5>
<div class="sourceCode" id="cb17"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="bu">Write</span><span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>Append data to a file</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a><span class="co">// 3.2.1 write_all data as &amp;str</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a><span class="kw">fn</span> append_data_to_file_with_write_all(</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::OpenOptions::</span>new()</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a>        <span class="op">.</span>append(<span class="cn">true</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true"></a>        <span class="op">.</span>open(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true"></a>    file<span class="op">.</span>write_all(<span class="op">&amp;</span>data<span class="op">.</span>as_bytes())<span class="op">?;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true"></a><span class="co">// 3.2.2 append data.as_bytes()</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true"></a><span class="kw">fn</span> append_data_to_file_with_write(</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u8</span>]<span class="op">,</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::OpenOptions::</span>new()</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true"></a>        <span class="op">.</span>append(<span class="cn">true</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true"></a>        <span class="op">.</span>open(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true"></a></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true"></a>    <span class="kw">let</span> remaining <span class="op">=</span> file<span class="op">.</span>write(<span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true"></a>    <span class="kw">if</span> remaining <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true"></a>        <span class="pp">println!</span>(<span class="st">&quot;{remaining} bytes not written&quot;</span>)<span class="op">;</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true"></a></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true"></a></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> <span class="st">&quot;</span><span class="sc">\</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true"></a><span class="st">He he he</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true"></a></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true"></a><span class="st">plenty data</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true"></a><span class="st"> </span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true"></a><span class="st">here.&quot;</span><span class="op">;</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true"></a></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true"></a></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true"></a>    <span class="co">// 3.2.1 data as &amp;str ([u8] if using as_bytes())</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true"></a>    <span class="kw">match</span> append_data_to_file_with_write_all(<span class="op">&amp;</span><span class="st">&quot;db_3.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data) <span class="op">{</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Append all data as &amp;str to a file at once using write_all()&quot;</span>)<span class="op">,</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true"></a></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true"></a>    <span class="co">// 3.2.2 data as [u8] (&amp;str if not using as_bytes())</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true"></a>    <span class="kw">match</span> append_data_to_file_with_write(<span class="op">&amp;</span><span class="st">&quot;db_3.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data<span class="op">.</span>as_bytes()) <span class="op">{</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Append all data as [u8] to a file using write()&quot;</span>)<span class="op">,</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h3 id="write-and-append-data-to-a-file-with-bufwriter">4. Write and Append data to a file with BufWriter</h3>
<p><strong>std::io::BufWriter</strong><br />
<em>Wraps a writer and buffers its output.</em></p>
<p><em>It can be excessively inefficient to work directly with something that implements Write.</em> <em>BufWriter<W> can improve the speed of programs that make <strong>small and repeated</strong> write calls to the same file or network socket.</em></p>
<p><em>It does not help when writing very large amounts at once, or writing just one or a few times. It also provides no advantage when writing to a destination that is in memory, like a <code>Vec&lt;u8&gt;</code>.</em></p>
<p><em>It is critical to call flush before BufWriter<W> is dropped. Though dropping will attempt to flush the contents of the buffer, any errors that happen in the process of dropping will be ignored. Calling flush ensures that the buffer is empty and thus dropping will not even attempt file operations.</em></p>
<h4 id="append-data-as-str-with-bufwriter-and-write_all">4.1 append data as &amp;str with BufWriter and write_all</h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="op">{</span><span class="bu">Write</span><span class="op">,</span> BufWriter<span class="op">};</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a><span class="co">// 4.1 append data as &amp;str with BufWriter and write_all</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a><span class="at">#[</span>allow<span class="at">(</span>non_snake_case<span class="at">)]</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a><span class="kw">fn</span> append_data_to_file_with_BufWriter_and_write_all(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true"></a>    <span class="kw">let</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::OpenOptions::</span>new()</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true"></a>        <span class="op">.</span>append(<span class="cn">true</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true"></a>        <span class="op">.</span>open(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> BufWriter<span class="op">&lt;</span><span class="pp">fs::</span>File<span class="op">&gt;</span>  <span class="op">=</span> <span class="pp">BufWriter::</span>new(file)<span class="op">;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true"></a>    file<span class="op">.</span>write_all(<span class="op">&amp;</span>data<span class="op">.</span>as_bytes())<span class="op">?;</span> <span class="co">// because fn write_all(&amp;mut self, buf: &amp;[u8]) -&gt; Result&lt;()&gt;</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true"></a>    file<span class="op">.</span>flush()<span class="op">?;</span> <span class="co">// &lt;--- make sure Os really writes it</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true"></a> </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true"></a>    <span class="co">// 4.1 append data as &amp;str with write_all </span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true"></a>    <span class="kw">match</span> append_data_to_file_with_BufWriter_and_write_all(<span class="op">&amp;</span><span class="st">&quot;db_4.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data) <span class="op">{</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Append all data as &amp;str to a file at once with BufWriter and write_all()&quot;</span>)<span class="op">,</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h4 id="append-data.as_bytes-with-bufwriter-and-write">4.2 append data.as_bytes() with BufWriter and write</h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="op">{</span><span class="bu">Write</span><span class="op">,</span> BufWriter<span class="op">};</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a><span class="co">// 4.2 append data.as_bytes() with BufWriter &amp; write</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a><span class="at">#[</span>allow<span class="at">(</span>non_snake_case<span class="at">)]</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a><span class="kw">fn</span> append_data_to_file_with_BufWriter_and_write(</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u8</span>]<span class="op">,</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true"></a>    <span class="kw">let</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::OpenOptions::</span>new()</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true"></a>        <span class="op">.</span>append(<span class="cn">true</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true"></a>        <span class="op">.</span>open(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> BufWriter<span class="op">&lt;</span><span class="pp">fs::</span>File<span class="op">&gt;</span>  <span class="op">=</span> <span class="pp">BufWriter::</span>new(file)<span class="op">;</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true"></a>    <span class="kw">let</span> remaining <span class="op">=</span> file<span class="op">.</span>write(<span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true"></a>    <span class="kw">if</span> remaining <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true"></a>        <span class="pp">println!</span>(<span class="st">&quot;{remaining} bytes not written&quot;</span>)<span class="op">;</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true"></a>    file<span class="op">.</span>flush()<span class="op">?;</span> <span class="co">// &lt;--- make sure Os really writes it</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true"></a> </span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true"></a>    <span class="co">// 4.2 append data.as_bytes() with BufWriter and write</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true"></a>    <span class="kw">match</span> append_data_to_file_with_BufWriter_and_write(<span class="op">&amp;</span><span class="st">&quot;db_4.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data<span class="op">.</span>as_bytes()) <span class="op">{</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Append all data as &amp;str to a file at once with BufWriter and write()&quot;</span>)<span class="op">,</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h4 id="code-all-together">Code all together</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="op">{</span><span class="bu">Write</span><span class="op">,</span> BufWriter<span class="op">};</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true"></a><span class="co">// 4.1 append data as &amp;str with BufWriter and write_all</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true"></a><span class="at">#[</span>allow<span class="at">(</span>non_snake_case<span class="at">)]</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true"></a><span class="kw">fn</span> append_data_to_file_with_BufWriter_and_write_all(</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true"></a>    <span class="kw">let</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::OpenOptions::</span>new()</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true"></a>        <span class="op">.</span>append(<span class="cn">true</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true"></a>        <span class="op">.</span>open(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> BufWriter<span class="op">&lt;</span><span class="pp">fs::</span>File<span class="op">&gt;</span>  <span class="op">=</span> <span class="pp">BufWriter::</span>new(file)<span class="op">;</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true"></a>    file<span class="op">.</span>write_all(<span class="op">&amp;</span>data<span class="op">.</span>as_bytes())<span class="op">?;</span> <span class="co">// because fn write_all(&amp;mut self, buf: &amp;[u8]) -&gt; Result&lt;()&gt;</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true"></a>    file<span class="op">.</span>flush()<span class="op">?;</span> <span class="co">// &lt;--- make sure Os really writes it</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true"></a> </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true"></a><span class="co">// 4.2 append data.as_bytes() with write</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true"></a><span class="at">#[</span>allow<span class="at">(</span>non_snake_case<span class="at">)]</span> </span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true"></a><span class="kw">fn</span> append_data_to_file_with_BufWriter_and_write(</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u8</span>]<span class="op">,</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true"></a>    <span class="kw">let</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::OpenOptions::</span>new()</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true"></a>        <span class="op">.</span>append(<span class="cn">true</span>)</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true"></a>        <span class="op">.</span>open(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> BufWriter<span class="op">&lt;</span><span class="pp">fs::</span>File<span class="op">&gt;</span>  <span class="op">=</span> <span class="pp">BufWriter::</span>new(file)<span class="op">;</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true"></a></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true"></a>    <span class="kw">let</span> remaining <span class="op">=</span> file<span class="op">.</span>write(<span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true"></a>    <span class="kw">if</span> remaining <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true"></a>        <span class="pp">println!</span>(<span class="st">&quot;{remaining} bytes not written&quot;</span>)<span class="op">;</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true"></a></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true"></a>    file<span class="op">.</span>flush()<span class="op">?;</span> <span class="co">// &lt;--- make sure Os really writes it</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true"></a> </span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true"></a></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true"></a></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true"></a>    <span class="co">// 4.1 append data as &amp;str with write_all </span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true"></a>    <span class="kw">match</span> append_data_to_file_with_BufWriter_and_write_all(<span class="op">&amp;</span><span class="st">&quot;db_4.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data) <span class="op">{</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Append all data as &amp;str to a file at once with BufWriter and write_all()&quot;</span>)<span class="op">,</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true"></a></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true"></a>    <span class="co">// 4.2 append data.as_bytes() with BufWriter and write</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true"></a>    <span class="kw">match</span> append_data_to_file_with_BufWriter_and_write(<span class="op">&amp;</span><span class="st">&quot;db_4.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data<span class="op">.</span>as_bytes()) <span class="op">{</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Append all data as &amp;str to a file at once with BufWriter and write()&quot;</span>)<span class="op">,</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h2 id="read-file">Read File</h2>
<h3 id="read-whole-file-into-string.">1. read whole file into String.</h3>
<p>Read the entire contents of a file into a string.</p>
<p><em>This is a convenience function for using <code>File::open</code> and <code>read_to_string</code> with fewer imports and without an intermediate variable.</em><br />
_ <a href="https://doc.rust-lang.org/std/fs/fn.read_to_string.html">Rust doc: fs::read_to_string</a></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a><span class="kw">fn</span> read_to_string(file<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a>    <span class="kw">match</span> <span class="pp">fs::</span>read_to_string(file) <span class="op">{</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a>        <span class="cn">Ok</span>(f) <span class="op">=&gt;</span> f<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a>        <span class="cn">Err</span>(_) <span class="op">=&gt;</span> <span class="st">&quot;&quot;</span><span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true"></a>    <span class="kw">let</span> read_from_string <span class="op">=</span> read_to_string(<span class="st">&quot;fs.rs&quot;</span>)<span class="op">;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;{}&quot;</span><span class="op">,</span> read_from_string)<span class="op">;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a><span class="kw">fn</span> file_to_string() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a>    <span class="kw">let</span> content <span class="op">=</span> <span class="pp">fs::</span>read_to_string(<span class="st">&quot;./db.txt&quot;</span>)<span class="op">?;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true"></a>    <span class="cn">Ok</span>(content)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;1. read whole file into String.&quot;</span>)<span class="op">;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> file_to_string()<span class="op">;</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true"></a>    <span class="kw">match</span> data <span class="op">{</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true"></a>        <span class="cn">Ok</span>(content) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;{}&quot;</span><span class="op">,</span> content)<span class="op">,</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Something happened {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h3 id="read-whole-file-into-vec-then-convert-string.">2. read whole file into Vec<u8> then convert string.</h3>
<p>Read the entire contents of a file into a bytes vector.</p>
<p><em>This is a convenience function for using <code>File::open</code> and <code>read_to_end</code> with fewer imports and without an intermediate variable.</em><br />
_ <a href="https://doc.rust-lang.org/std/fs/fn.read.html">Rust doc: fs::read</a></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span><span class="dt">str</span><span class="op">;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a><span class="kw">fn</span> file_to_vec_u8() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">&gt;,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true"></a>    <span class="kw">let</span> content <span class="op">=</span> <span class="pp">fs::</span>read(<span class="st">&quot;./db.txt&quot;</span>)<span class="op">?;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true"></a>    <span class="cn">Ok</span>(content)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;2. read whole file into Vec&lt;u8&gt; then convert string.&quot;</span>)<span class="op">;</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> file_to_vec_u8()<span class="op">;</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true"></a>    <span class="kw">match</span> data <span class="op">{</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true"></a>        <span class="cn">Ok</span>(content) <span class="op">=&gt;</span> <span class="kw">match</span> <span class="dt">str</span><span class="pp">::</span>from_utf8(<span class="op">&amp;</span>content) <span class="op">{</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true"></a>            <span class="cn">Ok</span>(str_data) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;{str_data}&quot;</span>)<span class="op">,</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true"></a>            <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Could not convert: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true"></a>        <span class="op">},</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Something happened {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h3 id="read-file-line-by-line-in-to-a-vec">3. read file line by line in to a Vec<String></h3>
<p><strong>fs::File</strong><br />
An object providing access to an open file on the filesystem.</p>
<p><em>An instance of a File can be read and/or written depending on what options it was opened with. Files also implement Seek to alter the logical cursor that the file contains internally.</em></p>
<p><em>Files are automatically closed when they go out of scope.</em><br />
_ <a href="https://doc.rust-lang.org/std/fs/struct.File.html">Rust doc: fs::File</a></p>
<p><strong>File::open</strong><br />
Attempts to open a file in read-only mode.</p>
<p><strong>BufReader</strong><br />
The <code>BufReader</code> struct adds buffering to any reader.</p>
<p><em>A <code>BufReader</code> performs large, infrequent reads on the underlying Read and maintains an in-memory buffer of the results.</em><br />
<em><code>BufReader</code> can improve the speed of programs that make small and repeated read calls to the same file or network socket.</em><br />
<em>It does not help when reading very large amounts at once, or reading just one or a few times.</em><br />
<em>It also provides no advantage when reading from a source that is already in memory, like a <code>Vec&lt;u8&gt;</code>.</em><br />
_ <a href="https://doc.rust-lang.org/std/io/struct.BufReader.html">Rust doc: BufReader</a></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::fs::</span>File<span class="op">;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="op">{</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a>    <span class="bu">BufRead</span><span class="op">,</span> <span class="co">// lines()</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a>    BufReader</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a><span class="op">};</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true"></a><span class="kw">fn</span> file_line_by_line() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">&gt;,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true"></a>    <span class="kw">let</span> file<span class="op">:</span> File <span class="op">=</span> <span class="pp">File::</span>open(<span class="st">&quot;./db.txt&quot;</span>)<span class="op">?;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true"></a>    <span class="kw">let</span> reader<span class="op">:</span> BufReader<span class="op">&lt;</span>File<span class="op">&gt;</span> <span class="op">=</span> <span class="pp">BufReader::</span>new(file)<span class="op">;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> content<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">&gt;</span> <span class="op">=</span> <span class="dt">Vec</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true"></a>    <span class="kw">for</span> line <span class="kw">in</span> reader<span class="op">.</span>lines() <span class="op">{</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true"></a>        <span class="kw">match</span> line <span class="op">{</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true"></a>            <span class="cn">Ok</span>(aline) <span class="op">=&gt;</span> content<span class="op">.</span>push(aline)<span class="op">,</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true"></a>            <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true"></a>    <span class="cn">Ok</span>(content)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;3. read file line by line in to a Vec&lt;String&gt;&quot;</span>)<span class="op">;</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> file_line_by_line()<span class="op">;</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true"></a>    <span class="kw">match</span> data <span class="op">{</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true"></a>        <span class="cn">Ok</span>(content) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true"></a>            <span class="kw">for</span> line <span class="kw">in</span> content <span class="op">{</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true"></a>                <span class="pp">println!</span>(<span class="st">&quot;{line}&quot;</span>)<span class="op">;</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Something happened {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true"></a><span class="op">}</span> </span></code></pre></div>
<h3 id="read-file-byte-by-byte-in-to-a-vec">4. read file byte by byte in to a Vec<u8></h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::fs::</span>File<span class="op">;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="op">{</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a>    BufReader<span class="op">,</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a>    <span class="bu">Read</span><span class="op">,</span> <span class="co">// bytes()</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a><span class="op">};</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true"></a><span class="kw">fn</span> file_byte_by_byte() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">&gt;,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true"></a>    <span class="kw">let</span> file<span class="op">:</span> File <span class="op">=</span> <span class="pp">File::</span>open(<span class="st">&quot;./db.txt&quot;</span>)<span class="op">?;</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true"></a>    <span class="kw">let</span> reader<span class="op">:</span> BufReader<span class="op">&lt;</span>File<span class="op">&gt;</span> <span class="op">=</span> <span class="pp">BufReader::</span>new(file)<span class="op">;</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> content<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">&gt;</span> <span class="op">=</span> <span class="dt">Vec</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true"></a>    <span class="kw">for</span> line <span class="kw">in</span> reader<span class="op">.</span>bytes() <span class="op">{</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true"></a>        <span class="kw">match</span> line <span class="op">{</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true"></a>            <span class="cn">Ok</span>(aline) <span class="op">=&gt;</span> content<span class="op">.</span>push(aline)<span class="op">,</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true"></a>            <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true"></a>    <span class="cn">Ok</span>(content)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;4. read file byte by byte in to a Vec&lt;u8&gt;&quot;</span>)<span class="op">;</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> file_byte_by_byte()<span class="op">;</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true"></a>    <span class="kw">match</span> data <span class="op">{</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true"></a>        <span class="cn">Ok</span>(content) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true"></a>            <span class="kw">for</span> line <span class="kw">in</span> content <span class="op">{</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true"></a>                <span class="pp">println!</span>(<span class="st">&quot;{line}&quot;</span>)<span class="op">;</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Something happened {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true"></a></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h3 id="read-file-byte-chunks-by-byte-chunk-in-to-an-array-u8">5. read file byte chunks by byte chunk in to an array [u8]</h3>
<div class="sourceCode" id="cb26"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::fs::</span>File<span class="op">;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="op">{</span><span class="bu">BufRead</span><span class="op">,</span> BufReader<span class="op">,</span> <span class="bu">Read</span><span class="op">};</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span><span class="dt">str</span><span class="op">;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true"></a><span class="kw">fn</span> file_byte_chunk_by_byte_chunk(buffer_size<span class="op">:</span> <span class="dt">usize</span>) </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true"></a>    <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">&gt;&gt;,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true"></a>    <span class="kw">let</span> file<span class="op">:</span> File <span class="op">=</span> <span class="pp">File::</span>open(<span class="st">&quot;./db.txt&quot;</span>)<span class="op">?;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> reader<span class="op">:</span> BufReader<span class="op">&lt;</span>File<span class="op">&gt;</span> <span class="op">=</span> </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true"></a>        <span class="pp">BufReader::</span>with_capacity(buffer_size<span class="op">,</span> file)<span class="op">;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true"></a>    </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> content<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">&gt;&gt;</span> <span class="op">=</span> <span class="dt">Vec</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true"></a>    <span class="kw">loop</span> <span class="op">{</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true"></a>        <span class="kw">let</span> buffer <span class="op">=</span> reader<span class="op">.</span>fill_buf()<span class="op">?;</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true"></a>        <span class="kw">let</span> buffer_length<span class="op">:</span> <span class="dt">usize</span> <span class="op">=</span> buffer<span class="op">.</span>len()<span class="op">;</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true"></a>        </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true"></a>        <span class="kw">if</span> buffer_length <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span> <span class="kw">break</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true"></a>        content<span class="op">.</span>push(buffer<span class="op">.</span>to_vec())<span class="op">;</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true"></a>        reader<span class="op">.</span>consume(buffer_length)<span class="op">;</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true"></a>    <span class="op">};</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true"></a>    </span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true"></a>    <span class="cn">Ok</span>(content)</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;5. read file byte by byte in chunks of {BUFFER_SIZE} &quot;</span>)<span class="op">;</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true"></a>    <span class="kw">const</span> BUFFER_SIZE<span class="op">:</span> <span class="dt">usize</span> <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> file_byte_chunk_by_byte_chunk(BUFFER_SIZE)<span class="op">;</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true"></a>    <span class="kw">match</span> data <span class="op">{</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true"></a>        <span class="cn">Ok</span>(content) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true"></a>            <span class="kw">for</span> line <span class="kw">in</span> content <span class="op">{</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true"></a>                <span class="kw">match</span> <span class="dt">str</span><span class="pp">::</span>from_utf8(<span class="op">&amp;</span>line) <span class="op">{</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true"></a>                    <span class="cn">Ok</span>(chunk) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;{chunk}&quot;</span>)<span class="op">,</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true"></a>                    <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Could not convert to utf8: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Something happened {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h3 id="write-file-everything-together">Write File: Everything together</h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="op">{</span><span class="bu">Write</span><span class="op">,</span> BufWriter<span class="op">};</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true"></a><span class="co">// 1. Write all data to a file at once</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true"></a><span class="co">// 1.1 data as &amp;str</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true"></a><span class="kw">fn</span> write_data_to_file(path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> data<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true"></a>    <span class="pp">fs::</span>write(<span class="op">&amp;</span>path<span class="op">,</span> <span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true"></a><span class="co">// 1.2 data as [u8] (&amp;str if not using as_bytes())</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true"></a><span class="kw">fn</span> write_data_to_file_as_bytes(path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> data<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u8</span>]) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true"></a>    <span class="pp">fs::</span>write(<span class="op">&amp;</span>path<span class="op">,</span> <span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true"></a><span class="co">// 2. Write all data to a file at once with fs::File</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true"></a><span class="co">// 2.1 all at once</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true"></a><span class="kw">fn</span> write_data_to_file_with_fs_write_all(</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::File::</span>create(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true"></a></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true"></a>    file<span class="op">.</span>write_all(<span class="op">&amp;</span>data<span class="op">.</span>as_bytes())<span class="op">?;</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true"></a></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true"></a><span class="co">// 2.2 handle bytes</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true"></a><span class="kw">fn</span> write_data_to_file_with_fs_with_write(</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u8</span>]<span class="op">,</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::File::</span>create(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true"></a></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true"></a>    <span class="kw">let</span> remaining <span class="op">=</span> file<span class="op">.</span>write(<span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true"></a>    <span class="kw">if</span> remaining <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true"></a>        <span class="pp">println!</span>(<span class="st">&quot;{remaining} bytes not written&quot;</span>)<span class="op">;</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true"></a></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true"></a></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true"></a><span class="co">// 3. Append data to a file</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true"></a><span class="co">// 3.1 write_all data as &amp;str</span></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true"></a><span class="kw">fn</span> append_data_to_file_with_write_all(</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::OpenOptions::</span>new()</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true"></a>        <span class="op">.</span>append(<span class="cn">true</span>)</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true"></a>        <span class="op">.</span>open(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true"></a></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true"></a>    file<span class="op">.</span>write_all(<span class="op">&amp;</span>data<span class="op">.</span>as_bytes())<span class="op">?;</span></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true"></a></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true"></a></span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true"></a><span class="co">// 3.2 append data.as_bytes()</span></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true"></a><span class="kw">fn</span> append_data_to_file_with_write(</span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u8</span>]<span class="op">,</span></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::OpenOptions::</span>new()</span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true"></a>        <span class="op">.</span>append(<span class="cn">true</span>)</span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true"></a>        <span class="op">.</span>open(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true"></a></span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true"></a>    <span class="kw">let</span> remaining <span class="op">=</span> file<span class="op">.</span>write(<span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true"></a>    <span class="kw">if</span> remaining <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true"></a>        <span class="pp">println!</span>(<span class="st">&quot;{remaining} bytes not written&quot;</span>)<span class="op">;</span></span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true"></a></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true"></a></span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true"></a><span class="co">// 4. Write and Append data to a file with BufWriter</span></span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true"></a><span class="co">// 4.1 append data as &amp;str with write_all</span></span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true"></a><span class="at">#[</span>allow<span class="at">(</span>non_snake_case<span class="at">)]</span> </span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true"></a><span class="kw">fn</span> append_data_to_file_with_BufWriter_with_write_all(</span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true"></a>    <span class="kw">let</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::OpenOptions::</span>new()</span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true"></a>        <span class="op">.</span>append(<span class="cn">true</span>)</span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true"></a>        <span class="op">.</span>open(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true"></a></span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> BufWriter<span class="op">&lt;</span><span class="pp">fs::</span>File<span class="op">&gt;</span>  <span class="op">=</span> <span class="pp">BufWriter::</span>new(file)<span class="op">;</span></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true"></a></span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true"></a>    file<span class="op">.</span>write_all(<span class="op">&amp;</span>data<span class="op">.</span>as_bytes())<span class="op">?;</span></span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true"></a></span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true"></a>    file<span class="op">.</span>flush()<span class="op">?;</span> <span class="co">// &lt;--- make sure Os really writes it</span></span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true"></a> </span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true"></a></span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true"></a><span class="co">// 4.2 append data.as_bytes() with write</span></span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true"></a><span class="at">#[</span>allow<span class="at">(</span>non_snake_case<span class="at">)]</span> </span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true"></a><span class="kw">fn</span> append_data_to_file_with_BufWriter_with_write(</span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true"></a>    path<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true"></a>    data<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u8</span>]<span class="op">,</span></span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true"></a>) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true"></a>    <span class="kw">let</span> file<span class="op">:</span> <span class="pp">fs::</span>File <span class="op">=</span> <span class="pp">fs::OpenOptions::</span>new()</span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true"></a>        <span class="op">.</span>append(<span class="cn">true</span>)</span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true"></a>        <span class="op">.</span>open(<span class="op">&amp;</span>path)<span class="op">?;</span></span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true"></a></span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> file<span class="op">:</span> BufWriter<span class="op">&lt;</span><span class="pp">fs::</span>File<span class="op">&gt;</span>  <span class="op">=</span> <span class="pp">BufWriter::</span>new(file)<span class="op">;</span></span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true"></a></span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true"></a>    <span class="kw">let</span> remaining <span class="op">=</span> file<span class="op">.</span>write(<span class="op">&amp;</span>data)<span class="op">?;</span></span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true"></a>    <span class="kw">if</span> remaining <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true"></a>        <span class="pp">println!</span>(<span class="st">&quot;{remaining} bytes not written&quot;</span>)<span class="op">;</span></span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true"></a></span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true"></a>    file<span class="op">.</span>flush()<span class="op">?;</span> <span class="co">// &lt;--- make sure Os really writes it</span></span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true"></a> </span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true"></a></span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> <span class="st">&quot;</span><span class="sc">\</span></span>
<span id="cb27-126"><a href="#cb27-126" aria-hidden="true"></a><span class="st">He he he</span></span>
<span id="cb27-127"><a href="#cb27-127" aria-hidden="true"></a></span>
<span id="cb27-128"><a href="#cb27-128" aria-hidden="true"></a><span class="st">plenty data</span></span>
<span id="cb27-129"><a href="#cb27-129" aria-hidden="true"></a><span class="st"> </span></span>
<span id="cb27-130"><a href="#cb27-130" aria-hidden="true"></a><span class="st">here.&quot;</span><span class="op">;</span></span>
<span id="cb27-131"><a href="#cb27-131" aria-hidden="true"></a></span>
<span id="cb27-132"><a href="#cb27-132" aria-hidden="true"></a>    <span class="co">// 1.1. Write all data to a file at once</span></span>
<span id="cb27-133"><a href="#cb27-133" aria-hidden="true"></a>    <span class="kw">match</span> write_data_to_file(<span class="op">&amp;</span><span class="st">&quot;db_1.1.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data) <span class="op">{</span></span>
<span id="cb27-134"><a href="#cb27-134" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Write all data to a file at once&quot;</span>)<span class="op">,</span></span>
<span id="cb27-135"><a href="#cb27-135" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb27-136"><a href="#cb27-136" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb27-137"><a href="#cb27-137" aria-hidden="true"></a></span>
<span id="cb27-138"><a href="#cb27-138" aria-hidden="true"></a>    <span class="co">// 1.2. Write all data to a file at once as *[u8]</span></span>
<span id="cb27-139"><a href="#cb27-139" aria-hidden="true"></a>    <span class="kw">match</span> write_data_to_file_as_bytes(<span class="op">&amp;</span><span class="st">&quot;db_1.2.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data<span class="op">.</span>as_bytes()) <span class="op">{</span></span>
<span id="cb27-140"><a href="#cb27-140" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Write all data to a file at once as *[u8]&quot;</span>)<span class="op">,</span></span>
<span id="cb27-141"><a href="#cb27-141" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb27-142"><a href="#cb27-142" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb27-143"><a href="#cb27-143" aria-hidden="true"></a></span>
<span id="cb27-144"><a href="#cb27-144" aria-hidden="true"></a>    <span class="co">// 2. Write all data to a file at once with fs::File</span></span>
<span id="cb27-145"><a href="#cb27-145" aria-hidden="true"></a>    <span class="co">// 2.1 all at once</span></span>
<span id="cb27-146"><a href="#cb27-146" aria-hidden="true"></a>    <span class="kw">match</span> write_data_to_file_with_fs_write_all(<span class="op">&amp;</span><span class="st">&quot;db_2.1.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data) <span class="op">{</span></span>
<span id="cb27-147"><a href="#cb27-147" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Write all data as &amp;str to a file at once with fs::File and write_all()&quot;</span>)<span class="op">,</span></span>
<span id="cb27-148"><a href="#cb27-148" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb27-149"><a href="#cb27-149" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb27-150"><a href="#cb27-150" aria-hidden="true"></a>    <span class="co">// 2.2 handle bytes</span></span>
<span id="cb27-151"><a href="#cb27-151" aria-hidden="true"></a>    <span class="kw">match</span> write_data_to_file_with_fs_with_write(<span class="op">&amp;</span><span class="st">&quot;db_2.2.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data<span class="op">.</span>as_bytes()) <span class="op">{</span></span>
<span id="cb27-152"><a href="#cb27-152" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Write all data as [u8] to a file with fs::File and write()&quot;</span>)<span class="op">,</span></span>
<span id="cb27-153"><a href="#cb27-153" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb27-154"><a href="#cb27-154" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb27-155"><a href="#cb27-155" aria-hidden="true"></a></span>
<span id="cb27-156"><a href="#cb27-156" aria-hidden="true"></a>    <span class="co">// 3. Append data to a file</span></span>
<span id="cb27-157"><a href="#cb27-157" aria-hidden="true"></a>    <span class="co">// 3.1 data as &amp;str ([u8] if using as_bytes())</span></span>
<span id="cb27-158"><a href="#cb27-158" aria-hidden="true"></a>    <span class="kw">match</span> append_data_to_file_with_write_all(<span class="op">&amp;</span><span class="st">&quot;db_3.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data) <span class="op">{</span></span>
<span id="cb27-159"><a href="#cb27-159" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Append all data as &amp;str to a file at once using write_all()&quot;</span>)<span class="op">,</span></span>
<span id="cb27-160"><a href="#cb27-160" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb27-161"><a href="#cb27-161" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb27-162"><a href="#cb27-162" aria-hidden="true"></a></span>
<span id="cb27-163"><a href="#cb27-163" aria-hidden="true"></a>    <span class="co">// 3.2 data as [u8] (&amp;str if not using as_bytes())</span></span>
<span id="cb27-164"><a href="#cb27-164" aria-hidden="true"></a>    <span class="kw">match</span> append_data_to_file_with_write(<span class="op">&amp;</span><span class="st">&quot;db_3.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data<span class="op">.</span>as_bytes()) <span class="op">{</span></span>
<span id="cb27-165"><a href="#cb27-165" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Append all data as [u8] to a file using write()&quot;</span>)<span class="op">,</span></span>
<span id="cb27-166"><a href="#cb27-166" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb27-167"><a href="#cb27-167" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb27-168"><a href="#cb27-168" aria-hidden="true"></a></span>
<span id="cb27-169"><a href="#cb27-169" aria-hidden="true"></a>    <span class="co">// 4. Write and Append data to a file with BufWriter</span></span>
<span id="cb27-170"><a href="#cb27-170" aria-hidden="true"></a>    <span class="co">// 4.1 append data as &amp;str with write_all </span></span>
<span id="cb27-171"><a href="#cb27-171" aria-hidden="true"></a>    <span class="kw">match</span> append_data_to_file_with_BufWriter_with_write_all(<span class="op">&amp;</span><span class="st">&quot;db_4.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data) <span class="op">{</span></span>
<span id="cb27-172"><a href="#cb27-172" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Append all data as &amp;str to a file at once with BufWriter and write_all()&quot;</span>)<span class="op">,</span></span>
<span id="cb27-173"><a href="#cb27-173" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb27-174"><a href="#cb27-174" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb27-175"><a href="#cb27-175" aria-hidden="true"></a></span>
<span id="cb27-176"><a href="#cb27-176" aria-hidden="true"></a>    <span class="co">// 4.2 append data.as_bytes() with BufWriter and write</span></span>
<span id="cb27-177"><a href="#cb27-177" aria-hidden="true"></a>    <span class="kw">match</span> append_data_to_file_with_BufWriter_with_write(<span class="op">&amp;</span><span class="st">&quot;db_4.txt&quot;</span><span class="op">,</span> <span class="op">&amp;</span>data<span class="op">.</span>as_bytes()) <span class="op">{</span></span>
<span id="cb27-178"><a href="#cb27-178" aria-hidden="true"></a>        <span class="cn">Ok</span>(_) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Append all data as &amp;str to a file at once with BufWriter and write()&quot;</span>)<span class="op">,</span></span>
<span id="cb27-179"><a href="#cb27-179" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb27-180"><a href="#cb27-180" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb27-181"><a href="#cb27-181" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h3 id="read-file-everything-together">Read File: Everything together</h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span>                             <span class="co">// 1.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::fs::</span>File<span class="op">;</span>                       <span class="co">// 3, 4 and 5</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="op">{</span><span class="bu">BufRead</span><span class="op">,</span> BufReader<span class="op">,</span> <span class="bu">Read</span><span class="op">};</span> <span class="co">// 3. 4 and 5 needs Read</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span><span class="dt">str</span><span class="op">;</span>                            <span class="co">// 2, 5</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true"></a><span class="co">// 1. read whole file into String.</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true"></a><span class="kw">fn</span> file_to_string() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true"></a>    <span class="kw">let</span> content <span class="op">=</span> <span class="pp">fs::</span>read_to_string(<span class="st">&quot;./db.txt&quot;</span>)<span class="op">?;</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true"></a>    <span class="cn">Ok</span>(content)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true"></a><span class="co">// 2. read whole file into Vec&lt;u8&gt; then convert string.</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true"></a><span class="kw">fn</span> file_to_vec_u8() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">&gt;,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true"></a>    <span class="kw">let</span> content <span class="op">=</span> <span class="pp">fs::</span>read(<span class="st">&quot;./db.txt&quot;</span>)<span class="op">?;</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true"></a></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true"></a>    <span class="cn">Ok</span>(content)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true"></a><span class="co">// 3. read file line by line in to a Vec&lt;String&gt;</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true"></a><span class="kw">fn</span> file_line_by_line() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">&gt;,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true"></a>    <span class="kw">let</span> file<span class="op">:</span> File <span class="op">=</span> <span class="pp">File::</span>open(<span class="st">&quot;./db.txt&quot;</span>)<span class="op">?;</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true"></a>    <span class="kw">let</span> reader<span class="op">:</span> BufReader<span class="op">&lt;</span>File<span class="op">&gt;</span> <span class="op">=</span> <span class="pp">BufReader::</span>new(file)<span class="op">;</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> content<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">&gt;</span> <span class="op">=</span> <span class="dt">Vec</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true"></a></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true"></a>    <span class="kw">for</span> line <span class="kw">in</span> reader<span class="op">.</span>lines() <span class="op">{</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true"></a>        <span class="kw">match</span> line <span class="op">{</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true"></a>            <span class="cn">Ok</span>(aline) <span class="op">=&gt;</span> content<span class="op">.</span>push(aline)<span class="op">,</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true"></a>            <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true"></a></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true"></a>    <span class="cn">Ok</span>(content)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true"></a></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true"></a><span class="co">// 4. read file byte by byte in to a Vec&lt;u8&gt;</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true"></a><span class="kw">fn</span> file_byte_by_byte() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">&gt;,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true"></a>    <span class="kw">let</span> file<span class="op">:</span> File <span class="op">=</span> <span class="pp">File::</span>open(<span class="st">&quot;./db.txt&quot;</span>)<span class="op">?;</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true"></a>    <span class="kw">let</span> reader<span class="op">:</span> BufReader<span class="op">&lt;</span>File<span class="op">&gt;</span> <span class="op">=</span> <span class="pp">BufReader::</span>new(file)<span class="op">;</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> content<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">&gt;</span> <span class="op">=</span> <span class="dt">Vec</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true"></a></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true"></a>    <span class="kw">for</span> line <span class="kw">in</span> reader<span class="op">.</span>bytes() <span class="op">{</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true"></a>        <span class="kw">match</span> line <span class="op">{</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true"></a>            <span class="cn">Ok</span>(aline) <span class="op">=&gt;</span> content<span class="op">.</span>push(aline)<span class="op">,</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true"></a>            <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Opps: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true"></a></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true"></a>    <span class="cn">Ok</span>(content)</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true"></a></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true"></a><span class="co">// 5. read file byte chunks by byte chunk in to an array [u8]</span></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true"></a><span class="kw">fn</span> file_byte_chunk_by_byte_chunk(buffer_size<span class="op">:</span> <span class="dt">usize</span>) </span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true"></a>    <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">&gt;&gt;,</span> <span class="dt">Box</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="pp">std::error::</span><span class="bu">Error</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true"></a></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true"></a>    <span class="kw">let</span> file<span class="op">:</span> File <span class="op">=</span> <span class="pp">File::</span>open(<span class="st">&quot;./db.txt&quot;</span>)<span class="op">?;</span></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> reader<span class="op">:</span> BufReader<span class="op">&lt;</span>File<span class="op">&gt;</span> <span class="op">=</span> </span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true"></a>        <span class="pp">BufReader::</span>with_capacity(buffer_size<span class="op">,</span> file)<span class="op">;</span></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true"></a>    </span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true"></a>    <span class="kw">let</span> <span class="kw">mut</span> content<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u8</span><span class="op">&gt;&gt;</span> <span class="op">=</span> <span class="dt">Vec</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true"></a>    <span class="kw">loop</span> <span class="op">{</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true"></a>        <span class="kw">let</span> buffer <span class="op">=</span> reader<span class="op">.</span>fill_buf()<span class="op">?;</span></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true"></a>        <span class="kw">let</span> buffer_length<span class="op">:</span> <span class="dt">usize</span> <span class="op">=</span> buffer<span class="op">.</span>len()<span class="op">;</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true"></a>        </span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true"></a>        <span class="kw">if</span> buffer_length <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span> <span class="kw">break</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true"></a></span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true"></a>        content<span class="op">.</span>push(buffer<span class="op">.</span>to_vec())<span class="op">;</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true"></a>        reader<span class="op">.</span>consume(buffer_length)<span class="op">;</span></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true"></a>    <span class="op">};</span></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true"></a>    </span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true"></a>    <span class="cn">Ok</span>(content)</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true"></a></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true"></a>    <span class="co">// 1.</span></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;1. read whole file into String.&quot;</span>)<span class="op">;</span></span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> file_to_string()<span class="op">;</span></span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true"></a>    <span class="kw">match</span> data <span class="op">{</span></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true"></a>        <span class="cn">Ok</span>(content) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;{}&quot;</span><span class="op">,</span> content)<span class="op">,</span></span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Something happened {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true"></a></span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true"></a>    <span class="co">// 2.</span></span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;2. read whole file into Vec&lt;u8&gt; then convert string.&quot;</span>)<span class="op">;</span></span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> file_to_vec_u8()<span class="op">;</span></span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true"></a>    <span class="kw">match</span> data <span class="op">{</span></span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true"></a>        <span class="cn">Ok</span>(content) <span class="op">=&gt;</span> <span class="kw">match</span> <span class="dt">str</span><span class="pp">::</span>from_utf8(<span class="op">&amp;</span>content) <span class="op">{</span></span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true"></a>            <span class="cn">Ok</span>(str_data) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;{str_data}&quot;</span>)<span class="op">,</span></span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true"></a>            <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Could not convert: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true"></a>        <span class="op">},</span></span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Something happened {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true"></a></span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true"></a>    <span class="co">// - If you feed in say a png file you get the error msg</span></span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true"></a>    <span class="co">// &quot;Could not convert: invalid utf-8 sequence of 1 bytes from index 0&quot;</span></span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true"></a>    <span class="co">//</span></span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true"></a>    <span class="co">// - And if there is no file to read you get</span></span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true"></a>    <span class="co">// &quot;Something happened No such file or directory (os error 2)&quot;</span></span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true"></a></span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true"></a>    <span class="co">// 3.</span></span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;3. read file line by line in to a Vec&lt;String&gt;&quot;</span>)<span class="op">;</span></span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> file_line_by_line()<span class="op">;</span></span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true"></a>    <span class="kw">match</span> data <span class="op">{</span></span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true"></a>        <span class="cn">Ok</span>(content) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true"></a>            <span class="kw">for</span> line <span class="kw">in</span> content <span class="op">{</span></span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true"></a>                <span class="pp">println!</span>(<span class="st">&quot;{line}&quot;</span>)<span class="op">;</span></span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Something happened {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true"></a></span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true"></a>    <span class="co">// 4. </span></span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;4. read file byte by byte in to a Vec&lt;u8&gt;&quot;</span>)<span class="op">;</span></span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> file_byte_by_byte()<span class="op">;</span></span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true"></a>    <span class="kw">match</span> data <span class="op">{</span></span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true"></a>        <span class="cn">Ok</span>(content) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true"></a>            <span class="kw">for</span> line <span class="kw">in</span> content <span class="op">{</span></span>
<span id="cb28-118"><a href="#cb28-118" aria-hidden="true"></a>                <span class="pp">println!</span>(<span class="st">&quot;{line}&quot;</span>)<span class="op">;</span></span>
<span id="cb28-119"><a href="#cb28-119" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb28-120"><a href="#cb28-120" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb28-121"><a href="#cb28-121" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Something happened {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb28-122"><a href="#cb28-122" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb28-123"><a href="#cb28-123" aria-hidden="true"></a></span>
<span id="cb28-124"><a href="#cb28-124" aria-hidden="true"></a>    <span class="co">// 5.</span></span>
<span id="cb28-125"><a href="#cb28-125" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;5. read file byte by byte in chunks of {BUFFER_SIZE} &quot;</span>)<span class="op">;</span></span>
<span id="cb28-126"><a href="#cb28-126" aria-hidden="true"></a>    <span class="kw">const</span> BUFFER_SIZE<span class="op">:</span> <span class="dt">usize</span> <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb28-127"><a href="#cb28-127" aria-hidden="true"></a>    <span class="kw">let</span> data <span class="op">=</span> file_byte_chunk_by_byte_chunk(BUFFER_SIZE)<span class="op">;</span></span>
<span id="cb28-128"><a href="#cb28-128" aria-hidden="true"></a>    <span class="kw">match</span> data <span class="op">{</span></span>
<span id="cb28-129"><a href="#cb28-129" aria-hidden="true"></a>        <span class="cn">Ok</span>(content) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb28-130"><a href="#cb28-130" aria-hidden="true"></a>            <span class="kw">for</span> line <span class="kw">in</span> content <span class="op">{</span></span>
<span id="cb28-131"><a href="#cb28-131" aria-hidden="true"></a>                <span class="kw">match</span> <span class="dt">str</span><span class="pp">::</span>from_utf8(<span class="op">&amp;</span>line) <span class="op">{</span></span>
<span id="cb28-132"><a href="#cb28-132" aria-hidden="true"></a>                    <span class="cn">Ok</span>(chunk) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;{chunk}&quot;</span>)<span class="op">,</span></span>
<span id="cb28-133"><a href="#cb28-133" aria-hidden="true"></a>                    <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Could not convert to utf8: {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb28-134"><a href="#cb28-134" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb28-135"><a href="#cb28-135" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb28-136"><a href="#cb28-136" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb28-137"><a href="#cb28-137" aria-hidden="true"></a>        <span class="cn">Err</span>(e) <span class="op">=&gt;</span> <span class="pp">println!</span>(<span class="st">&quot;Something happened {e}&quot;</span>)<span class="op">,</span></span>
<span id="cb28-138"><a href="#cb28-138" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb28-139"><a href="#cb28-139" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h2 id="removing-a-file-in-rust">Removing a File in Rust</h2>
<p><strong>remove_file()</strong><br />
Removes a file from the filesystem. To remove or delete a file in Rust, we can use the method from the std::fs module.</p>
<p>Note that there is no guarantee that the file is immediately deleted (e.g., depending on platform, other open file descriptors may prevent immediate removal).</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::</span>fs<span class="op">;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true"></a>    <span class="co">// Remove a file</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true"></a>    <span class="pp">fs::</span>remove_file(<span class="st">&quot;data.txt&quot;</span>)<span class="op">.</span>expect(<span class="st">&quot;could not remove file&quot;</span>)<span class="op">;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true"></a>    </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;Removed file data.txt&quot;</span>)<span class="op">;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h2 id="serde">Serde</h2>
<p>Serde is “a framework for serializing and deserializing Rust data structures efficiently and generically.”</p>
<pre><code>Rust structure 
  ↓
  -- Serialize --&gt; Structure in terms of the Serde data model*
  ↓
  -- Data format (JSON/Bincode/etc) --&gt; Convert the Serde data model to the output format</code></pre>
<p>*The Serde data model is a simplified form of Rust’s type system. In the case of most Rust types, their mapping into the Serde data model is straightforward.</p>
<h3 id="using-derive">Using derive</h3>
<p>Serde provides a derive macro to generate implementations of the Serialize and Deserialize traits for data structures defined in your crate, allowing them to be represented conveniently in all of Serde’s data formats.</p>
<p>To use <code>#[derive(Serialize, Deserialize)]</code> in the code,</p>
<ul>
<li>Add serde = { version = “1.0”, features = [“derive”] } as a dependency in Cargo.toml.</li>
<li>Ensure that all other Serde-based dependencies (for example serde_json) are on a version that is compatible with serde 1.0.</li>
<li>On structs and enums that you want to serialize, import the derive macro as use serde::Serialize; within the same module and write #[derive(Serialize)] on the struct or enum.</li>
<li>Similarly <em>import</em> <code>use serde::Deserialize;</code> and write <code>#[derive(Deserialize)]</code> on structs and enums that you want to deserialize.</li>
</ul>
<p>So in <code>Cargo.toml</code> we have:</p>
<pre class="toml"><code>...
[dependencies]
serde = { version = &quot;1.0&quot;, features = [&quot;derive&quot;] }

# serde_json is just for the example, not required in general
serde_json = &quot;1.0&quot;
...</code></pre>
<p>Usage example</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">serde::</span><span class="op">{</span>Serialize<span class="op">,</span> Deserialize<span class="op">};</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true"></a><span class="at">#[</span>derive<span class="at">(</span>Serialize<span class="op">,</span> Deserialize<span class="op">,</span> <span class="bu">Debug</span><span class="at">)]</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true"></a><span class="kw">struct</span> Point <span class="op">{</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true"></a>    x<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true"></a>    y<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true"></a>    <span class="kw">let</span> point <span class="op">=</span> Point <span class="op">{</span> x<span class="op">:</span> <span class="dv">1</span><span class="op">,</span> y<span class="op">:</span> <span class="dv">2</span> <span class="op">};</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true"></a>    <span class="kw">let</span> serialized <span class="op">=</span> <span class="pp">serde_json::</span>to_string(<span class="op">&amp;</span>point)<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;serialized = {}&quot;</span><span class="op">,</span> serialized)<span class="op">;</span>  </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true"></a>    <span class="co">// Output: serialized = {&quot;x&quot;:1,&quot;y&quot;:2}</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true"></a>    <span class="kw">let</span> deserialized<span class="op">:</span> Point <span class="op">=</span> <span class="pp">serde_json::</span>from_str(<span class="op">&amp;</span>serialized)<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true"></a>    <span class="pp">println!</span>(<span class="st">&quot;deserialized = {:?}&quot;</span><span class="op">,</span> deserialized)<span class="op">;</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true"></a>    <span class="co">// Output: deserialized = Point { x: 1, y: 2 }</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>Run it</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a>$ <span class="ex">cargo</span> run</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a><span class="ex">serialized</span> = <span class="dt">{&quot;x&quot;:1,&quot;y&quot;:2}</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a><span class="ex">deserialized</span> = Point { x: 1, y: 2 }</span></code></pre></div>
<p>Note:</p>
<p><em>Sometimes you may see compile-time errors that tell you:<br/><br/>the trait <code>serde::ser::Serialize</code> is not implemented for <code>...</code><br/><br/>even though the struct or enum clearly has #[derive(Serialize)] on it.</em> <br/> <em>This almost always means that you are using libraries that depend on incompatible versions of Serde. You may be depending on serde 1.0 in your Cargo.toml but using some other library that depends on serde 0.9. So the Serialize trait from serde 1.0 may be implemented, but the library expects an implementation of the Serialize trait from serde 0.9. From the Rust compiler’s perspective these are totally different traits.</em> <br/><br/> <em>The fix is to upgrade or downgrade libraries as appropriate until the Serde versions match. The cargo tree -d command is helpful for finding all the places that duplicate dependencies are being pulled in.</em></p>
<p>_ <a href="https://serde.rs/derive.html">serde.rs doc</a></p>
<h2 id="replacing-command-line-curl-with-rust-reqwest-tokio">Replacing command-line <code>curl</code> with Rust <code>reqwest</code> &amp; <code>tokio</code></h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a><span class="ex">curl</span> <span class="st">&quot;https://api.open-meteo.com/v1/forecast?latitude=52.52&amp;longitude=13.41&amp;current=temperature_2m,wind_speed_10m&amp;hourly=temperature_2m,relative_humidity_2m,wind_speed_10m&quot;</span></span></code></pre></div>
<p>The reqwest crate provides a convenient, higher-level HTTP Client.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">reqwest::</span><span class="op">{</span>Client<span class="op">,</span> <span class="bu">Error</span><span class="op">};</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true"></a><span class="kw">async</span> <span class="kw">fn</span> meteo() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="bu">Error</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true"></a>    <span class="kw">const</span> URL1<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span> <span class="op">=</span> <span class="st">&quot;https://api.open-meteo.com/v1/forecast?latitude=-18.879190&amp;longitude=47.507904&amp;current=temperature_2m,wind_speed_10m&quot;</span><span class="op">;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true"></a>    <span class="kw">match</span> <span class="pp">reqwest::</span>get(URL1)<span class="op">.</span><span class="kw">await</span> <span class="op">{</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true"></a>        <span class="cn">Ok</span>(resp) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true"></a>            <span class="kw">let</span> antananarivo<span class="op">:</span> OpenMeteo <span class="op">=</span> resp<span class="op">.</span>json()<span class="op">.</span><span class="kw">await</span><span class="op">?;</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true"></a>             <span class="co">//= serde_json::from_str(&amp;json).unwrap();</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true"></a>            <span class="co">//println!(&quot;Antananarivo\n{:#?}&quot;, antananarivo)</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true"></a>            <span class="pp">println!</span>(<span class="st">&quot;Antananarivo</span><span class="sc">\n</span><span class="st"> current weather is {}{}&quot;</span><span class="op">,</span> </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true"></a>                antananarivo<span class="op">.</span>current<span class="op">.</span>temperature_2m<span class="op">,</span> </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true"></a>                antananarivo<span class="op">.</span>current_units<span class="op">.</span>temperature_2m)<span class="op">;</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true"></a>        <span class="cn">Err</span>(err) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true"></a>            <span class="pp">println!</span>(<span class="st">&quot;Reqwest Error: {}&quot;</span><span class="op">,</span> err)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true"></a><span class="co">// tokio let&#39;s us use &quot;async&quot; on our main function</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true"></a><span class="at">#[</span><span class="pp">tokio::</span>main<span class="at">]</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true"></a><span class="kw">async</span> <span class="kw">fn</span> main() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="bu">Error</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true"></a></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true"></a>    meteo()<span class="op">.</span><span class="kw">await</span><span class="op">?;</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true"></a></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<p>In Cargo.toml</p>
<pre class="toml"><code>[dependencies]
reqwest = { version = &quot;0.11.23&quot;, features = [&quot;json&quot;] } # reqwest with JSON parsing support
#serde = { version = &quot;1.0.193&quot;, features = [&quot;derive&quot;] }
#serde_json = &quot;1.0.108&quot;
tokio = { version = &quot;1.35.1&quot;, features = [&quot;full&quot;] } # for our async runtime
</code></pre>
<hr />
</main>
<script src="https://lerina.github.io/js/toc.js"></script>
<script>
let anchor= document.createElement('a');
anchor.href="javascript:closeNav()"; //void(0)"; //anchor[0].onclick = closeNav();
anchor.className = "closebtn";  
anchor.innerHTML="&times;";
document.getElementById("TOC").prepend(anchor);

let navCrumbs= document.createElement('div');
navCrumbs.className = "hover-nav";
navCrumbs.innerHTML = `
<div class="hover-nav">
<ul>
<li><a href="../../../index.html">⇦ home</a></li>
<li><a href="../index.html">code</a></li>
</ul>
</div>`;
document.getElementById("TOC").prepend(navCrumbs); 
</script>
</body>
</html>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>80_s_Style 80_s_Style</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="https://lerina.github.io/css/styles_min.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#problem-statement" id="toc-problem-statement">Problem
Statement</a></li>
<li><a href="#a-summary-of-simple-in-ten-steps"
id="toc-a-summary-of-simple-in-ten-steps">4 A Summary of SIMPLE in Ten
Steps</a></li>
</ul>
</nav>
<h2 id="problem-statement">Problem Statement</h2>
<p>Here is the COP (Challenge, Opportunity, Problem).</p>
<blockquote>
<p>The simple warehouse program is an information system for managing
the contents of a storage facility for different kinds of wares. Every
ware in the warehouse has a name, a description, a storage location, a
pricetag, information about the number of items of the particular ware
stored in the warehouse, and the cost of each item. A storage location
is a “section” (a single letter a-z), plus a shelf (an integer).</p>
</blockquote>
<p>The simple warehouse program manages a database of wares and supports
the following operations:</p>
<ul>
<li>Adding a ware</li>
<li>Removing a ware</li>
<li>Editing the information about a ware</li>
<li>Printing the information for a specific ware</li>
<li>Listing all wares in the database</li>
<li>Undoing the last action</li>
<li>Quitting the program</li>
</ul>
<p>When <strong>starting</strong> the program, the user is presented
with the main menu with the above alternatives and picks a choice by
entering the first letter of each alternative, i.e., <code>A</code>,
<code>R</code>, <code>E</code>, <code>P</code>, <code>L</code>,
<code>U</code>, or <code>Q</code>.</p>
<p>When choosing to <strong>quit</strong>, the user is prompted with a
yes/no question: do you really want to quit? If the answer is
<code>Y</code>, the program exits. If the answer is <code>N</code>, the
program displays the main menu again. If the answer is anything other
than <code>Y</code> or <code>N</code>, an error message is printed and
the question repeated.</p>
<p>When choosing to <strong>add</strong> a ware, the user is prompted
with five consecutive dialogues asking her to enter the required
information for a ware:</p>
<ul>
<li>Name</li>
<li>Description</li>
<li>Storage location</li>
<li>Price</li>
<li>Amount</li>
</ul>
<p>The program then displays the information back to the user and asks
whether this is correct or not. The user has three options:</p>
<ul>
<li><code>E</code>dit the information</li>
<li><code>S</code>ave the information</li>
<li><code>A</code>bort</li>
</ul>
<p>The choice is indicated by entering the first character of each
option. The <em>first alternative</em> allows the user to re-enter one
piece of the required information for a ware after which the editer ware
is displayed again with the same question as above.<br />
The <em>save alternative</em> saves the information to the database and
then returns to the main menu.<br />
The <em>abort alternative</em> returns to the main menu without
saving.</p>
<p>The rest of the actions on the main menu should be fairly
self-explanatory.</p>
<h3 id="textual-analysis">Textual Analysis</h3>
<p>To get a feeling for what the program is trying to accomplish, we
mine the specification. This means re-reading it, looking for some
particular kind of information. To understand the program’s <strong>core
behaviour</strong>, we pay close attention to the verbs and actions.
Underline or highlight them is not a bad idea.</p>
<p>For concreteness, I am copying in parts of the specification from
above, <strong>highlighting</strong> as I go.</p>
<blockquote>
<p>The simple warehouse program is an for … letter a-z), plus a shelf
(an integer).</p>
<p>The simple warehouse program manages a database of wares and supports
the following operations:</p>
<ol type="1">
<li><strong>Adding</strong> a ware</li>
<li><strong>Removing</strong> a ware</li>
<li><strong>Editing</strong> the information about a ware</li>
<li><strong>Printing</strong> the information for a specific ware</li>
<li><strong>Listing</strong> all wares in the database</li>
<li><strong>Undoing</strong> the last action</li>
<li><strong>Quitting</strong> the program</li>
</ol>
<p>When <strong>starting</strong> the program, the user is
<strong>presented</strong> with the main menu with the above
alternatives and <strong>picks a choice</strong> by entering the first
letter of each alternative, i.e., <code>A</code>, <code>R</code>,
<code>E</code>, <code>P</code>, <code>L</code>, <code>U</code>, or
<code>Q</code>.</p>
<p>When <strong>choosing to quit</strong>, the user <strong>is prompted
with a yes/no question</strong>: …</p>
</blockquote>
<p>Objective: See what actions the program should support (textual
analysis, mindmaps, ). At this stage there should be nothing about how
they should be implemented.</p>
<p><strong>Divide &amp; Conquer</strong></p>
<p>Isolate problems and sub-problems</p>
<h3 id="project-setup">Project setup</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> new warehouse</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> warehouse</span></code></pre></div>
<p>We start with the minimal working program.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="pp">println!</span>(<span class="st">&quot;Welcome to my warehouse program!&quot;</span>)<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This program is pretty much hello world,</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run  </span></code></pre></div>
<p>but it <strong>compiles and runs</strong>.</p>
<h3 id="from-reqs-to-rem">From Reqs to REM</h3>
<p>We convert some requirements into comments</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// src/main.rs</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 1.  **Adding** a ware</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 2.  **Removing** a ware</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 3.  **Editing** the information about a ware</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 4.  **Printing** the information for a specific ware</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 5.  **Listing** all wares in the database</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 6.  **Undoing** the last action</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 7.  **Quitting** the program</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Welcome to my warehouse program!&quot;</span>)<span class="op">;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="pick-a-task">Pick a task</h3>
<p>Now, we take the actions from the textual analysis and/or mind-map
and turn them into functions.</p>
<p>For example, for “add”, we do:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 1.  **Adding** a ware</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> add_action() <span class="op">{</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Add action is not implemented yet&quot;</span>)<span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 2. ...</span></span></code></pre></div>
<p>In order to have placeholders for code that we are going to write, we
add similar functions for all the other actions.</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 2.  **Removing** a ware</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> remove_action() <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Remove action is not implemented yet&quot;</span>)<span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 3.  **Editing** the information about a ware</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> edit_action() <span class="op">{</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Edit action is not implemented yet&quot;</span>)<span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 4.  **Printing** the information for a specific ware</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> print_action() <span class="op">{</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Print action is not implemented yet&quot;</span>)<span class="op">;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 5.  **Listing** all wares in the database</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> list_action() <span class="op">{</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;List action is not implemented yet&quot;</span>)<span class="op">;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 6.  **Undoing** the last action</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> undo_action() <span class="op">{</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Undo action is not implemented yet&quot;</span>)<span class="op">;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 7.  **Quitting** the program</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> quit_action() <span class="op">{</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Quit action is not implemented yet&quot;</span>)<span class="op">;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Tip:<br />
<strong>Divide &amp; Conquer</strong><br />
Focus on just one small thing at a time.<br />
<strong>Compile Early. Compile Often.</strong><br />
Do not move on to another function until the program compiles.<br />
<strong>The Compiler Errors are your friends</strong><br />
The Rust compiler is your friend. It will often give you the solution to
your error.</p>
<h3 id="next">Next</h3>
<p>We now have a working program that does absolutely nothing. Let’s
start adding some functionality to our program following the
specification.</p>
<p>The first six action all require either that there is some data in
the program, or that we are able to add some data. We haven’t done any
data design yet, so if we want to start with these, we should that.
However, the last action, quitting, is very simple and does not do much
so that is a good starting point.</p>
<p>We now go back to our mind-map or program outline and extend the
specification of <code>quit</code>.</p>
<p>Re-reading the specification, we now know that triggering quit
should</p>
<ul>
<li>enter into a confirmation dialogue, and</li>
<li>if the user replies <code>Y</code>, then we quit,</li>
<li>if <code>N</code> we return to the main menu,</li>
<li>otherwise repeat the question.</li>
</ul>
<h3 id="code-as-little-as-possible-between-each-compile">Code as little
as possible between each compile</h3>
<p>To keep the program as simple as possible, we are not going to add
functionality for choosing an action in the main menu just yet. That’s
not needed, because the only thing we are going to implement is
quit.</p>
<p>So, although it is futile, let’s extend the program so that when we
run it, it asks if we want to quit.</p>
<p>To this end, we will add a <code>while</code> loop that loops forever
and that in each turn of the loop asks us whether we want to quit.</p>
<p>This will allow us to <em>manualy</em> test both the yes and no
answers.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">loop</span> <span class="op">{</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="pp">println!</span>(<span class="st">&quot;Welcome to my warehouse program!&quot;</span>)<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> quit_action() <span class="op">==</span> <span class="cn">true</span> <span class="op">{</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And we get an error:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="va">error</span><span class="op">[</span>E0308<span class="op">]</span><span class="ex">:</span> mismatched types</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">--</span><span class="op">&gt;</span> src/main.rs:42:29</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="ex">42</span> <span class="kw">|</span>         <span class="cf">if</span> <span class="fu">quit_action()</span> <span class="ex">==</span> true {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span>            <span class="ex">-------------</span>    ^^^^ expected <span class="kw">`()`</span>, found <span class="kw">`</span><span class="ex">bool</span><span class="kw">`</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span>            <span class="kw">|</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">|</span>            <span class="ex">expected</span> because this is <span class="kw">`()`</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="ex">For</span> more information about this error, try <span class="kw">`</span><span class="ex">rustc</span> <span class="at">--explain</span> E0308<span class="kw">`</span>.</span></code></pre></div>
<p><code>quit_action()</code> must first be updated to return a
<code>bool</code>. We fix this with the simplest code to pass the test
by returning <code>false</code> as the default return.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 7.  **Quitting** the program</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> quit_action() <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Quit action is not implemented yet&quot;</span>)<span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">false</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Compile</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> build</span></code></pre></div>
<p>Ok it build.</p>
<p>Run it. <code>ctrl-c to stop</code></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run</span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Welcome</span> to my warehouse program!</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Quit</span> action is not implemented yet</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Welcome</span> to my warehouse program!</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Quit</span> action is not implemented yet</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="ex">^C</span></span></code></pre></div>
<h3 id="next-1">Next</h3>
<p>Our goal now is to implement the behaviour of the specification which
was just re-iterated above. We are going to do this in a few small
increments.</p>
<ul>
<li>Print confirmation question</li>
<li>Read input</li>
<li>Handle <code>Y</code> case</li>
<li>Handle <code>N</code> case</li>
<li>Handle remaining cases</li>
</ul>
<p>Increment 1 is easy. Just change the existing
<code>println!</code></p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 7.  **Quitting** the program</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> quit_action() <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>   <span class="pp">println!</span>(<span class="st">&quot;Do you want to quit? [Y/N]&quot;</span>)<span class="op">;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>   <span class="cn">false</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Increment 2 is harder.</p>
<p>It requires us to know how to read input from a user in Rust. This is
actually pretty complicated and there are many opportunities for errors.
Therefore, <strong>temporarily write-out problems caused by
hard-to-write code</strong> just by delegating it to a yet to be written
function.<br />
In effect pass the buck: <strong>assume the existence of a function that
solves the problem.</strong></p>
<p>This makes increment 2 really simple:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 7.  **Quitting** the program</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> quit_action() <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Do you want to quit? [Y/N]&quot;</span>)<span class="op">;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> input<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> get_char_input()<span class="op">;</span> <span class="co">// &lt;---- This line was added</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">false</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Passing_the_buck</strong> is one of the best tools in the
programming toolbox. You should use it all the time.</p>
<p>The first rule of passing_the_buck is this:</p>
<blockquote>
<p><em>If you don’t know immediately how to solve a problem, assume the
existence of a function that solves this problem for you, and call that
function.</em></p>
</blockquote>
<p>This is great because usually when you are programming, you are going
somewhere and you have a particular <a
href="http://en.wikipedia.org/wiki/Control_flow">control flow</a> in
mind. Getting stuck implementing one step of this flow usually means
your train of thought is interrupted and because your mind is now
focused on solving the current step, you will have a harder time
continuing where you got stuck once you are unstuck.</p>
<p>Like we did with the empty action functions from the start, we add a
dummy function to the file called <code>get_char_input()</code> to stay
true to the ideal of always having a working program:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">TODO</span><span class="co">: implement</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_char_input() <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span> <span class="co">// &lt;-- return type derived </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                               <span class="co">// from the call-site (quit_action())</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Y&quot;</span><span class="op">.</span>to_string()               <span class="co">// &lt;-- a good default because of how </span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>                               <span class="co">// increment 3 is specified</span></span></code></pre></div>
<p>We can now compile and run our program as a kind of minimal testing.
It compiles, it runs.</p>
<p>We can go back to increment 3, which is dealing with the base case of
the user entering a <code>Y</code>:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 7.  **Quitting** the program</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> quit_action() <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Do you want to quit? [Y/N]&quot;</span>)<span class="op">;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> input<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> get_char_input()<span class="op">;</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> input <span class="op">==</span> <span class="st">&quot;Y&quot;</span> <span class="op">{</span> <span class="cf">return</span> <span class="cn">true</span><span class="op">;</span> <span class="op">}</span> <span class="co">// &lt;---- This line was added</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="cn">false</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Increment 4 is dealing with the case of the user inputting a
<code>N</code>. Turns out it is already handled, as the function returns
<code>false</code> as a default.</p>
<p>This leaves us with increment 5, which is the user replying with
something other than <code>Y</code> or <code>N</code>.</p>
<p>Its more work. We must now add a loop to this function to be able to
repeat the question.</p>
<p>We start by wrapping the entire function inside a <code>while</code>.
The exit condition of the <code>while</code> is that input is either
<code>Y</code> or <code>N</code>.</p>
<p>Otherwise, the specification dictates’, an error message shall be
printed and the question shall be asked again indefinitely. Here is a
first attempt at doing this:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 7.  **Quitting** the program</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> quit_action() <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">loop</span> <span class="op">{</span>                                          <span class="co">// &lt;---- This line was added           </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>       <span class="pp">println!</span>(<span class="st">&quot;Do you want to quit? [Y/N]&quot;</span>)<span class="op">;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>       <span class="kw">let</span> input<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> get_char_input()<span class="op">;</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> input <span class="op">==</span> <span class="st">&quot;Y&quot;</span> <span class="op">{</span> <span class="cf">return</span> <span class="cn">true</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>       <span class="cf">if</span> input <span class="op">==</span> <span class="st">&quot;N&quot;</span> <span class="op">{</span> <span class="cf">return</span> <span class="cn">false</span><span class="op">;</span> <span class="op">}</span>           <span class="co">// &lt;---- This line was added</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>       <span class="pp">println!</span>(<span class="st">&quot;Only Y or N are valid answers!&quot;</span>)<span class="op">;</span> <span class="co">// &lt;---- This line was added</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>   <span class="cn">false</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The function is now properly implemented, modulo passing_the_buck to
<code>get_char_input</code> the call to the (yet) non-existent
function.</p>
<h3 id="stepwise-refinement-developing-in-increments">Stepwise
refinement: Developing in Increments</h3>
<p>The <code>quit_action()</code> function was developed in a series of
steps. The choice of the steps was very deliberate. Here are the rules
to follow:</p>
<dl>
<dt>If there is any kind of branching, start with the most basic
interesting case first</dt>
<dd>
In our example, <code>Y</code> and <code>N</code> are equally basic but
only <code>Y</code> leads to something interesting, i.e., exits the
program. The non yes or no cases require retrying which is more
complicated, so we delay those even further. In the end, the order is
<code>Y</code>, <code>N</code>, and “the rest”.
</dd>
<dt>Always finish a straight-line version first</dt>
<dd>
This means that any code that involves loops, you start by focusing on
getting one iteration of the loop working in the working program. Once
that is done, you can more easily wrap the working code inside a loop.
Note that by this rule, the Y case would still be implemented before
“the rest” even if Y called some other functions to save the database
etc.
</dd>
<dt>Each increment should accomplish something sensible</dt>
<dd>
Each increment should result in a working program.
</dd>
<dt>Each increment should ideally have a test that drives the coding or
at the very least</dt>
<dd>
Each increment should ideally have a testable outcome
</dd>
<dd>
<pre><code>For example, when we implemented (skipped...) increment 4, we should also have changed the `get_char_input()` to return N to test this. And similar for increment 5.</code></pre>
</dd>
</dl>
<h3 id="step-5-the-buck-stops-here">Step 5: The buck stops here!</h3>
<p>We finished <code>quit_action()</code>, but mostly because we passed
the buck to a non-existant function. To finish implementing this part of
the program, we will now implement <code>get_char_input()</code>.</p>
<p>However, the reason why we didn’t write this piece of code down
immediately from the start was because we thought it was complicated and
did not know exactly how to do it.</p>
<p>So, how do we proceed now?</p>
<p>Well, we cannot magically suddenly grasp how to read user input. This
knowledge generally comes from somewhere. Let’s cover the three most
basic cases:</p>
<ol type="1">
<li>Google/Stack Exchange (usenet, bbs, in the 80’s)</li>
<li>A text book</li>
<li>Man pages</li>
</ol>
<p>You find interesting code? You try it out!</p>
<p>Here is the golden rule of trying code out: <strong>start with a new
empty file that just tests the code you’re trying to get to
run.</strong></p>
<p>The reason for this is <strong>isolation</strong>. It may be that the
reason why you are stuck on something is because there is an error in
your code somewhere that breaks some part of the code under study. by
isolating the code you are looking at in a single file, there is a lot
less disturbance. You want to be working at all times with the smallest
possible thing that can work. Remember: <em>good programmers like
lazy.</em></p>
<p>If the problem is getting user input, then writing a small test
program for that is easy. To simplify copying the solution across to the
“real program” you can even name the functions right from the start:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> get_char_input() <span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>        <span class="pp">todo!</span>()<span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> main () <span class="op">{</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="pp">println!</span>(<span class="st">&quot;You pressed: &#39;{}&#39;&quot;</span><span class="op">,</span> get_char_input())<span class="op">;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p>This program will call <code>get_char_input()</code> and print out
the character between single quotes to avoid confusion. We can now spend
the next 15 minutes on getting the code that we are finding online to
work in this file, and then simply copy <code>get_char_input()</code>
across to the other Rust file.</p>
<p>Our Spike for example could yield something like this</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">// get_char.rs</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* source inspiration</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">[Rustdoc std::io::stdin](https://doc.rust-lang.org/std/io/struct.Stdin.html)</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">https://www.becomebetterprogrammer.com/rust-read-user-input-stdin/</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::</span>io<span class="op">;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">//use std::result::Result;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">//fn get_char_input() -&gt; Result&lt;String, &amp;&#39;static str&gt; {</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_char_input() <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> user_input <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> stdin <span class="op">=</span> <span class="pp">io::</span>stdin()<span class="op">;</span> <span class="co">// We get `Stdin` here.</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    stdin</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>read_line(<span class="op">&amp;</span><span class="kw">mut</span> user_input)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>expect(<span class="st">&quot;Failed to read line&quot;</span>)<span class="op">;</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">        match user_input.get(0..1) {</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co">            Some(ans) =&gt; Ok(ans.to_string()),</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co">            None =&gt; Err(&quot;something went wrong&quot;),</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co">        }</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">match</span> user_input<span class="op">.</span>get(<span class="dv">0</span><span class="op">..</span><span class="dv">1</span>) <span class="op">{</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Some</span>(ans) <span class="op">=&gt;</span> ans<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>        <span class="cn">None</span> <span class="op">=&gt;</span> <span class="st">&quot; &quot;</span><span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">//}; //.chars().nth(0).ok_or(&quot; &quot;)?;</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Ok(ans.to_string())</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;enter a character&quot;</span>)<span class="op">;</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;the char is {}&quot;</span><span class="op">,</span> get_char_input())<span class="op">;</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">//println!(&quot;the char is {}&quot;, get_char_input().unwrap());</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>compile with</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rustc</span> get_char.rs</span></code></pre></div>
<p>Once it compiles and runs and we can confirm it does the intended job
we can use the cleaned-up code in our project.</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">// src/main.rs</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::</span>io<span class="op">;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_char_input() <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> user_input <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> stdin <span class="op">=</span> <span class="pp">io::</span>stdin()<span class="op">;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    stdin</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>read_line(<span class="op">&amp;</span><span class="kw">mut</span> user_input)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>expect(<span class="st">&quot;Failed to read line&quot;</span>)<span class="op">;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// get the first char in a unicode safe way</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">match</span> user_input<span class="op">.</span>get(<span class="dv">0</span><span class="op">..</span><span class="dv">1</span>) <span class="op">{</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="cn">Some</span>(ans) <span class="op">=&gt;</span> ans<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        <span class="cn">None</span> <span class="op">=&gt;</span> <span class="st">&quot; &quot;</span><span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Now we test our code <code>cargo run</code></p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Welcome</span> to my warehouse program!</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to quit<span class="pp">?</span> [Y/N]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">N</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Welcome</span> to my warehouse program!</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to quit<span class="pp">?</span> [Y/N]</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="ex">2</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Only</span> Y or N are valid answers!</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to quit<span class="pp">?</span> [Y/N]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Y</span></span></code></pre></div>
<p>woot! Progress!</p>
<h3 id="whats-next">What’s next?</h3>
<p>To keep things DRY existed before the acronym was coined. We have
repetitions. In both cases, I have to handle the failure mode, i.e.,
when the user presses something that isn’t part of the protocol.</p>
<p>Time to “factoring out” these repetitions. Thats the term used before
<code>refactoring</code> appeared in the 90’s .</p>
<p>What I want to do now is to improve the code for get_char_input() so
that it can handle the failure for me.</p>
<p>A simple way to do that is to pass both the question and the valid
alternatives to the get_char_input() function to be used like this:</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">// src/main.rs</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::</span>io<span class="op">;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> input <span class="op">=</span> get_char_input(<span class="st">&quot;Do you want to quit?&quot;</span><span class="op">,</span> <span class="st">&quot;YN&quot;</span>)<span class="op">;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> input <span class="op">=</span> get_char_input(<span class="st">&quot;Choose menu item!&quot;</span><span class="op">,</span> <span class="st">&quot;AREPLUQ&quot;</span>)<span class="op">;</span></span></code></pre></div>
<p>We pass <code>get_char_input</code> a dialog message to be printed
let’s call it <code>dialog_msg</code> and a list of possible commands,
let’s call it <code>cmd</code>.</p>
<p>This time</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_char_input(dialog_msg<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> cmd<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;{dialog_msg}&quot;</span>)<span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">loop</span> <span class="op">{</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> <span class="kw">mut</span> user_input <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> stdin <span class="op">=</span> <span class="pp">io::</span>stdin()<span class="op">;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        stdin</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>read_line(<span class="op">&amp;</span><span class="kw">mut</span> user_input)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span>expect(<span class="st">&quot;Failed to read line&quot;</span>)<span class="op">;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// get the first char in a unicode safe way</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> ans <span class="op">=</span> <span class="cf">match</span> user_input<span class="op">.</span>get(<span class="dv">0</span><span class="op">..</span><span class="dv">1</span>) <span class="op">{</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>            <span class="cn">Some</span>(ans) <span class="op">=&gt;</span> ans<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>            <span class="cn">None</span> <span class="op">=&gt;</span> <span class="st">&quot; &quot;</span><span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> cmd<span class="op">.</span>contains(<span class="op">&amp;</span>ans) <span class="op">{</span> <span class="cf">return</span> ans<span class="op">;</span> <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>            <span class="pp">println!</span>(<span class="st">&quot;Only [{cmd}] are valid answers.&quot;</span>)<span class="op">;</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And update quit_action</p>
<p>from</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 7.  **Quitting** the program</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> quit_action() <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">loop</span> <span class="op">{</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> input<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> get_char_input(<span class="st">&quot;Do you want to quit? [Y/N]&quot;</span><span class="op">,</span> <span class="st">&quot;YN&quot;</span>)<span class="op">;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> input <span class="op">==</span> <span class="st">&quot;Y&quot;</span> <span class="op">{</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="cn">true</span><span class="op">;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> input <span class="op">==</span> <span class="st">&quot;N&quot;</span> <span class="op">{</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="cn">false</span><span class="op">;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>to</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 7.  **Quitting** the program</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> quit_action() <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> input<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> get_char_input(<span class="st">&quot;Do you want to quit? [Y/N]&quot;</span><span class="op">,</span> <span class="st">&quot;YN&quot;</span>)<span class="op">;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> input <span class="op">==</span> <span class="st">&quot;Y&quot;</span> <span class="op">{</span> <span class="cf">return</span> <span class="cn">true</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="cn">false</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Great!</p>
<p>Now that we are done with quitting the program, it is time to move on
to the next action.</p>
<p>However, in order to get to the next action, we must first extend the
main loop of the program so that the user can choose between whatever
action we choose to implement next, and quitting.</p>
<p>Looking at the specification, the user’s input is again obtained
reading a character. Great that we have already implemented
get_char_input() to do exactly that.</p>
<p>Following the instructions on how to develop in increments, etc… and
looking at how we implemented the dialogue in quit_action(), we can
relatively quickly write something like this:</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Welcome to my warehouse program!&quot;</span>)<span class="op">;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> should_quit <span class="op">=</span> <span class="cn">false</span><span class="op">;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> should_quit <span class="op">==</span> <span class="cn">false</span> <span class="op">{</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>      print_main_menu()<span class="op">;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> input <span class="op">=</span> get_char_input(<span class="st">&quot;Choose menu item!&quot;</span><span class="op">,</span> <span class="st">&quot;AREPLUQ&quot;</span>)<span class="op">;</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> input <span class="op">==</span> <span class="st">&quot;A&quot;</span>        <span class="op">{</span> add_action()<span class="op">;</span> <span class="op">}</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> <span class="cf">if</span> input <span class="op">==</span> <span class="st">&quot;Q&quot;</span>   <span class="op">{</span> should_quit <span class="op">=</span> quit_action()<span class="op">;</span> <span class="op">}</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>                   <span class="op">{</span> <span class="pp">println!</span>(<span class="st">&quot;Invalid choice!&quot;</span>)<span class="op">;</span> <span class="op">}</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>We print the main menu, make a call to get_char_input() to get the
user input. We change the loop to use a <code>should_quit</code>
variable to control whether the main loop should continue or not.</p>
<p>Now lets have a full menu.</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> print_main_menu()<span class="op">{</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;--- Main menu ---</span><span class="sc">\n</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//&gt; 1.  **Adding** a ware</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;[A]dd a ware&quot;</span>)<span class="op">;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//&gt; 2.</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;[R]emove a ware&quot;</span>)<span class="op">;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">//&gt; 3.</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;[E]dit the information about a ware&quot;</span>)<span class="op">;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">//&gt; 4.</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;[P]rint the information for a specific ware&quot;</span>)<span class="op">;</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">//&gt; 5.  </span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;[L]ist all wares in the database&quot;</span>)<span class="op">;</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">//&gt; 6.  </span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;[U]ndo the last action&quot;</span>)<span class="op">;</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">//&gt; 7.  </span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;[Q]uit the program&quot;</span>)<span class="op">;</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And use it in our main loop. Lets also refactor these If conditions
and replace it with a more idiomatic Rust code</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Welcome to my warehouse program!&quot;</span>)<span class="op">;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> should_quit <span class="op">=</span> <span class="cn">false</span><span class="op">;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> should_quit <span class="op">==</span> <span class="cn">false</span> <span class="op">{</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>      print_main_menu()<span class="op">;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">match</span> get_char_input(<span class="st">&quot;Choose menu item!&quot;</span><span class="op">,</span> <span class="st">&quot;AREPLUQ&quot;</span>) <span class="op">{</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;A&quot;</span> <span class="op">=&gt;</span> add_action()<span class="op">,</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;R&quot;</span> <span class="op">=&gt;</span> remove_action()<span class="op">,</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;E&quot;</span> <span class="op">=&gt;</span> edit_action()<span class="op">,</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;P&quot;</span> <span class="op">=&gt;</span> print_action()<span class="op">,</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;L&quot;</span> <span class="op">=&gt;</span> list_action()<span class="op">,</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;U&quot;</span> <span class="op">=&gt;</span> undo_action()<span class="op">,</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Q&quot;</span> <span class="op">=&gt;</span>  should_quit <span class="op">=</span> quit_action()<span class="op">;</span> <span class="op">,</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>            _ <span class="op">=&gt;</span>  <span class="pp">println!</span>(<span class="st">&quot;Invalid choice!&quot;</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>We get an error. get_char_input returns a string.</p>
<p>rather than elevating to a String each menu choice as in
<code>"Q".to_string()</code><br />
we can do use
<code>&amp;get_char_input("Choose menu item!", "AREPLUQ")[0..]</code></p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Welcome to my warehouse program!&quot;</span>)<span class="op">;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> should_quit <span class="op">=</span> <span class="cn">false</span><span class="op">;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> should_quit <span class="op">==</span> <span class="cn">false</span> <span class="op">{</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>      print_main_menu()<span class="op">;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">match</span> <span class="op">&amp;</span>get_char_input(<span class="st">&quot;Choose menu item!&quot;</span><span class="op">,</span> <span class="st">&quot;AREPLUQ&quot;</span>)[<span class="dv">0</span><span class="op">..</span>] <span class="op">{</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;A&quot;</span> <span class="op">=&gt;</span> add_action()<span class="op">,</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;R&quot;</span> <span class="op">=&gt;</span> remove_action()<span class="op">,</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;E&quot;</span> <span class="op">=&gt;</span> edit_action()<span class="op">,</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;P&quot;</span> <span class="op">=&gt;</span> print_action()<span class="op">,</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;L&quot;</span> <span class="op">=&gt;</span> list_action()<span class="op">,</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;U&quot;</span> <span class="op">=&gt;</span> undo_action()<span class="op">,</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Q&quot;</span> <span class="op">=&gt;</span>  should_quit <span class="op">=</span> quit_action()<span class="op">,</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>            _ <span class="op">=&gt;</span>  <span class="pp">println!</span>(<span class="st">&quot;Invalid choice!&quot;</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Great! It runs</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span> Main menu <span class="at">---</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[A]dd</span> a ware</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[R]emove</span> a ware</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="ex">[E]dit</span> the information about a ware</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[P]rint</span> the information for a specific ware</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="ex">[L]ist</span> all wares in the database</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="ex">[U]ndo</span> the last action</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="ex">[Q]uit</span> the program</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Choose</span> menu item!</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Q</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to quit<span class="pp">?</span> [Y/N]</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Y</span></span></code></pre></div>
<p>Let’s change the confirmation question</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> quit_action() <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> input<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> get_char_input(<span class="st">&quot;Do you Really want to quit? [Y/N]&quot;</span><span class="op">,</span> <span class="st">&quot;YN&quot;</span>)<span class="op">;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<p>What’s next?</p>
<blockquote>
<p>“Bad programmers worry about the code. Good programmers worry about
data structures and their relationships.” _ Linus Torvalds</p>
</blockquote>
<p>Let’s proceed with adding a ware. Editing, removing, listing,
undoing, etc. all presuppose the existence of some data in the database.
Wemight as well have a “database” and add things into it first.</p>
<p>Anyways, adding something new is often simpler than editing or
removing. This makes it a no brainer good place to start.</p>
<p>We go back to the specification again, and read about the add action.
We extend our mind-map accordingly:</p>
<pre><code>                             .-- Add all ware data
main_menu ------|-- Add ----/--- Display the result
                |           \
                |            `-- Ask confirmation (save/edit/abort)
                ⋮
                |-- Quit ------- Comfirmation dialog</code></pre>
<p>To understand a program’s core data, we simply <strong>mine the
specification</strong> again, this time looking for <a
href="http://en.wikipedia.org/wiki/Noun">nouns</a>.</p>
<p>Let’s do that now!</p>
<p>Again, for concreteness, I am copying in the specification and
highlighting as I go:</p>
<blockquote>
<p>Every <strong>ware</strong> in the warehouse has a
<strong>name</strong>, a <strong>description</strong>, a <strong>storage
location</strong>, a <strong>pricetag</strong>, information about the
<strong>number of items</strong> of the particular wares stored in the
warehouse, and the <strong>cost of each item</strong>. A storage
location is a <strong>section</strong> (a single letter a-z), plus a
<strong>shelf</strong> (an integer).</p>
<p>The simple warehouse program manages a <strong>database</strong> of
wares and supports the following operations:</p>
<ol type="1">
<li>Adding a <strong>ware</strong></li>
<li>Removing a <strong>ware</strong></li>
<li>Editing the information about a <strong>ware</strong></li>
<li>Printing the information for a specific <strong>ware</strong></li>
<li>Listing all wares in the <strong>database</strong></li>
<li>Undoing the last <strong>action</strong></li>
<li>Quitting the program</li>
</ol>
</blockquote>
<p>Looking at the highlighted information above, and reading the
surrounding text, a pattern emerges.</p>
<p>There is a <strong>database</strong>, which stores
<strong>wares</strong>, that each store name, description, storage
location, pricetag, and number of items.</p>
<pre><code>database {
    ware,
    ware, 
    ...
}</code></pre>
<p>There is also a mentioning of <strong>action</strong>, which makes
sense: in order to undo an action, we need to somehow record what the
program did just before, and enough information to undo it.</p>
<p>We don’t know exactly what this information is yet, but that’s
fine.</p>
<p>It probably does not make sense to implement <code>undo</code> until
there are actions to be undone.</p>
<p>The specification gives us a (mostly) very good idea for a data type
for <strong>ware</strong>. - Name and description are clearly strings. -
Price and number of items (which I will be calling amount from now on)
are clearly integers.</p>
<p>The storage location is less clear, however.<br />
Rather that getting stuck on this detail,<br />
let’s pass_the_buck and assume that there is a type
<code>Storage_location_t</code> that solves the problem.</p>
<p>Now, we can write the type for ware:</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Ware <span class="op">{</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  name<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  description<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  storage_location<span class="op">:</span> Storage_location_t<span class="op">,</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  price<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  amount<span class="op">:</span> <span class="dt">i32</span><span class="op">,</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>By pass_the_buck, we now have a type <code>ware</code>. However, in
the interest of making progress and working in an incremental fashion,
we are also going to apply another great simplification trick:
<strong>dodging</strong>.</p>
<p>Getting information from the user at all is a great first step in an
incremental development methodology. Once that is done and works, we can
start caring about making sure that the information is correct.</p>
<p>It is time to <strong>dodge</strong>.</p>
<p>Dodging means <strong>temporarily</strong> simplifying the
specification.</p>
<p>In the current example, a good dodge is to say: for now, I am going
to only store string data in wares, and worry about integers and storage
locations later.</p>
<p>This allows us to use a single function for reading input from the
user to complete the entire specification for adding a ware, modulo
saving it to the database.</p>
<p>Temporarily, we change to type of <code>ware</code> to this:</p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Ware <span class="op">{</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    name<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    description<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    storage_location<span class="op">:</span> <span class="dt">String</span><span class="op">,</span> <span class="co">// </span><span class="al">TODO</span><span class="co">: storage_location_t, </span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    price<span class="op">:</span> <span class="dt">String</span><span class="op">,</span>            <span class="co">// </span><span class="al">TODO</span><span class="co">: i32,</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    amount<span class="op">:</span> <span class="dt">String</span><span class="op">,</span>           <span class="co">// </span><span class="al">TODO</span><span class="co">: i32,</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And then we can make a version of <code>get_char_input()</code>, for
example <code>get_string_input()</code>. We will probably also
pass_the_buck here and assume its existence on the first pass through
the code. We will also assume the existence of a
<code>add_to_db()</code> function, which does nothing except prints out
the obligatory disclaimer of it not yet being implemented.</p>
<p>Here is a list of suitable steps for almost implementing the
simplified <code>add_action()</code>. Each step notably results in a
program that can compile and run, but probably does not do anything
useful.</p>
<ol type="1">
<li>Read all the inputs as strings and save them into a ware object,
assuming the existance of several functions (This could quite possibly
be several increments.):
<ol type="a">
<li><code>get_string_input()</code>,</li>
</ol></li>
</ol>
<div class="sourceCode" id="cb38"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_string_input(dialog_msg<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;{dialog_msg}&quot;</span>)<span class="op">;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> user_input <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> stdin <span class="op">=</span> <span class="pp">io::</span>stdin()<span class="op">;</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    stdin</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>read_line(<span class="op">&amp;</span><span class="kw">mut</span> user_input)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>expect(<span class="st">&quot;Failed to read line&quot;</span>)<span class="op">;</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    user_input<span class="op">.</span>trim()<span class="op">.</span>to_string()    </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>We check if it builds <code>cargo build</code>. Great it builds.
Next:</p>
<pre><code>b. `print_ware()` (to print a ware to the user before answering the save, edit, abort), </code></pre>
<p>We can make a print_ware() function that takes a Ware type as a
parameter or we go the idiomatic way and give Ware the method
<code>print_ware()</code>. Let’s go idiomatic, and also give it a
constructor</p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> Ware <span class="op">{</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> new( name<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>            description<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>            storage_location<span class="op">:</span> <span class="dt">String</span><span class="op">,</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>            price<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>            amount<span class="op">:</span> <span class="dt">String</span><span class="op">,</span>) <span class="op">-&gt;</span> <span class="dt">Self</span> <span class="op">{</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        Ware <span class="op">{</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>            name<span class="op">,</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>            description<span class="op">,</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>            storage_location<span class="op">,</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>            price<span class="op">,</span> </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>            amount<span class="op">,</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">//multi line printing is a bit messy</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> print_ware(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>        <span class="pp">println!</span>(<span class="st">&quot;</span><span class="sc">\</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="st">name: {}</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="st">description: {}</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="st">storage_location: {}</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="st">price: {}</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a><span class="st">amount: {}</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">,</span>          <span class="kw">self</span><span class="op">.</span>name<span class="op">,</span> <span class="kw">self</span><span class="op">.</span>description<span class="op">,</span> </span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>            <span class="kw">self</span><span class="op">.</span>storage_location<span class="op">,</span> </span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">self</span><span class="op">.</span>price<span class="op">,</span> <span class="kw">self</span><span class="op">.</span>amount)<span class="op">;</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span><span class="co">//^-- fn print_ware</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Lets try using these in <code>add_action</code></p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 1.  **Adding** a ware</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> add_action() <span class="op">{</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Add action simulation&quot;</span>)<span class="op">;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> item <span class="op">=</span> <span class="pp">Ware::</span>new(<span class="st">&quot;laptop&quot;</span><span class="op">.</span>to_string()<span class="op">,</span> </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Top of the line gamer ware&quot;</span><span class="op">.</span>to_string()<span class="op">,</span> </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;a2&quot;</span><span class="op">.</span>to_string()<span class="op">,</span> <span class="co">//A storage location is a **section** (a single letter a-z), </span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                                                <span class="co">//plus a **shelf** (an integer). </span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;1240.00&quot;</span><span class="op">.</span>to_string()<span class="op">,</span> </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;1&quot;</span><span class="op">.</span>to_string())<span class="op">;</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span>print_ware()<span class="op">;</span> </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Compile. Still good.</p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Welcome</span> to my warehouse program!</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="ex">---</span> Main menu <span class="at">---</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="ex">[A]dd</span> a ware</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="ex">[R]emove</span> a ware</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="ex">[E]dit</span> the information about a ware</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="ex">[P]rint</span> the information for a specific ware</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="ex">[L]ist</span> all wares in the database</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="ex">[U]ndo</span> the last action</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="ex">[Q]uit</span> the program</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Choose</span> menu item!</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="ex">A</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Add</span> action simulation</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="ex">name:</span> laptop</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="ex">description:</span> Top of the line gamer ware</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="ex">storage_location:</span> a2</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a><span class="ex">price:</span> 1240.00</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="ex">amount:</span> 1</span></code></pre></div>
<p>Great!</p>
<pre><code>c. `edit_ware()`, (for when the user selects edit above) and </code></pre>
<p>We’re going to use another dummy ware item for
<code>edit_action</code>. We migh as well extract a function that we can
use in both <code>Add</code> and <code>Edit</code>.</p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> make_dummy_item() <span class="op">-&gt;</span> Ware <span class="op">{</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">Ware::</span>new(<span class="st">&quot;laptop&quot;</span><span class="op">.</span>to_string()<span class="op">,</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;Top of the line gamer ware&quot;</span><span class="op">.</span>to_string()<span class="op">,</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;a2&quot;</span><span class="op">.</span>to_string()<span class="op">,</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;1240.00&quot;</span><span class="op">.</span>to_string()<span class="op">,</span> </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;1&quot;</span><span class="op">.</span>to_string()</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And <code>Edit_action</code> looks like this</p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">//&gt; 3.  **Editing** the information about a ware</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> edit_action() <span class="op">{</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Edit action simulation&quot;</span>)<span class="op">;</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> item <span class="op">=</span> make_dummy_item()<span class="op">;</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Item before edit:&quot;</span>)<span class="op">;</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span>print_ware()<span class="op">;</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">&quot;name&quot;</span><span class="op">,</span> <span class="st">&quot;description&quot;</span><span class="op">,</span> <span class="st">&quot;location&quot;</span><span class="op">,</span> <span class="st">&quot;price&quot;</span><span class="op">,</span> <span class="st">&quot;amount&quot;</span>] <span class="op">{</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> ans <span class="op">=</span> get_string_input(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;New {}: (enter/return to skip)&quot;</span><span class="op">,</span> k))<span class="op">;</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ans <span class="op">!=</span><span class="st">&quot;&quot;</span> <span class="op">{</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">match</span> k <span class="op">{</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;name&quot;</span> <span class="op">=&gt;</span> item<span class="op">.</span>name <span class="op">=</span> ans<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;description&quot;</span> <span class="op">=&gt;</span> item<span class="op">.</span>description <span class="op">=</span> ans<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;location&quot;</span> <span class="op">=&gt;</span> item<span class="op">.</span>storage_location <span class="op">=</span> ans<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;price&quot;</span> <span class="op">=&gt;</span> item<span class="op">.</span>price <span class="op">=</span> ans<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;amount&quot;</span> <span class="op">=&gt;</span> item<span class="op">.</span>amount <span class="op">=</span> ans<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>                _ <span class="op">=&gt;</span> ()<span class="op">,</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Item after edit:&quot;</span>)<span class="op">;</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span>print_ware()<span class="op">;</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<pre><code>d. `add_to_db()`.</code></pre>
<p>We have no db. Will use the file system to store our data in a text
file. We are going to save an item as a string in the text file. The
first thig we can notice is that we have something similar.
<code>print_ware</code> How about we create a
<code>ware_to_string</code> function and use that in print_ware, so we
can extract the functionality without breaking anything.</p>
<div class="sourceCode" id="cb47"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> print_ware(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>        <span class="pp">println!</span>(<span class="st">&quot;{}&quot;</span><span class="op">,</span> <span class="kw">self</span><span class="op">.</span>ware_to_string())<span class="op">;</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> ware_to_string(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>        <span class="pp">format!</span>(<span class="st">&quot;</span><span class="sc">\</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="st">name: {}</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="st">description: {}</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="st">storage_location: {}</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="st">price: {}</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="st">amount: {}</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span><span class="op">,</span>          <span class="kw">self</span><span class="op">.</span>name<span class="op">,</span> <span class="kw">self</span><span class="op">.</span>description<span class="op">,</span> </span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>            <span class="kw">self</span><span class="op">.</span>storage_location<span class="op">,</span> </span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">self</span><span class="op">.</span>price<span class="op">,</span> <span class="kw">self</span><span class="op">.</span>amount)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span><span class="co">//^-- fn ware_to_string</span></span></code></pre></div>
<p><code>cargo run</code> everything should still be ok.</p>
<p>Now we can use <code>ware_to_string</code> to generate the string to
be save in a file.</p>
<div class="sourceCode" id="cb48"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::io::</span><span class="op">{</span><span class="bu">Read</span><span class="op">,</span> <span class="bu">Write</span><span class="op">};</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> add_to_db(item<span class="op">:</span> Ware) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> <span class="pp">std::io::</span><span class="bu">Error</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// open the db file</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> f <span class="op">=</span> <span class="pp">std::fs::OpenOptions::</span>new()</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>write(<span class="cn">true</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>read(<span class="cn">true</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>open(<span class="st">&quot;db.txt&quot;</span>)<span class="op">?;</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// read its content into a new string</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> content <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    f<span class="op">.</span>read_to_string(<span class="op">&amp;</span><span class="kw">mut</span> content)<span class="op">?;</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// append new item &amp; save to file    </span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    content<span class="op">.</span>push_str(<span class="op">&amp;</span>item<span class="op">.</span>ware_to_string())<span class="op">;</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// add delimiter</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    content<span class="op">.</span>push_str(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="pp">writeln!</span>(f<span class="op">,</span> <span class="st">&quot;{}&quot;</span><span class="op">,</span> content)<span class="op">;</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> add_action() <span class="op">{</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Add action simulation&quot;</span>)<span class="op">;</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> item <span class="op">=</span> make_dummy_item()<span class="op">;</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span>print_ware()<span class="op">;</span></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">let</span> <span class="cn">Err</span>(e) <span class="op">=</span> add_to_db(item) <span class="op">{</span> <span class="co">// consume it  </span></span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>        <span class="pp">eprintln!</span>(<span class="st">&quot;Couldn&#39;t write to file: {}&quot;</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Next we can stop using the dummy item and ask the user to enter the
real data We need to ask for this in both Add and Edit. lets extract
it</p>
<div class="sourceCode" id="cb49"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> user_input(item<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Ware)<span class="op">{</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="kw">in</span> [<span class="st">&quot;name&quot;</span><span class="op">,</span> <span class="st">&quot;description&quot;</span><span class="op">,</span> <span class="st">&quot;location&quot;</span><span class="op">,</span> <span class="st">&quot;price&quot;</span><span class="op">,</span> <span class="st">&quot;amount&quot;</span>] <span class="op">{</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> ans <span class="op">=</span> get_string_input(<span class="op">&amp;</span><span class="pp">format!</span>(<span class="st">&quot;New {}: (enter/return to skip)&quot;</span><span class="op">,</span> k))<span class="op">;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ans <span class="op">!=</span><span class="st">&quot;&quot;</span> <span class="op">{</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">match</span> k <span class="op">{</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;name&quot;</span> <span class="op">=&gt;</span> item<span class="op">.</span>name <span class="op">=</span> ans<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;description&quot;</span> <span class="op">=&gt;</span> item<span class="op">.</span>description <span class="op">=</span> ans<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;location&quot;</span> <span class="op">=&gt;</span> item<span class="op">.</span>storage_location <span class="op">=</span> ans<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;price&quot;</span> <span class="op">=&gt;</span> item<span class="op">.</span>price <span class="op">=</span> ans<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;amount&quot;</span> <span class="op">=&gt;</span> item<span class="op">.</span>amount <span class="op">=</span> ans<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>                _ <span class="op">=&gt;</span> ()<span class="op">,</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And use like this</p>
<div class="sourceCode" id="cb50"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> add_action() <span class="op">{</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Add action&quot;</span>)<span class="op">;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//let item = make_dummy_item();</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> item <span class="op">=</span> <span class="pp">Ware::</span>new(<span class="st">&quot;name: &quot;</span><span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;description: &quot;</span><span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;storage_location: &quot;</span><span class="op">.</span>to_string()<span class="op">,</span> </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;price: &quot;</span><span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;amount: &quot;</span><span class="op">.</span>to_string()</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    user_input(<span class="op">&amp;</span><span class="kw">mut</span> item)<span class="op">;</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span>print_ware()<span class="op">;</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">let</span> <span class="cn">Err</span>(e) <span class="op">=</span> add_to_db(item) <span class="op">{</span> <span class="co">// consume it  </span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>        <span class="pp">eprintln!</span>(<span class="st">&quot;Couldn&#39;t write to file: {}&quot;</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> edit_action() <span class="op">{</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Edit action simulation&quot;</span>)<span class="op">;</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> item <span class="op">=</span> make_dummy_item()<span class="op">;</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Item before edit:&quot;</span>)<span class="op">;</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span>print_ware()<span class="op">;</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    user_input(<span class="op">&amp;</span><span class="kw">mut</span> item)<span class="op">;</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Item after edit:&quot;</span>)<span class="op">;</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>    item<span class="op">.</span>print_ware()<span class="op">;</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Edit also needs to save to the db file. But its needs to know where
it found the data to save. Its seems we need to make
<code>add_to_db</code> read the db and put each <em>record</em> in a
string.</p>
<p>We give Ware the ability to turn its self into a record</p>
<pre><code>   fn to_record(&amp;self) -&gt; String {

        format!(&quot;{};{};{};{};{}&quot;, 
                self.name,
                self.description,
                self. storage_location, 
                self.price,
                self.amount
        )
    }    </code></pre>
<p>A new function <code>read_db</code> should read the db and return a
vector of Strings.</p>
<div class="sourceCode" id="cb52"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> read_db() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">,</span> <span class="pp">std::io::</span><span class="bu">Error</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> f <span class="op">=</span> <span class="pp">std::fs::OpenOptions::</span>new()</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>write(<span class="cn">true</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>create(<span class="cn">true</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>read(<span class="cn">true</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>open(<span class="st">&quot;db.txt&quot;</span>)<span class="op">?;</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> content <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    f<span class="op">.</span>read_to_string(<span class="op">&amp;</span><span class="kw">mut</span> content)<span class="op">?;</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Ok</span>(content)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<!-- WE WENT TOO FAST. DO EDIT name ONLY first, no loop.  
4.  In 1. above, we are writing straight-line code. No loops, and the
    only branching is the calls to `edit_ware()` and `add_to_db()` based
    on the users input. This means we do not yet implement the case
    where the user makes an edit, gets a printout and makes the edit
    again. This support we add in this step.
-->
<ol start="5" type="1">
<li><p>Make price and amount ints in ware and replace the two calls to
<code>get_string_input()</code> with calls to an assumed
<code>get_int_input()</code>.</p></li>
<li><p>Implement <code>get_int_input()</code>.</p></li>
<li><p>Decide how to do the storage location. And implement that. This
is likely several steps given that we cheated on the type for storage
location before.</p></li>
</ol>
<p>The last thing we will do is to deal with the database – a final
piece of the puzzle missing to finish this action.</p>
<p>Attention</p>
<p><strong>Multiple Possible Ways Forward</strong></p>
<p>Undo is a good example of a choice in how we choose to go
forward.</p>
<p>For example, we could chose to implement undo for each action that we
implement, i.e,. after add we implement undo add, after edit we
implement undo edit, etc.</p>
<p>Or we simply wait until all actions are implemented and implement
undo for all of them in a single hit.</p>
<p>There is no right or wrong here, just two different ways of working,
each with its own merit.</p>
<p>For example, it is easy to argue that implementing undo X right after
implementing X is the best way because at this point, we probably have
the best understanding of how X works.</p>
<p>On the other hand, it is easy to argue that if we implement the
entire undo behaviour at the same time, it is easier to come up with a
clean design for it that will work for all cases.</p>
<p>If we started with a design for undo add, we might not yet see all
the information that must be saved. (For example, undo edit will require
us to store the original values of the edited data!)</p>
<h3 id="step-8-think-a-little-code-a-little">3.9 Step 8: Think a Little
– Code a Little</h3>
<p>“Smart data structures and dumb code works a lot better than the
other way around.”<br />
_ Eric S. Raymond</p>
<p>Choosing the proper database design is of course very important for
the program at hand. There are multiple alternatives ranging from simple
to hard, for example:</p>
<ol type="1">
<li>A statically sized array of wares</li>
<li>A dynamically sized in-memory structure like a list or a tree</li>
<li>An external database back-end</li>
</ol>
<p>There is however one very important realisation at this stage and
that is that right now, <strong>it does not matter</strong> (right
now).</p>
<p>The rationale is that we are trying to piece by piece construct a
piece of software that fulfils the specification. We are just about to
wrap-up the part of the program that will be adding the first item in
the database. We don’t have the code to remove items, edit them, etc. So
really, we could not care less at this point how the database is
designed.</p>
<p>This is a great opportunity to dodge again. This time, we are going
to dodge in three discrete steps:</p>
<ol type="1">
<li>The database holds only one single element</li>
<li>The database is an array of fixed maximal size</li>
<li>Make the final decision once the program’s done otherwise</li>
</ol>
<p>The first database design will allow implementing everything except
adding and removing with multiple wares, and listing multiple wares. The
second design will allow us to do all that. The third design will make
the program less of a <a
href="http://www.catb.org/jargon/html/M/mickey-mouse-program.html"
target="_blank">Mickey Mouse program</a>.</p>
<p>Following the first database design, we can now define a struct for
the database like so:</p>
<p>…….</p>
<h3 id="step-9-and-beyond">3.10 Step 9, and beyond</h3>
<p>“Controlling complexity is the essence of computer
programming.”<br />
_ Brian Kernighan</p>
<p>Think/code/refactor/remove cheats. Repeat until done. Find a good
balance.</p>
<h3 id="summary-and-conclusions">3.11 Summary and Conclusions</h3>
<p>“Those that can, do. Those that can’t, complain.”<br />
_ Linus Torvalds</p>
<p>Almost all hard problems can be broken down into less-hard
subproblems, which in turn can be broken down to even less-hard
subsubproblems, etc. After a while of breaking work down into smaller
and smaller tasks, the tasks finally become simple, and that is the
right time to start solving them. That’s SIMPLE in a nutshell.</p>
<p>As soon as we hit a bump in the road – a problem we don’t know
immediately how to solve, or don’t know how to solve well, or just
cannot be bothered with solving right now – we keep things simple by
cheating and dodging. We reserve ourselves that right by always making
clear notes about our cheats and dodges and by promising ourselves that
we will set things straight in the future. And by keeping our
promises.</p>
<h2 id="a-summary-of-simple-in-ten-steps">4 A Summary of SIMPLE in Ten
Steps</h2>
<dl>
<dt>Start with a high-level work breakdown structure</dt>
<dd>
Mine your specification for data (nouns) and actions (verbs –
behaviour/functions). Make simple drawings, e.g., mindmaps, to record
your insights. Making things look easy is almost always good.
</dd>
<dt>Write code to test the validity of your thinking</dt>
<dd>
…not to drive the thinking! Thinking should invariably come before
coding, especially thinking about how you check that your thinking is
valid.
</dd>
<dt>Always have a working program</dt>
<dd>
In combination with cheating, this usually means inserting dummy
functions.
</dd>
<dt>Compile after every change</dt>
<dd>
Fix errors now, not later. Fix errors one by one. Fix errors in the
order they were printed. Take time to actually read the compiler message
so you know you are fixing the right thing.
</dd>
<dt>Run the program “all the time” to spot errors</dt>
<dd>
This requires always working code – preferably in combination with
automated test that don’t involve ocular inspection, etc.
</dd>
<dt>Recursively break your problems up into smaller sub problems</dt>
<dd>
Only start solving problems when they start feeling easy. Make a task
for each problem or subproblem to put on the stack, take tasks from the
stack in a reasonable order (preferably easiest first); when the stack
is empty – you are done!
</dd>
<dt>Break each task up into increments and start with the easy ones</dt>
<dd>
Generate new tasks to put on the stack as you go. If suitable, start
with a straight-line version (without any if-statements). When the
straight-line version works add conditionals, one by one. Start with the
most basic or the most insteresting cases. When you are writing a loop,
do the above steps first and add the looping step last.
</dd>
<dt>Whenever you run the risk of getting stuck, cheat</dt>
<dd>
Don’t forget to push new tasks on the stack that undoes the cheating,
later. This records the cheat, which is great.
</dd>
<dt>Use dodging to help breaking complex cases up into several less
complex ones</dt>
<dd>
Don’t forget to push new tasks on the stack that undoes the dodge,
later. This records the dodge, which is great.
</dd>
<dt>Alternate between thinking, coding and refactoring</dt>
<dd>
<ul>
<li>thinking – not so much that you get stuck, though,</li>
<li>coding – but never without first thinking about what to code, and
occasionally</li>
<li>refactoring – especially to address your cheats and dodges.</li>
</ul>
<p>Refactoring is good to do between larger tasks. Make it a habit to
continuously go back and refactor your solutions so that recently gotten
insights rub off on older code too.</p>
</dd>
</dl>
</body>
</html>

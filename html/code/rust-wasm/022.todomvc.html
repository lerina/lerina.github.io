<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>022.todomvc 022.todomvc</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://lerina.github.io/css/styles_min.css" />
</head>
<body>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#parallel-raytracing">Parallel Raytracing</a>
<ul>
<li><a href="#building-the-demo">Building the demo</a></li>
<li><a href="#setup-the-project">setup the project</a></li>
<li><a href="#the-code">The code</a></li>
<li><a href="#running-the-demo">Running the demo</a></li>
</ul></li>
<li><a href="#build-and-serve">build and serve</a></li>
<li><a href="#whats-next">What’s next?</a></li>
</ul>
</nav>
<div class="navbar">
<a class="openbtn" onclick="openNav()">☰</a>
</div>
<p>Previous example: <a href="./019.wasm-in-web-worker.html"><code>&lt;--</code> web-sys: Wasm in Web Worker</a></p>
<main>
<h2 id="parallel-raytracing">Parallel Raytracing</h2>
<p><em>wasm-bindgen and web-sys coded TODO MVC</p>
<p>The code was rewritten from the ES6 version.</p>
<p>The core differences are:</p>
<pre><code>Having an Element wrapper that takes care of dyn and into refs in web-sys,  
A Scheduler that allows Controller and View to communicate to each other by emulating something similar to the JS event loop.</code></pre>
<p></em><br />
_ <a href="https://rustwasm.github.io/wasm-bindgen/examples/todomvc.html" target="_blank">wasm-bindgen Guide</a></p>
<p><a href="https://github.com/rustwasm/wasm-bindgen/tree/master/examples/todomvc" target="_blank">Parallel Raytracing</a></p>
<h3 id="building-the-demo">Building the demo</h3>
<p><em>One of the major gotchas with threaded WebAssembly is that Rust does not ship a precompiled target (e.g. standard library) which has threading support enabled. This means that you’ll need to recompile the standard library with the appropriate rustc flags, namely -C target-feature=+atomics,+bulk-memory,+mutable-globals. Note that this requires a nightly Rust toolchain.</em><br />
_ <a href="https://rustwasm.github.io/wasm-bindgen/examples/raytrace-parallel.html" target="_blank">wasm-bindgen Guide</a></p>
<h3 id="setup-the-project">setup the project</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="ex">cargo</span> new todomvc --lib</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a><span class="bu">cd</span> todomvc</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a><span class="fu">mkdir</span> -p www/js www/html www/html/templates</span></code></pre></div>
<ul>
<li>Edit Cargo.toml</li>
</ul>
<pre class="toml"><code>[lib]
crate-type = [&quot;cdylib&quot;]

[build-dependencies]
askama = &quot;0.10.0&quot;

[dependencies]
js-sys = &quot;0.3.66&quot;
wasm-bindgen = &quot;0.2.89&quot;
askama = &quot;0.10.0&quot;
console_error_panic_hook = &quot;0.1.5&quot;

[dependencies.web-sys]
version = &quot;0.3.5&quot;
features = [
  &#39;console&#39;,
  &#39;CssStyleDeclaration&#39;,
  &#39;Document&#39;,
  &#39;DomStringMap&#39;,
  &#39;DomTokenList&#39;,
  &#39;Element&#39;,
  &#39;Event&#39;,
  &#39;EventTarget&#39;,
  &#39;HtmlBodyElement&#39;,
  &#39;HtmlElement&#39;,
  &#39;HtmlInputElement&#39;,
  &#39;KeyboardEvent&#39;,
  &#39;Location&#39;,
  &#39;Node&#39;,
  &#39;NodeList&#39;,
  &#39;Storage&#39;,
  &#39;Window&#39;,
]</code></pre>
<h3 id="the-code">The code</h3>
<ul>
<li>index.html</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="dt">&lt;!doctype </span>html<span class="dt">&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>    <span class="kw">&lt;meta</span><span class="ot"> content=</span><span class="st">&quot;text/html;charset=utf-8&quot;</span><span class="ot"> http-equiv=</span><span class="st">&quot;Content-Type&quot;</span><span class="kw">/&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>    <span class="kw">&lt;title&gt;</span>web-sys Wasm • TodoMVC<span class="kw">&lt;/title&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>    <span class="kw">&lt;section</span><span class="ot"> class=</span><span class="st">&quot;todoapp&quot;</span><span class="kw">&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>      <span class="kw">&lt;header</span><span class="ot"> class=</span><span class="st">&quot;header&quot;</span><span class="kw">&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>        <span class="kw">&lt;h1&gt;</span>todos<span class="kw">&lt;/h1&gt;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>        <span class="kw">&lt;input</span><span class="ot"> class=</span><span class="st">&quot;new-todo&quot;</span><span class="ot"> placeholder=</span><span class="st">&quot;What needs to be done?&quot;</span><span class="ot"> autofocus</span><span class="kw">&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>      <span class="kw">&lt;/header&gt;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>      <span class="kw">&lt;section</span><span class="ot"> hidden class=</span><span class="st">&quot;main&quot;</span><span class="kw">&gt;</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>        <span class="kw">&lt;input</span><span class="ot"> id=</span><span class="st">&quot;toggle-all&quot;</span><span class="ot"> class=</span><span class="st">&quot;toggle-all&quot;</span><span class="ot"> type=</span><span class="st">&quot;checkbox&quot;</span><span class="kw">&gt;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true"></a>        <span class="kw">&lt;label</span><span class="ot"> for=</span><span class="st">&quot;toggle-all&quot;</span><span class="kw">&gt;</span>Mark all as complete<span class="kw">&lt;/label&gt;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true"></a>        <span class="kw">&lt;ul</span><span class="ot"> class=</span><span class="st">&quot;todo-list&quot;</span><span class="kw">&gt;&lt;/ul&gt;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true"></a>        <span class="kw">&lt;footer</span><span class="ot"> class=</span><span class="st">&quot;footer&quot;</span><span class="kw">&gt;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true"></a>          <span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">&quot;todo-count&quot;</span><span class="kw">&gt;&lt;/span&gt;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true"></a>          <span class="kw">&lt;ul</span><span class="ot"> class=</span><span class="st">&quot;filters&quot;</span><span class="kw">&gt;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true"></a>            <span class="kw">&lt;li&gt;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true"></a>              <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;#/&quot;</span><span class="ot"> class=</span><span class="st">&quot;selected&quot;</span><span class="kw">&gt;</span>All<span class="kw">&lt;/a&gt;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true"></a>            <span class="kw">&lt;/li&gt;</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true"></a>            <span class="kw">&lt;li&gt;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true"></a>            <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;#/active&quot;</span><span class="kw">&gt;</span>Active<span class="kw">&lt;/a&gt;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true"></a>            <span class="kw">&lt;/li&gt;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true"></a>            <span class="kw">&lt;li&gt;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true"></a>            <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;#/completed&quot;</span><span class="kw">&gt;</span>Completed<span class="kw">&lt;/a&gt;</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true"></a>            <span class="kw">&lt;/li&gt;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true"></a>          <span class="kw">&lt;/ul&gt;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true"></a>          <span class="kw">&lt;button</span><span class="ot"> class=</span><span class="st">&quot;clear-completed&quot;</span><span class="kw">&gt;</span>Clear completed<span class="kw">&lt;/button&gt;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true"></a>        <span class="kw">&lt;/footer&gt;</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true"></a>      <span class="kw">&lt;/section&gt;</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true"></a>    <span class="kw">&lt;/section&gt;</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true"></a>    <span class="kw">&lt;footer</span><span class="ot"> class=</span><span class="st">&quot;info&quot;</span><span class="kw">&gt;</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true"></a>      <span class="kw">&lt;p&gt;</span>Double-click to edit a todo<span class="kw">&lt;/p&gt;</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true"></a>      <span class="kw">&lt;p&gt;</span>Written by <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;http://twitter.com/KingstonTime/&quot;</span><span class="kw">&gt;</span>Jonathan Kingston<span class="kw">&lt;/a&gt;&lt;/p&gt;</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true"></a>      <span class="kw">&lt;p&gt;</span>Part of <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;http://todomvc.com&quot;</span><span class="kw">&gt;</span>TodoMVC<span class="kw">&lt;/a&gt;&lt;/p&gt;</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true"></a>    <span class="kw">&lt;/footer&gt;</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true"></a>    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;module&quot;</span><span class="ot"> src=</span><span class="st">&quot;../js/index.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<ul>
<li>templates</li>
</ul>
<p>in <code>www/html/templates</code></p>
<ul>
<li>itemsLeft.html</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>{{ active_todos }} item{% if active_todos &gt; 1 %}s{% endif %} left</span></code></pre></div>
<ul>
<li>row.html</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="kw">&lt;li</span><span class="ot"> data-id=</span><span class="st">&quot;{{ id }}&quot;</span><span class="er">{%</span><span class="ot"> if completed</span> <span class="er">%}</span><span class="ot"> class=</span><span class="st">&quot;completed&quot;</span><span class="er">{%</span><span class="ot"> endif</span> <span class="er">%}</span><span class="kw">&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;view&quot;</span><span class="kw">&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>        <span class="kw">&lt;input</span><span class="ot"> class=</span><span class="st">&quot;toggle&quot;</span><span class="ot"> type=</span><span class="st">&quot;checkbox&quot;</span><span class="er">{%</span><span class="ot"> if completed</span> <span class="er">%}</span><span class="ot"> checked</span><span class="er">{%</span><span class="ot"> endif</span> <span class="er">%}</span><span class="kw">&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>        <span class="kw">&lt;label&gt;</span>{{ title }}<span class="kw">&lt;/label&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>        <span class="kw">&lt;button</span><span class="ot"> class=</span><span class="st">&quot;destroy&quot;</span><span class="kw">&gt;&lt;/button&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a><span class="kw">&lt;/li&gt;</span></span></code></pre></div>
<ul>
<li>index.js</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="co">// For more comments about what&#39;s going on here, check out the `hello_world`</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="co">// example</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="kw">const</span> rust <span class="op">=</span> <span class="im">import</span>(<span class="st">&#39;./pkg&#39;</span>)<span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a><span class="kw">const</span> css <span class="op">=</span> <span class="im">import</span>(<span class="st">&#39;./index.css&#39;</span>)<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>rust</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a>  <span class="op">.</span><span class="fu">then</span>(m <span class="kw">=&gt;</span> m<span class="op">.</span><span class="fu">run</span>())</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a>  <span class="op">.</span><span class="fu">catch</span>(<span class="bu">console</span><span class="op">.</span><span class="fu">error</span>)<span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a></span></code></pre></div>
<ul>
<li>style.css</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>html<span class="op">,</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>body {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>    <span class="kw">margin</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>    <span class="kw">padding</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>}</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>button {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>    <span class="kw">margin</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>    <span class="kw">padding</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>    <span class="kw">border</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>    <span class="kw">background</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a>    <span class="kw">font-size</span>: <span class="dv">100</span><span class="dt">%</span><span class="op">;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a>    <span class="kw">vertical-align</span>: <span class="dv">baseline</span><span class="op">;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true"></a>    <span class="kw">font-family</span>: <span class="bu">inherit</span><span class="op">;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true"></a>    <span class="kw">font-weight</span>: <span class="bu">inherit</span><span class="op">;</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="bu">inherit</span><span class="op">;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true"></a>    <span class="kw">-webkit-appearance</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true"></a>    <span class="kw">appearance</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true"></a>    -webkit-font-smoothing: antialiased<span class="op">;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true"></a>    -moz-osx-font-smoothing: grayscale<span class="op">;</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true"></a>}</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true"></a>body {</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true"></a>    <span class="kw">font</span>: <span class="dv">14</span><span class="dt">px</span> <span class="st">&#39;Helvetica Neue&#39;</span><span class="op">,</span> Helvetica<span class="op">,</span> Arial<span class="op">,</span> <span class="dv">sans-serif</span><span class="op">;</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true"></a>    <span class="kw">line-height</span>: <span class="dv">1.4</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true"></a>    <span class="kw">background</span>: <span class="cn">#f5f5f5</span><span class="op">;</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="cn">#4d4d4d</span><span class="op">;</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true"></a>    <span class="kw">min-width</span>: <span class="dv">230</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true"></a>    <span class="kw">max-width</span>: <span class="dv">550</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true"></a>    <span class="kw">margin</span>: <span class="dv">0</span> <span class="bu">auto</span><span class="op">;</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true"></a>    -webkit-font-smoothing: antialiased<span class="op">;</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true"></a>    -moz-osx-font-smoothing: grayscale<span class="op">;</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true"></a>    <span class="kw">font-weight</span>: <span class="dv">300</span><span class="op">;</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true"></a>}</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true"></a><span class="in">:focus</span> {</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true"></a>    <span class="kw">outline</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true"></a>}</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true"></a><span class="fu">.hidden</span> {</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true"></a>    <span class="kw">display</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true"></a>}</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true"></a><span class="fu">.todoapp</span> {</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true"></a>    <span class="kw">background</span>: <span class="cn">#fff</span><span class="op">;</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true"></a>    <span class="kw">margin</span>: <span class="dv">130</span><span class="dt">px</span> <span class="dv">0</span> <span class="dv">40</span><span class="dt">px</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true"></a>    <span class="kw">position</span>: <span class="dv">relative</span><span class="op">;</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true"></a>    <span class="kw">box-shadow</span>: <span class="dv">0</span> <span class="dv">2</span><span class="dt">px</span> <span class="dv">4</span><span class="dt">px</span> <span class="dv">0</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0.2</span><span class="fu">)</span><span class="op">,</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true"></a>                <span class="dv">0</span> <span class="dv">25</span><span class="dt">px</span> <span class="dv">50</span><span class="dt">px</span> <span class="dv">0</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0.1</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true"></a>}</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true"></a><span class="fu">.todoapp</span> input<span class="in">::-webkit-input-placeholder</span> {</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true"></a>    <span class="kw">font-style</span>: <span class="dv">italic</span><span class="op">;</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true"></a>    <span class="kw">font-weight</span>: <span class="dv">300</span><span class="op">;</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="cn">#e6e6e6</span><span class="op">;</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true"></a>}</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true"></a></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true"></a><span class="fu">.todoapp</span> input<span class="in">::-moz-placeholder</span> {</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true"></a>    <span class="kw">font-style</span>: <span class="dv">italic</span><span class="op">;</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true"></a>    <span class="kw">font-weight</span>: <span class="dv">300</span><span class="op">;</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="cn">#e6e6e6</span><span class="op">;</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true"></a>}</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true"></a></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true"></a><span class="fu">.todoapp</span> input<span class="in">::input-placeholder</span> {</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true"></a>    <span class="kw">font-style</span>: <span class="dv">italic</span><span class="op">;</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true"></a>    <span class="kw">font-weight</span>: <span class="dv">300</span><span class="op">;</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="cn">#e6e6e6</span><span class="op">;</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true"></a>}</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true"></a></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true"></a><span class="fu">.todoapp</span> h1 {</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true"></a>    <span class="kw">position</span>: <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true"></a>    <span class="kw">top</span>: <span class="dv">-155</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true"></a>    <span class="kw">width</span>: <span class="dv">100</span><span class="dt">%</span><span class="op">;</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true"></a>    <span class="kw">font-size</span>: <span class="dv">100</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true"></a>    <span class="kw">font-weight</span>: <span class="dv">100</span><span class="op">;</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true"></a>    <span class="kw">text-align</span>: <span class="dv">center</span><span class="op">;</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="fu">rgba(</span><span class="dv">175</span><span class="op">,</span> <span class="dv">47</span><span class="op">,</span> <span class="dv">47</span><span class="op">,</span> <span class="dv">0.15</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true"></a>    -webkit-text-rendering: optimizeLegibility<span class="op">;</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true"></a>    -moz-text-rendering: optimizeLegibility<span class="op">;</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true"></a>    text-rendering: optimizeLegibility<span class="op">;</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true"></a>}</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true"></a></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true"></a><span class="fu">.new-todo</span><span class="op">,</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true"></a><span class="fu">.edit</span> {</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true"></a>    <span class="kw">position</span>: <span class="dv">relative</span><span class="op">;</span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true"></a>    <span class="kw">margin</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true"></a>    <span class="kw">width</span>: <span class="dv">100</span><span class="dt">%</span><span class="op">;</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true"></a>    <span class="kw">font-size</span>: <span class="dv">24</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true"></a>    <span class="kw">font-family</span>: <span class="bu">inherit</span><span class="op">;</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true"></a>    <span class="kw">font-weight</span>: <span class="bu">inherit</span><span class="op">;</span></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true"></a>    <span class="kw">line-height</span>: <span class="dv">1.4</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true"></a>    <span class="kw">border</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="bu">inherit</span><span class="op">;</span></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true"></a>    <span class="kw">padding</span>: <span class="dv">6</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true"></a>    <span class="kw">border</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#999</span><span class="op">;</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true"></a>    <span class="kw">box-shadow</span>: <span class="dv">inset</span> <span class="dv">0</span> <span class="dv">-1</span><span class="dt">px</span> <span class="dv">5</span><span class="dt">px</span> <span class="dv">0</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0.2</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true"></a>    <span class="kw">box-sizing</span>: <span class="dv">border-box</span><span class="op">;</span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true"></a>    -webkit-font-smoothing: antialiased<span class="op">;</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true"></a>    -moz-osx-font-smoothing: grayscale<span class="op">;</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true"></a>}</span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true"></a></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true"></a><span class="fu">.new-todo</span> {</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true"></a>    <span class="kw">padding</span>: <span class="dv">16</span><span class="dt">px</span> <span class="dv">16</span><span class="dt">px</span> <span class="dv">16</span><span class="dt">px</span> <span class="dv">60</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true"></a>    <span class="kw">border</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true"></a>    <span class="kw">background</span>: <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0.003</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true"></a>    <span class="kw">box-shadow</span>: <span class="dv">inset</span> <span class="dv">0</span> <span class="dv">-2</span><span class="dt">px</span> <span class="dv">1</span><span class="dt">px</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0.03</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true"></a>}</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true"></a></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true"></a><span class="fu">.main</span> {</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true"></a>    <span class="kw">position</span>: <span class="dv">relative</span><span class="op">;</span></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true"></a>    <span class="kw">z-index</span>: <span class="dv">2</span><span class="op">;</span></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true"></a>    <span class="kw">border-top</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#e6e6e6</span><span class="op">;</span></span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true"></a>}</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true"></a></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true"></a><span class="fu">.toggle-all</span> {</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true"></a>    <span class="kw">width</span>: <span class="dv">1</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true"></a>    <span class="kw">height</span>: <span class="dv">1</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true"></a>    <span class="kw">border</span>: <span class="dv">none</span><span class="op">;</span> <span class="co">/* Mobile Safari */</span></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true"></a>    <span class="kw">opacity</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true"></a>    <span class="kw">position</span>: <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true"></a>    <span class="kw">right</span>: <span class="dv">100</span><span class="dt">%</span><span class="op">;</span></span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true"></a>    <span class="kw">bottom</span>: <span class="dv">100</span><span class="dt">%</span><span class="op">;</span></span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true"></a>}</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true"></a></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true"></a><span class="fu">.toggle-all</span> <span class="op">+</span> label {</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true"></a>    <span class="kw">width</span>: <span class="dv">60</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true"></a>    <span class="kw">height</span>: <span class="dv">34</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true"></a>    <span class="kw">font-size</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true"></a>    <span class="kw">position</span>: <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true"></a>    <span class="kw">top</span>: <span class="dv">-52</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true"></a>    <span class="kw">left</span>: <span class="dv">-13</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true"></a>    <span class="kw">-webkit-transform</span>: <span class="fu">rotate(</span><span class="dv">90</span><span class="dt">deg</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true"></a>    <span class="kw">transform</span>: <span class="fu">rotate(</span><span class="dv">90</span><span class="dt">deg</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true"></a>}</span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true"></a></span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true"></a><span class="fu">.toggle-all</span> <span class="op">+</span> label<span class="in">:before</span> {</span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true"></a>    <span class="kw">content</span>: <span class="st">&#39;❯&#39;</span><span class="op">;</span></span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true"></a>    <span class="kw">font-size</span>: <span class="dv">22</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="cn">#e6e6e6</span><span class="op">;</span></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true"></a>    <span class="kw">padding</span>: <span class="dv">10</span><span class="dt">px</span> <span class="dv">27</span><span class="dt">px</span> <span class="dv">10</span><span class="dt">px</span> <span class="dv">27</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true"></a>}</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true"></a></span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true"></a><span class="fu">.toggle-all</span><span class="in">:checked</span> <span class="op">+</span> label<span class="in">:before</span> {</span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="cn">#737373</span><span class="op">;</span></span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true"></a>}</span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true"></a></span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true"></a><span class="fu">.todo-list</span> {</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true"></a>    <span class="kw">margin</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true"></a>    <span class="kw">padding</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true"></a>    <span class="kw">list-style</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true"></a>}</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true"></a></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true"></a><span class="fu">.todo-list</span> li {</span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true"></a>    <span class="kw">position</span>: <span class="dv">relative</span><span class="op">;</span></span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true"></a>    <span class="kw">font-size</span>: <span class="dv">24</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true"></a>    <span class="kw">border-bottom</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#ededed</span><span class="op">;</span></span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true"></a>}</span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true"></a></span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true"></a><span class="fu">.todo-list</span> li<span class="in">:last-child</span> {</span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true"></a>    <span class="kw">border-bottom</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true"></a>}</span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true"></a></span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true"></a><span class="fu">.todo-list</span> li<span class="fu">.editing</span> {</span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true"></a>    <span class="kw">border-bottom</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true"></a>    <span class="kw">padding</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true"></a>}</span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true"></a></span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true"></a><span class="fu">.todo-list</span> li<span class="fu">.editing</span> <span class="fu">.edit</span> {</span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true"></a>    <span class="kw">display</span>: <span class="dv">block</span><span class="op">;</span></span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true"></a>    <span class="kw">width</span>: <span class="dv">506</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true"></a>    <span class="kw">padding</span>: <span class="dv">12</span><span class="dt">px</span> <span class="dv">16</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true"></a>    <span class="kw">margin</span>: <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">43</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true"></a>}</span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true"></a></span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true"></a><span class="fu">.todo-list</span> li<span class="fu">.editing</span> <span class="fu">.view</span> {</span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true"></a>    <span class="kw">display</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true"></a>}</span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true"></a></span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true"></a><span class="fu">.todo-list</span> li <span class="fu">.toggle</span> {</span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true"></a>    <span class="kw">text-align</span>: <span class="dv">center</span><span class="op">;</span></span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true"></a>    <span class="kw">width</span>: <span class="dv">40</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true"></a>    <span class="co">/* auto, since non-WebKit browsers doesn&#39;t support input styling */</span></span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true"></a>    <span class="kw">height</span>: <span class="bu">auto</span><span class="op">;</span></span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true"></a>    <span class="kw">position</span>: <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true"></a>    <span class="kw">top</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true"></a>    <span class="kw">bottom</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true"></a>    <span class="kw">margin</span>: <span class="bu">auto</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true"></a>    <span class="kw">border</span>: <span class="dv">none</span><span class="op">;</span> <span class="co">/* Mobile Safari */</span></span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true"></a>    <span class="kw">-webkit-appearance</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true"></a>    <span class="kw">appearance</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true"></a>}</span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true"></a></span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true"></a><span class="fu">.todo-list</span> li <span class="fu">.toggle</span> {</span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true"></a>    <span class="kw">opacity</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true"></a>}</span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true"></a></span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true"></a><span class="fu">.todo-list</span> li <span class="fu">.toggle</span> <span class="op">+</span> label {</span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true"></a>    <span class="co">/*</span></span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true"></a><span class="co">        Firefox requires `#` to be escaped - https://bugzilla.mozilla.org/show_bug.cgi?id=922433</span></span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true"></a><span class="co">        IE and Edge requires *everything* to be escaped to render, so we do that instead of just the `#` - https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/7157459/</span></span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true"></a><span class="co">    */</span></span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true"></a>    <span class="kw">background-image</span>: <span class="fu">url(</span><span class="st">&#39;data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%22-10%20-18%20100%20135%22%3E%3Ccircle%20cx%3D%2250%22%20cy%3D%2250%22%20r%3D%2250%22%20fill%3D%22none%22%20stroke%3D%22%23ededed%22%20stroke-width%3D%223%22/%3E%3C/svg%3E&#39;</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true"></a>    <span class="kw">background-repeat</span>: <span class="dv">no-repeat</span><span class="op">;</span></span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true"></a>    <span class="kw">background-position</span>: <span class="dv">center</span> <span class="dv">left</span><span class="op">;</span></span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true"></a>}</span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true"></a></span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true"></a><span class="fu">.todo-list</span> li <span class="fu">.toggle</span><span class="in">:checked</span> <span class="op">+</span> label {</span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true"></a>    <span class="kw">background-image</span>: <span class="fu">url(</span><span class="st">&#39;data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%22-10%20-18%20100%20135%22%3E%3Ccircle%20cx%3D%2250%22%20cy%3D%2250%22%20r%3D%2250%22%20fill%3D%22none%22%20stroke%3D%22%23bddad5%22%20stroke-width%3D%223%22/%3E%3Cpath%20fill%3D%22%235dc2af%22%20d%3D%22M72%2025L42%2071%2027%2056l-4%204%2020%2020%2034-52z%22/%3E%3C/svg%3E&#39;</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true"></a>}</span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true"></a></span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true"></a><span class="fu">.todo-list</span> li label {</span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true"></a>    <span class="kw">word-break</span>: break-all<span class="op">;</span></span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true"></a>    <span class="kw">padding</span>: <span class="dv">15</span><span class="dt">px</span> <span class="dv">15</span><span class="dt">px</span> <span class="dv">15</span><span class="dt">px</span> <span class="dv">60</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true"></a>    <span class="kw">display</span>: <span class="dv">block</span><span class="op">;</span></span>
<span id="cb8-215"><a href="#cb8-215" aria-hidden="true"></a>    <span class="kw">line-height</span>: <span class="dv">1.2</span><span class="op">;</span></span>
<span id="cb8-216"><a href="#cb8-216" aria-hidden="true"></a>    <span class="kw">transition</span>: color <span class="dv">0.4</span><span class="dt">s</span><span class="op">;</span></span>
<span id="cb8-217"><a href="#cb8-217" aria-hidden="true"></a>}</span>
<span id="cb8-218"><a href="#cb8-218" aria-hidden="true"></a></span>
<span id="cb8-219"><a href="#cb8-219" aria-hidden="true"></a><span class="fu">.todo-list</span> li<span class="fu">.completed</span> label {</span>
<span id="cb8-220"><a href="#cb8-220" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="cn">#d9d9d9</span><span class="op">;</span></span>
<span id="cb8-221"><a href="#cb8-221" aria-hidden="true"></a>    <span class="kw">text-decoration</span>: <span class="dv">line-through</span><span class="op">;</span></span>
<span id="cb8-222"><a href="#cb8-222" aria-hidden="true"></a>}</span>
<span id="cb8-223"><a href="#cb8-223" aria-hidden="true"></a></span>
<span id="cb8-224"><a href="#cb8-224" aria-hidden="true"></a><span class="fu">.todo-list</span> li <span class="fu">.destroy</span> {</span>
<span id="cb8-225"><a href="#cb8-225" aria-hidden="true"></a>    <span class="kw">display</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-226"><a href="#cb8-226" aria-hidden="true"></a>    <span class="kw">position</span>: <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true"></a>    <span class="kw">top</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-228"><a href="#cb8-228" aria-hidden="true"></a>    <span class="kw">right</span>: <span class="dv">10</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-229"><a href="#cb8-229" aria-hidden="true"></a>    <span class="kw">bottom</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-230"><a href="#cb8-230" aria-hidden="true"></a>    <span class="kw">width</span>: <span class="dv">40</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-231"><a href="#cb8-231" aria-hidden="true"></a>    <span class="kw">height</span>: <span class="dv">40</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-232"><a href="#cb8-232" aria-hidden="true"></a>    <span class="kw">margin</span>: <span class="bu">auto</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-233"><a href="#cb8-233" aria-hidden="true"></a>    <span class="kw">font-size</span>: <span class="dv">30</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-234"><a href="#cb8-234" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="cn">#cc9a9a</span><span class="op">;</span></span>
<span id="cb8-235"><a href="#cb8-235" aria-hidden="true"></a>    <span class="kw">margin-bottom</span>: <span class="dv">11</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-236"><a href="#cb8-236" aria-hidden="true"></a>    <span class="kw">transition</span>: color <span class="dv">0.2</span><span class="dt">s</span> <span class="dv">ease-out</span><span class="op">;</span></span>
<span id="cb8-237"><a href="#cb8-237" aria-hidden="true"></a>}</span>
<span id="cb8-238"><a href="#cb8-238" aria-hidden="true"></a></span>
<span id="cb8-239"><a href="#cb8-239" aria-hidden="true"></a><span class="fu">.todo-list</span> li <span class="fu">.destroy</span><span class="in">:hover</span> {</span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="cn">#af5b5e</span><span class="op">;</span></span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true"></a>}</span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true"></a></span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true"></a><span class="fu">.todo-list</span> li <span class="fu">.destroy</span><span class="in">:after</span> {</span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true"></a>    <span class="kw">content</span>: <span class="st">&#39;×&#39;</span><span class="op">;</span></span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true"></a>}</span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true"></a></span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true"></a><span class="fu">.todo-list</span> li<span class="in">:hover</span> <span class="fu">.destroy</span> {</span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true"></a>    <span class="kw">display</span>: <span class="dv">block</span><span class="op">;</span></span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true"></a>}</span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true"></a></span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true"></a><span class="fu">.todo-list</span> li <span class="fu">.edit</span> {</span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true"></a>    <span class="kw">display</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true"></a>}</span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true"></a></span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true"></a><span class="fu">.todo-list</span> li<span class="fu">.editing</span><span class="in">:last-child</span> {</span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true"></a>    <span class="kw">margin-bottom</span>: <span class="dv">-1</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true"></a>}</span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true"></a></span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true"></a><span class="fu">.footer</span> {</span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="cn">#777</span><span class="op">;</span></span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true"></a>    <span class="kw">padding</span>: <span class="dv">10</span><span class="dt">px</span> <span class="dv">15</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true"></a>    <span class="kw">height</span>: <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true"></a>    <span class="kw">text-align</span>: <span class="dv">center</span><span class="op">;</span></span>
<span id="cb8-264"><a href="#cb8-264" aria-hidden="true"></a>    <span class="kw">border-top</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#e6e6e6</span><span class="op">;</span></span>
<span id="cb8-265"><a href="#cb8-265" aria-hidden="true"></a>}</span>
<span id="cb8-266"><a href="#cb8-266" aria-hidden="true"></a></span>
<span id="cb8-267"><a href="#cb8-267" aria-hidden="true"></a><span class="fu">.footer</span><span class="in">:before</span> {</span>
<span id="cb8-268"><a href="#cb8-268" aria-hidden="true"></a>    <span class="kw">content</span>: <span class="st">&#39;&#39;</span><span class="op">;</span></span>
<span id="cb8-269"><a href="#cb8-269" aria-hidden="true"></a>    <span class="kw">position</span>: <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb8-270"><a href="#cb8-270" aria-hidden="true"></a>    <span class="kw">right</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-271"><a href="#cb8-271" aria-hidden="true"></a>    <span class="kw">bottom</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-272"><a href="#cb8-272" aria-hidden="true"></a>    <span class="kw">left</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-273"><a href="#cb8-273" aria-hidden="true"></a>    <span class="kw">height</span>: <span class="dv">50</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-274"><a href="#cb8-274" aria-hidden="true"></a>    <span class="kw">overflow</span>: <span class="dv">hidden</span><span class="op">;</span></span>
<span id="cb8-275"><a href="#cb8-275" aria-hidden="true"></a>    <span class="kw">box-shadow</span>: <span class="dv">0</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">1</span><span class="dt">px</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0.2</span><span class="fu">)</span><span class="op">,</span></span>
<span id="cb8-276"><a href="#cb8-276" aria-hidden="true"></a>                <span class="dv">0</span> <span class="dv">8</span><span class="dt">px</span> <span class="dv">0</span> <span class="dv">-3</span><span class="dt">px</span> <span class="cn">#f6f6f6</span><span class="op">,</span></span>
<span id="cb8-277"><a href="#cb8-277" aria-hidden="true"></a>                <span class="dv">0</span> <span class="dv">9</span><span class="dt">px</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">-3</span><span class="dt">px</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0.2</span><span class="fu">)</span><span class="op">,</span></span>
<span id="cb8-278"><a href="#cb8-278" aria-hidden="true"></a>                <span class="dv">0</span> <span class="dv">16</span><span class="dt">px</span> <span class="dv">0</span> <span class="dv">-6</span><span class="dt">px</span> <span class="cn">#f6f6f6</span><span class="op">,</span></span>
<span id="cb8-279"><a href="#cb8-279" aria-hidden="true"></a>                <span class="dv">0</span> <span class="dv">17</span><span class="dt">px</span> <span class="dv">2</span><span class="dt">px</span> <span class="dv">-6</span><span class="dt">px</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0.2</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb8-280"><a href="#cb8-280" aria-hidden="true"></a>}</span>
<span id="cb8-281"><a href="#cb8-281" aria-hidden="true"></a></span>
<span id="cb8-282"><a href="#cb8-282" aria-hidden="true"></a><span class="fu">.todo-count</span> {</span>
<span id="cb8-283"><a href="#cb8-283" aria-hidden="true"></a>    <span class="kw">float</span>: <span class="dv">left</span><span class="op">;</span></span>
<span id="cb8-284"><a href="#cb8-284" aria-hidden="true"></a>    <span class="kw">text-align</span>: <span class="dv">left</span><span class="op">;</span></span>
<span id="cb8-285"><a href="#cb8-285" aria-hidden="true"></a>}</span>
<span id="cb8-286"><a href="#cb8-286" aria-hidden="true"></a></span>
<span id="cb8-287"><a href="#cb8-287" aria-hidden="true"></a><span class="fu">.todo-count</span> strong {</span>
<span id="cb8-288"><a href="#cb8-288" aria-hidden="true"></a>    <span class="kw">font-weight</span>: <span class="dv">300</span><span class="op">;</span></span>
<span id="cb8-289"><a href="#cb8-289" aria-hidden="true"></a>}</span>
<span id="cb8-290"><a href="#cb8-290" aria-hidden="true"></a></span>
<span id="cb8-291"><a href="#cb8-291" aria-hidden="true"></a><span class="fu">.filters</span> {</span>
<span id="cb8-292"><a href="#cb8-292" aria-hidden="true"></a>    <span class="kw">margin</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-293"><a href="#cb8-293" aria-hidden="true"></a>    <span class="kw">padding</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-294"><a href="#cb8-294" aria-hidden="true"></a>    <span class="kw">list-style</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-295"><a href="#cb8-295" aria-hidden="true"></a>    <span class="kw">position</span>: <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb8-296"><a href="#cb8-296" aria-hidden="true"></a>    <span class="kw">right</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-297"><a href="#cb8-297" aria-hidden="true"></a>    <span class="kw">left</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-298"><a href="#cb8-298" aria-hidden="true"></a>}</span>
<span id="cb8-299"><a href="#cb8-299" aria-hidden="true"></a></span>
<span id="cb8-300"><a href="#cb8-300" aria-hidden="true"></a><span class="fu">.filters</span> li {</span>
<span id="cb8-301"><a href="#cb8-301" aria-hidden="true"></a>    <span class="kw">display</span>: <span class="dv">inline</span><span class="op">;</span></span>
<span id="cb8-302"><a href="#cb8-302" aria-hidden="true"></a>}</span>
<span id="cb8-303"><a href="#cb8-303" aria-hidden="true"></a></span>
<span id="cb8-304"><a href="#cb8-304" aria-hidden="true"></a><span class="fu">.filters</span> li a {</span>
<span id="cb8-305"><a href="#cb8-305" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="bu">inherit</span><span class="op">;</span></span>
<span id="cb8-306"><a href="#cb8-306" aria-hidden="true"></a>    <span class="kw">margin</span>: <span class="dv">3</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-307"><a href="#cb8-307" aria-hidden="true"></a>    <span class="kw">padding</span>: <span class="dv">3</span><span class="dt">px</span> <span class="dv">7</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-308"><a href="#cb8-308" aria-hidden="true"></a>    <span class="kw">text-decoration</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-309"><a href="#cb8-309" aria-hidden="true"></a>    <span class="kw">border</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="dv">transparent</span><span class="op">;</span></span>
<span id="cb8-310"><a href="#cb8-310" aria-hidden="true"></a>    <span class="kw">border-radius</span>: <span class="dv">3</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-311"><a href="#cb8-311" aria-hidden="true"></a>}</span>
<span id="cb8-312"><a href="#cb8-312" aria-hidden="true"></a></span>
<span id="cb8-313"><a href="#cb8-313" aria-hidden="true"></a><span class="fu">.filters</span> li a<span class="in">:hover</span> {</span>
<span id="cb8-314"><a href="#cb8-314" aria-hidden="true"></a>    <span class="kw">border-color</span>: <span class="fu">rgba(</span><span class="dv">175</span><span class="op">,</span> <span class="dv">47</span><span class="op">,</span> <span class="dv">47</span><span class="op">,</span> <span class="dv">0.1</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb8-315"><a href="#cb8-315" aria-hidden="true"></a>}</span>
<span id="cb8-316"><a href="#cb8-316" aria-hidden="true"></a></span>
<span id="cb8-317"><a href="#cb8-317" aria-hidden="true"></a><span class="fu">.filters</span> li a<span class="fu">.selected</span> {</span>
<span id="cb8-318"><a href="#cb8-318" aria-hidden="true"></a>    <span class="kw">border-color</span>: <span class="fu">rgba(</span><span class="dv">175</span><span class="op">,</span> <span class="dv">47</span><span class="op">,</span> <span class="dv">47</span><span class="op">,</span> <span class="dv">0.2</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb8-319"><a href="#cb8-319" aria-hidden="true"></a>}</span>
<span id="cb8-320"><a href="#cb8-320" aria-hidden="true"></a></span>
<span id="cb8-321"><a href="#cb8-321" aria-hidden="true"></a><span class="fu">.clear-completed</span><span class="op">,</span></span>
<span id="cb8-322"><a href="#cb8-322" aria-hidden="true"></a>html <span class="fu">.clear-completed</span><span class="in">:active</span> {</span>
<span id="cb8-323"><a href="#cb8-323" aria-hidden="true"></a>    <span class="kw">float</span>: <span class="dv">right</span><span class="op">;</span></span>
<span id="cb8-324"><a href="#cb8-324" aria-hidden="true"></a>    <span class="kw">position</span>: <span class="dv">relative</span><span class="op">;</span></span>
<span id="cb8-325"><a href="#cb8-325" aria-hidden="true"></a>    <span class="kw">line-height</span>: <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-326"><a href="#cb8-326" aria-hidden="true"></a>    <span class="kw">text-decoration</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-327"><a href="#cb8-327" aria-hidden="true"></a>    <span class="kw">cursor</span>: <span class="dv">pointer</span><span class="op">;</span></span>
<span id="cb8-328"><a href="#cb8-328" aria-hidden="true"></a>}</span>
<span id="cb8-329"><a href="#cb8-329" aria-hidden="true"></a></span>
<span id="cb8-330"><a href="#cb8-330" aria-hidden="true"></a><span class="fu">.clear-completed</span><span class="in">:hover</span> {</span>
<span id="cb8-331"><a href="#cb8-331" aria-hidden="true"></a>    <span class="kw">text-decoration</span>: <span class="dv">underline</span><span class="op">;</span></span>
<span id="cb8-332"><a href="#cb8-332" aria-hidden="true"></a>}</span>
<span id="cb8-333"><a href="#cb8-333" aria-hidden="true"></a></span>
<span id="cb8-334"><a href="#cb8-334" aria-hidden="true"></a><span class="fu">.info</span> {</span>
<span id="cb8-335"><a href="#cb8-335" aria-hidden="true"></a>    <span class="kw">margin</span>: <span class="dv">65</span><span class="dt">px</span> <span class="bu">auto</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb8-336"><a href="#cb8-336" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="cn">#bfbfbf</span><span class="op">;</span></span>
<span id="cb8-337"><a href="#cb8-337" aria-hidden="true"></a>    <span class="kw">font-size</span>: <span class="dv">10</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-338"><a href="#cb8-338" aria-hidden="true"></a>    <span class="kw">text-shadow</span>: <span class="dv">0</span> <span class="dv">1</span><span class="dt">px</span> <span class="dv">0</span> <span class="fu">rgba(</span><span class="dv">255</span><span class="op">,</span> <span class="dv">255</span><span class="op">,</span> <span class="dv">255</span><span class="op">,</span> <span class="dv">0.5</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb8-339"><a href="#cb8-339" aria-hidden="true"></a>    <span class="kw">text-align</span>: <span class="dv">center</span><span class="op">;</span></span>
<span id="cb8-340"><a href="#cb8-340" aria-hidden="true"></a>}</span>
<span id="cb8-341"><a href="#cb8-341" aria-hidden="true"></a></span>
<span id="cb8-342"><a href="#cb8-342" aria-hidden="true"></a><span class="fu">.info</span> p {</span>
<span id="cb8-343"><a href="#cb8-343" aria-hidden="true"></a>    <span class="kw">line-height</span>: <span class="dv">1</span><span class="op">;</span></span>
<span id="cb8-344"><a href="#cb8-344" aria-hidden="true"></a>}</span>
<span id="cb8-345"><a href="#cb8-345" aria-hidden="true"></a></span>
<span id="cb8-346"><a href="#cb8-346" aria-hidden="true"></a><span class="fu">.info</span> a {</span>
<span id="cb8-347"><a href="#cb8-347" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="bu">inherit</span><span class="op">;</span></span>
<span id="cb8-348"><a href="#cb8-348" aria-hidden="true"></a>    <span class="kw">text-decoration</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-349"><a href="#cb8-349" aria-hidden="true"></a>    <span class="kw">font-weight</span>: <span class="dv">400</span><span class="op">;</span></span>
<span id="cb8-350"><a href="#cb8-350" aria-hidden="true"></a>}</span>
<span id="cb8-351"><a href="#cb8-351" aria-hidden="true"></a></span>
<span id="cb8-352"><a href="#cb8-352" aria-hidden="true"></a><span class="fu">.info</span> a<span class="in">:hover</span> {</span>
<span id="cb8-353"><a href="#cb8-353" aria-hidden="true"></a>    <span class="kw">text-decoration</span>: <span class="dv">underline</span><span class="op">;</span></span>
<span id="cb8-354"><a href="#cb8-354" aria-hidden="true"></a>}</span>
<span id="cb8-355"><a href="#cb8-355" aria-hidden="true"></a></span>
<span id="cb8-356"><a href="#cb8-356" aria-hidden="true"></a><span class="co">/*</span></span>
<span id="cb8-357"><a href="#cb8-357" aria-hidden="true"></a><span class="co">    Hack to remove background from Mobile Safari.</span></span>
<span id="cb8-358"><a href="#cb8-358" aria-hidden="true"></a><span class="co">    Can&#39;t use it globally since it destroys checkboxes in Firefox</span></span>
<span id="cb8-359"><a href="#cb8-359" aria-hidden="true"></a><span class="co">*/</span></span>
<span id="cb8-360"><a href="#cb8-360" aria-hidden="true"></a><span class="im">@media</span> <span class="dv">screen</span> <span class="kw">and</span> (<span class="kw">-webkit-min-device-pixel-ratio</span>:<span class="dv">0</span>) {</span>
<span id="cb8-361"><a href="#cb8-361" aria-hidden="true"></a>    <span class="fu">.toggle-all</span><span class="op">,</span></span>
<span id="cb8-362"><a href="#cb8-362" aria-hidden="true"></a>    <span class="fu">.todo-list</span> li <span class="fu">.toggle</span> {</span>
<span id="cb8-363"><a href="#cb8-363" aria-hidden="true"></a>        <span class="kw">background</span>: <span class="dv">none</span><span class="op">;</span></span>
<span id="cb8-364"><a href="#cb8-364" aria-hidden="true"></a>    }</span>
<span id="cb8-365"><a href="#cb8-365" aria-hidden="true"></a></span>
<span id="cb8-366"><a href="#cb8-366" aria-hidden="true"></a>    <span class="fu">.todo-list</span> li <span class="fu">.toggle</span> {</span>
<span id="cb8-367"><a href="#cb8-367" aria-hidden="true"></a>        <span class="kw">height</span>: <span class="dv">40</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-368"><a href="#cb8-368" aria-hidden="true"></a>    }</span>
<span id="cb8-369"><a href="#cb8-369" aria-hidden="true"></a>}</span>
<span id="cb8-370"><a href="#cb8-370" aria-hidden="true"></a></span>
<span id="cb8-371"><a href="#cb8-371" aria-hidden="true"></a><span class="im">@media</span> (<span class="kw">max-width</span>: <span class="dv">430</span><span class="dt">px</span>) {</span>
<span id="cb8-372"><a href="#cb8-372" aria-hidden="true"></a>    <span class="fu">.footer</span> {</span>
<span id="cb8-373"><a href="#cb8-373" aria-hidden="true"></a>        <span class="kw">height</span>: <span class="dv">50</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-374"><a href="#cb8-374" aria-hidden="true"></a>    }</span>
<span id="cb8-375"><a href="#cb8-375" aria-hidden="true"></a></span>
<span id="cb8-376"><a href="#cb8-376" aria-hidden="true"></a>    <span class="fu">.filters</span> {</span>
<span id="cb8-377"><a href="#cb8-377" aria-hidden="true"></a>        <span class="kw">bottom</span>: <span class="dv">10</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb8-378"><a href="#cb8-378" aria-hidden="true"></a>    }</span>
<span id="cb8-379"><a href="#cb8-379" aria-hidden="true"></a>}</span></code></pre></div>
<ul>
<li><p>Rust side</p></li>
<li><p>lib.rs</p></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="co">// src/lib.rs</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="co">//! # </span><span class="al">TODO</span><span class="co"> MVC</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="co">//!</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a><span class="co">//! A [</span><span class="al">TODO</span><span class="co"> MVC](http://todomvc.com/) implementation written using [web-sys](https://rustwasm.github.io/wasm-bindgen/web-sys/overview.html)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">wasm_bindgen::prelude::</span><span class="op">*;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::rc::</span>Rc<span class="op">;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a><span class="co">/// Controller of the program</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">mod</span> controller<span class="op">;</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a><span class="co">/// Element wrapper to the DOM</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">mod</span> element<span class="op">;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true"></a><span class="co">/// Schedule messages to the Controller and View</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">mod</span> scheduler<span class="op">;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true"></a><span class="co">/// Stores items into localstorage</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">mod</span> store<span class="op">;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true"></a><span class="co">/// Handles constructing template strings from data</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">mod</span> template<span class="op">;</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true"></a><span class="co">/// Presentation layer</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">mod</span> view<span class="op">;</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::controller::</span><span class="op">{</span>Controller<span class="op">,</span> ControllerMessage<span class="op">};</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::scheduler::</span>Scheduler<span class="op">;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::store::</span>Store<span class="op">;</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::view::</span><span class="op">{</span>View<span class="op">,</span> ViewMessage<span class="op">};</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true"></a><span class="co">/// Message wrapper enum used to pass through the scheduler to the Controller or View</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">enum</span> Message <span class="op">{</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true"></a>    <span class="co">/// Message wrapper to send to the controller</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true"></a>    Controller(ControllerMessage)<span class="op">,</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true"></a>    <span class="co">/// Message wrapper to send to the view</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true"></a>    View(ViewMessage)<span class="op">,</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true"></a><span class="co">/// Used for debugging to the console</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">fn</span> exit(message<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="op">!</span> <span class="op">{</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true"></a>    <span class="kw">let</span> v <span class="op">=</span> <span class="pp">wasm_bindgen::JsValue::</span>from_str(message)<span class="op">;</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true"></a>    <span class="pp">web_sys::console::</span>exception_1(<span class="op">&amp;</span>v)<span class="op">;</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true"></a>    <span class="pp">std::process::</span>abort()</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true"></a><span class="kw">fn</span> app(name<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true"></a>    <span class="kw">let</span> sched <span class="op">=</span> <span class="pp">Rc::</span>new(<span class="pp">Scheduler::</span>new())<span class="op">;</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true"></a>    <span class="kw">let</span> store <span class="op">=</span> <span class="kw">match</span> <span class="pp">Store::</span>new(name) <span class="op">{</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true"></a>        <span class="cn">Some</span>(s) <span class="op">=&gt;</span> s<span class="op">,</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true"></a>        <span class="cn">None</span> <span class="op">=&gt;</span> <span class="kw">return</span><span class="op">,</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true"></a>    <span class="op">};</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true"></a>    <span class="kw">let</span> controller <span class="op">=</span> <span class="pp">Controller::</span>new(store<span class="op">,</span> <span class="pp">Rc::</span>downgrade(<span class="op">&amp;</span>sched))<span class="op">;</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true"></a>    <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">mut</span> view) <span class="op">=</span> <span class="pp">View::</span>new(<span class="pp">Rc::</span>clone(<span class="op">&amp;</span>sched)) <span class="op">{</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true"></a>        <span class="kw">let</span> sch<span class="op">:</span> <span class="op">&amp;</span>Rc<span class="op">&lt;</span>Scheduler<span class="op">&gt;</span> <span class="op">=</span> <span class="op">&amp;</span>sched<span class="op">;</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true"></a>        view<span class="op">.</span>init()<span class="op">;</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true"></a>        sch<span class="op">.</span>set_view(view)<span class="op">;</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true"></a>        sch<span class="op">.</span>set_controller(controller)<span class="op">;</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true"></a>        sched<span class="op">.</span>add_message(<span class="pp">Message::</span>Controller(<span class="pp">ControllerMessage::</span>SetPage(</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true"></a>            <span class="st">&quot;&quot;</span><span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true"></a>        )))<span class="op">;</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true"></a></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true"></a><span class="co">/// Entry point into the program from JavaScript</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true"></a><span class="at">#[</span>wasm_bindgen<span class="at">(</span>start<span class="at">)]</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true"></a><span class="kw">fn</span> run() <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>()<span class="op">,</span> JsValue<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true"></a>    <span class="pp">console_error_panic_hook::</span>set_once()<span class="op">;</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true"></a>    app(<span class="st">&quot;todos-wasmbindgen&quot;</span>)<span class="op">;</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true"></a></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true"></a>    <span class="cn">Ok</span>(())</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>controller.rs</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="co">/// Controller of the program</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::</span>exit<span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::store::</span><span class="op">*;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::view::</span>ViewMessage<span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::</span><span class="op">{</span>Message<span class="op">,</span> Scheduler<span class="op">};</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">js_sys::</span>Date<span class="op">;</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::cell::</span>RefCell<span class="op">;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::rc::</span>Weak<span class="op">;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true"></a><span class="co">/// The controller of the application turns page state into functionality</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> Controller <span class="op">{</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true"></a>    store<span class="op">:</span> Store<span class="op">,</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true"></a>    sched<span class="op">:</span> RefCell<span class="op">&lt;</span><span class="dt">Option</span><span class="op">&lt;</span>Weak<span class="op">&lt;</span>Scheduler<span class="op">&gt;&gt;&gt;,</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true"></a>    active_route<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true"></a>    last_active_route<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true"></a><span class="co">/// Messages that represent the methods to be called on the Controller</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">enum</span> ControllerMessage <span class="op">{</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true"></a>    AddItem(<span class="dt">String</span>)<span class="op">,</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true"></a>    SetPage(<span class="dt">String</span>)<span class="op">,</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true"></a>    EditItemSave(<span class="dt">String</span><span class="op">,</span> <span class="dt">String</span>)<span class="op">,</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true"></a>    ToggleItem(<span class="dt">String</span><span class="op">,</span> <span class="dt">bool</span>)<span class="op">,</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true"></a>    EditItemCancel(<span class="dt">String</span>)<span class="op">,</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true"></a>    RemoveCompleted()<span class="op">,</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true"></a>    RemoveItem(<span class="dt">String</span>)<span class="op">,</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true"></a>    ToggleAll(<span class="dt">bool</span>)<span class="op">,</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true"></a><span class="kw">impl</span> Controller <span class="op">{</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> new(store<span class="op">:</span> Store<span class="op">,</span> sched<span class="op">:</span> Weak<span class="op">&lt;</span>Scheduler<span class="op">&gt;</span>) <span class="op">-&gt;</span> Controller <span class="op">{</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true"></a>        Controller <span class="op">{</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true"></a>            store<span class="op">,</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true"></a>            sched<span class="op">:</span> <span class="pp">RefCell::</span>new(<span class="cn">Some</span>(sched))<span class="op">,</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true"></a>            active_route<span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">.</span>into()<span class="op">,</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true"></a>            last_active_route<span class="op">:</span> <span class="st">&quot;none&quot;</span><span class="op">.</span>into()<span class="op">,</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true"></a>    <span class="co">/// Used by `Scheduler` to convert a `ControllerMessage` into a function call on a `Controller`</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> call(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> method_name<span class="op">:</span> ControllerMessage) <span class="op">{</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true"></a>        <span class="kw">use</span> <span class="kw">self</span><span class="pp">::ControllerMessage::</span><span class="op">*;</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true"></a>        <span class="kw">match</span> method_name <span class="op">{</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true"></a>            AddItem(title) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>add_item(title)<span class="op">,</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true"></a>            SetPage(hash) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>set_page(hash)<span class="op">,</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true"></a>            EditItemSave(id<span class="op">,</span> value) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>edit_item_save(id<span class="op">,</span> value)<span class="op">,</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true"></a>            EditItemCancel(id) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>edit_item_cancel(id)<span class="op">,</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true"></a>            RemoveCompleted() <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>remove_completed_items()<span class="op">,</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true"></a>            RemoveItem(id) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>remove_item(<span class="op">&amp;</span>id)<span class="op">,</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true"></a>            ToggleAll(completed) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>toggle_all(completed)<span class="op">,</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true"></a>            ToggleItem(id<span class="op">,</span> completed) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>toggle_item(id<span class="op">,</span> completed)<span class="op">,</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true"></a>    <span class="kw">fn</span> toggle_item(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> id<span class="op">:</span> <span class="dt">String</span><span class="op">,</span> completed<span class="op">:</span> <span class="dt">bool</span>) <span class="op">{</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>toggle_completed(id<span class="op">,</span> completed)<span class="op">;</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>_filter(completed)<span class="op">;</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true"></a></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true"></a>    <span class="kw">fn</span> add_message(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> view_message<span class="op">:</span> ViewMessage) <span class="op">{</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(sched) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>sched<span class="op">.</span>try_borrow_mut() <span class="op">{</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">ref</span> sched) <span class="op">=</span> <span class="op">*</span>sched <span class="op">{</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(sched) <span class="op">=</span> sched<span class="op">.</span>upgrade() <span class="op">{</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true"></a>                    sched<span class="op">.</span>add_message(<span class="pp">Message::</span>View(view_message))<span class="op">;</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true"></a></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> set_page(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> raw<span class="op">:</span> <span class="dt">String</span>) <span class="op">{</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true"></a>        <span class="kw">let</span> route <span class="op">=</span> raw<span class="op">.</span>trim_start_matches(<span class="st">&quot;#/&quot;</span>)<span class="op">;</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>active_route <span class="op">=</span> route<span class="op">.</span>to_string()<span class="op">;</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>_filter(<span class="cn">false</span>)<span class="op">;</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>add_message(<span class="pp">ViewMessage::</span>UpdateFilterButtons(route<span class="op">.</span>to_string()))<span class="op">;</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true"></a></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true"></a>    <span class="co">/// Add an Item to the Store and display it in the list.</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true"></a>    <span class="kw">fn</span> add_item(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> title<span class="op">:</span> <span class="dt">String</span>) <span class="op">{</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>store<span class="op">.</span>insert(Item <span class="op">{</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true"></a>            id<span class="op">:</span> <span class="pp">Date::</span>now()<span class="op">.</span>to_string()<span class="op">,</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true"></a>            title<span class="op">,</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true"></a>            completed<span class="op">:</span> <span class="cn">false</span><span class="op">,</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true"></a>        <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>add_message(<span class="pp">ViewMessage::</span>ClearNewTodo())<span class="op">;</span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>_filter(<span class="cn">true</span>)<span class="op">;</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true"></a></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true"></a>    <span class="co">/// Save an Item in edit.</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true"></a>    <span class="kw">fn</span> edit_item_save(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> id<span class="op">:</span> <span class="dt">String</span><span class="op">,</span> title<span class="op">:</span> <span class="dt">String</span>) <span class="op">{</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true"></a>        <span class="kw">if</span> <span class="op">!</span>title<span class="op">.</span>is_empty() <span class="op">{</span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>store<span class="op">.</span>update(<span class="pp">ItemUpdate::</span>Title <span class="op">{</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true"></a>                id<span class="op">:</span> id<span class="op">.</span>clone()<span class="op">,</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true"></a>                title<span class="op">:</span> title<span class="op">.</span>clone()<span class="op">,</span></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true"></a>            <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>add_message(<span class="pp">ViewMessage::</span>EditItemDone(id<span class="op">.</span>to_string()<span class="op">,</span> title))<span class="op">;</span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>remove_item(<span class="op">&amp;</span>id)<span class="op">;</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true"></a></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true"></a>    <span class="co">/// Cancel the item editing mode.</span></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true"></a>    <span class="kw">fn</span> edit_item_cancel(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> id<span class="op">:</span> <span class="dt">String</span>) <span class="op">{</span></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> message <span class="op">=</span> <span class="cn">None</span><span class="op">;</span></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(data) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>store<span class="op">.</span>find(<span class="pp">ItemQuery::</span>Id <span class="op">{</span> id<span class="op">:</span> id<span class="op">.</span>clone() <span class="op">}</span>) <span class="op">{</span></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(todo) <span class="op">=</span> data<span class="op">.</span>get(<span class="dv">0</span>) <span class="op">{</span></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true"></a>                <span class="kw">let</span> title <span class="op">=</span> todo<span class="op">.</span>title<span class="op">.</span>to_string()<span class="op">;</span></span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true"></a>                message <span class="op">=</span> <span class="cn">Some</span>(<span class="pp">ViewMessage::</span>EditItemDone(id<span class="op">,</span> title))<span class="op">;</span></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(message) <span class="op">=</span> message <span class="op">{</span></span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>add_message(message)<span class="op">;</span></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true"></a></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true"></a>    <span class="co">/// Remove the data and elements related to an Item.</span></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true"></a>    <span class="kw">fn</span> remove_item(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> id<span class="op">:</span> <span class="op">&amp;</span><span class="dt">String</span>) <span class="op">{</span></span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>store<span class="op">.</span>remove(<span class="pp">ItemQuery::</span>Id <span class="op">{</span> id<span class="op">:</span> id<span class="op">.</span>clone() <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>_filter(<span class="cn">false</span>)<span class="op">;</span></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true"></a>        <span class="kw">let</span> ritem <span class="op">=</span> id<span class="op">.</span>to_string()<span class="op">;</span></span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>add_message(<span class="pp">ViewMessage::</span>RemoveItem(ritem))<span class="op">;</span></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true"></a></span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true"></a>    <span class="co">/// Remove all completed items.</span></span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true"></a>    <span class="kw">fn</span> remove_completed_items(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>store<span class="op">.</span>remove(<span class="pp">ItemQuery::</span>Completed <span class="op">{</span> completed<span class="op">:</span> <span class="cn">true</span> <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>_filter(<span class="cn">true</span>)<span class="op">;</span></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true"></a></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true"></a>    <span class="co">/// Update an Item in storage based on the state of completed.</span></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true"></a>    <span class="kw">fn</span> toggle_completed(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> id<span class="op">:</span> <span class="dt">String</span><span class="op">,</span> completed<span class="op">:</span> <span class="dt">bool</span>) <span class="op">{</span></span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>store<span class="op">.</span>update(<span class="pp">ItemUpdate::</span>Completed <span class="op">{</span></span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true"></a>            id<span class="op">:</span> id<span class="op">.</span>clone()<span class="op">,</span></span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true"></a>            completed<span class="op">,</span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true"></a>        <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true"></a>        <span class="kw">let</span> tid <span class="op">=</span> id<span class="op">;</span></span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>add_message(<span class="pp">ViewMessage::</span>SetItemComplete(tid<span class="op">,</span> completed))<span class="op">;</span></span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true"></a></span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true"></a>    <span class="co">/// Set all items to complete or active.</span></span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true"></a>    <span class="kw">fn</span> toggle_all(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> completed<span class="op">:</span> <span class="dt">bool</span>) <span class="op">{</span></span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> vals <span class="op">=</span> <span class="dt">Vec</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(data) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>store<span class="op">.</span>find(<span class="pp">ItemQuery::</span>EmptyItemQuery) <span class="op">{</span></span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true"></a>            vals<span class="op">.</span>extend(data<span class="op">.</span>iter()<span class="op">.</span>map(<span class="op">|</span>item<span class="op">|</span> item<span class="op">.</span>id<span class="op">.</span>clone()))<span class="op">;</span></span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true"></a>        <span class="kw">for</span> id <span class="kw">in</span> vals<span class="op">.</span>iter() <span class="op">{</span></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>toggle_completed(id<span class="op">.</span>to_string()<span class="op">,</span> completed)<span class="op">;</span></span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>_filter(<span class="cn">false</span>)<span class="op">;</span></span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true"></a></span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true"></a>    <span class="co">/// Refresh the list based on the current route.</span></span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true"></a>    <span class="kw">fn</span> _filter(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> force<span class="op">:</span> <span class="dt">bool</span>) <span class="op">{</span></span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true"></a>        <span class="kw">let</span> route <span class="op">=</span> <span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>active_route<span class="op">;</span></span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true"></a></span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true"></a>        <span class="kw">if</span> force <span class="op">||</span> <span class="op">!</span><span class="kw">self</span><span class="op">.</span>last_active_route<span class="op">.</span>is_empty() <span class="op">||</span> <span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>last_active_route <span class="op">!=</span> route <span class="op">{</span></span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true"></a>            <span class="kw">let</span> query <span class="op">=</span> <span class="kw">match</span> route<span class="op">.</span>as_str() <span class="op">{</span></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true"></a>                <span class="st">&quot;completed&quot;</span> <span class="op">=&gt;</span> <span class="pp">ItemQuery::</span>Completed <span class="op">{</span> completed<span class="op">:</span> <span class="cn">true</span> <span class="op">},</span></span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true"></a>                <span class="st">&quot;active&quot;</span> <span class="op">=&gt;</span> <span class="pp">ItemQuery::</span>Completed <span class="op">{</span> completed<span class="op">:</span> <span class="cn">false</span> <span class="op">},</span></span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true"></a>                _ <span class="op">=&gt;</span> <span class="pp">ItemQuery::</span>EmptyItemQuery<span class="op">,</span></span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true"></a>            <span class="op">};</span></span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true"></a>            <span class="kw">let</span> <span class="kw">mut</span> v <span class="op">=</span> <span class="cn">None</span><span class="op">;</span></span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true"></a>            <span class="op">{</span></span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true"></a>                <span class="kw">let</span> store <span class="op">=</span> <span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">.</span>store<span class="op">;</span></span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(res) <span class="op">=</span> store<span class="op">.</span>find(query) <span class="op">{</span></span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true"></a>                    v <span class="op">=</span> <span class="cn">Some</span>(res<span class="op">.</span>into())<span class="op">;</span></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(res) <span class="op">=</span> v <span class="op">{</span></span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true"></a>                <span class="kw">self</span><span class="op">.</span>add_message(<span class="pp">ViewMessage::</span>ShowItems(res))<span class="op">;</span></span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true"></a></span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>((total<span class="op">,</span> active<span class="op">,</span> completed)) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>store<span class="op">.</span>count() <span class="op">{</span></span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>add_message(<span class="pp">ViewMessage::</span>SetItemsLeft(active))<span class="op">;</span></span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>add_message(<span class="pp">ViewMessage::</span>SetClearCompletedButtonVisibility(</span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true"></a>                completed <span class="op">&gt;</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true"></a>            ))<span class="op">;</span></span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>add_message(<span class="pp">ViewMessage::</span>SetCompleteAllCheckbox(completed <span class="op">==</span> total))<span class="op">;</span></span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>add_message(<span class="pp">ViewMessage::</span>SetMainVisibility(total <span class="op">&gt;</span> <span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true"></a></span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>last_active_route <span class="op">=</span> route<span class="op">.</span>to_string()<span class="op">;</span></span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true"></a></span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true"></a><span class="kw">impl</span> <span class="bu">Drop</span> <span class="kw">for</span> Controller <span class="op">{</span></span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true"></a>    <span class="kw">fn</span> drop(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true"></a>        exit(<span class="st">&quot;calling drop on Controller&quot;</span>)<span class="op">;</span></span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>element.rs</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="co">/// Element wrapper to the DOM</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">wasm_bindgen::prelude::</span><span class="op">*;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">web_sys::</span>EventTarget<span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a><span class="co">/// Wrapper for `web_sys::Element` to simplify calling different interfaces</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> Element <span class="op">{</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true"></a>    el<span class="op">:</span> <span class="dt">Option</span><span class="op">&lt;</span><span class="pp">web_sys::</span>Element<span class="op">&gt;,</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true"></a><span class="kw">impl</span> <span class="bu">From</span><span class="op">&lt;</span><span class="pp">web_sys::</span>Element<span class="op">&gt;</span> <span class="kw">for</span> Element <span class="op">{</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true"></a>    <span class="kw">fn</span> from(el<span class="op">:</span> <span class="pp">web_sys::</span>Element) <span class="op">-&gt;</span> Element <span class="op">{</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true"></a>        Element <span class="op">{</span> el<span class="op">:</span> <span class="cn">Some</span>(el) <span class="op">}</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true"></a><span class="kw">impl</span> <span class="bu">From</span><span class="op">&lt;</span><span class="pp">web_sys::</span>EventTarget<span class="op">&gt;</span> <span class="kw">for</span> Element <span class="op">{</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true"></a>    <span class="kw">fn</span> from(el<span class="op">:</span> <span class="pp">web_sys::</span>EventTarget) <span class="op">-&gt;</span> Element <span class="op">{</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true"></a>        <span class="kw">let</span> el <span class="op">=</span> <span class="pp">wasm_bindgen::JsCast::dyn_into::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>Element<span class="op">&gt;</span>(el)<span class="op">;</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true"></a>        Element <span class="op">{</span> el<span class="op">:</span> el<span class="op">.</span>ok() <span class="op">}</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true"></a><span class="kw">impl</span> <span class="bu">From</span><span class="op">&lt;</span>Element<span class="op">&gt;</span> <span class="kw">for</span> <span class="dt">Option</span><span class="op">&lt;</span><span class="pp">web_sys::</span>Node<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true"></a>    <span class="kw">fn</span> from(obj<span class="op">:</span> Element) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span><span class="pp">web_sys::</span>Node<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true"></a>        obj<span class="op">.</span>el<span class="op">.</span>map(<span class="bu">Into</span><span class="pp">::</span>into)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true"></a><span class="kw">impl</span> <span class="bu">From</span><span class="op">&lt;</span>Element<span class="op">&gt;</span> <span class="kw">for</span> <span class="dt">Option</span><span class="op">&lt;</span>EventTarget<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true"></a>    <span class="kw">fn</span> from(obj<span class="op">:</span> Element) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>EventTarget<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true"></a>        obj<span class="op">.</span>el<span class="op">.</span>map(<span class="bu">Into</span><span class="pp">::</span>into)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true"></a><span class="kw">impl</span> Element <span class="op">{</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true"></a>    <span class="co">// Create an element from a tag name</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> create_element(tag<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>Element<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true"></a>        <span class="kw">let</span> el <span class="op">=</span> <span class="pp">web_sys::</span>window()<span class="op">?.</span>document()<span class="op">?.</span>create_element(tag)<span class="op">.</span>ok()<span class="op">?;</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true"></a>        <span class="cn">Some</span>(el<span class="op">.</span>into())</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> qs(selector<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>Element<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true"></a>        <span class="kw">let</span> body<span class="op">:</span> <span class="pp">web_sys::</span>Element <span class="op">=</span> <span class="pp">web_sys::</span>window()<span class="op">?.</span>document()<span class="op">?.</span>body()<span class="op">?.</span>into()<span class="op">;</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true"></a>        <span class="kw">let</span> el <span class="op">=</span> body<span class="op">.</span>query_selector(selector)<span class="op">.</span>ok()<span class="op">?;</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true"></a>        <span class="cn">Some</span>(Element <span class="op">{</span> el <span class="op">}</span>)</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true"></a>    <span class="co">/// Add event listener to this node</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> add_event_listener<span class="op">&lt;</span>T<span class="op">&gt;</span>(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> event_name<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> handler<span class="op">:</span> T)</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true"></a>    <span class="kw">where</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true"></a>        T<span class="op">:</span> <span class="ot">&#39;static</span> <span class="op">+</span> <span class="bu">FnMut</span>(<span class="pp">web_sys::</span>Event)<span class="op">,</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true"></a>    <span class="op">{</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true"></a>        <span class="kw">let</span> cb <span class="op">=</span> <span class="pp">Closure::</span>new(handler)<span class="op">;</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true"></a>            <span class="kw">let</span> el_et<span class="op">:</span> EventTarget <span class="op">=</span> el<span class="op">.</span>into()<span class="op">;</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true"></a>            el_et</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true"></a>                <span class="op">.</span>add_event_listener_with_callback(event_name<span class="op">,</span> cb<span class="op">.</span>as_ref()<span class="op">.</span>unchecked_ref())</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true"></a>                <span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true"></a>            cb<span class="op">.</span>forget()<span class="op">;</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(el) <span class="op">=</span> el_et<span class="op">.</span><span class="pp">dyn_into::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>Element<span class="op">&gt;</span>() <span class="op">{</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true"></a>                <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true"></a></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true"></a>    <span class="co">/// Delegate an event to a selector</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> delegate<span class="op">&lt;</span>T<span class="op">&gt;</span>(</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true"></a>        <span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true"></a>        selector<span class="op">:</span> <span class="op">&amp;</span><span class="ot">&#39;static</span> <span class="dt">str</span><span class="op">,</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true"></a>        event<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true"></a>        <span class="kw">mut</span> handler<span class="op">:</span> T<span class="op">,</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true"></a>        use_capture<span class="op">:</span> <span class="dt">bool</span><span class="op">,</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true"></a>    ) <span class="kw">where</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true"></a>        T<span class="op">:</span> <span class="ot">&#39;static</span> <span class="op">+</span> <span class="bu">FnMut</span>(<span class="pp">web_sys::</span>Event)<span class="op">,</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true"></a>    <span class="op">{</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true"></a>        <span class="kw">let</span> el <span class="op">=</span> <span class="kw">match</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true"></a>            <span class="cn">Some</span>(e) <span class="op">=&gt;</span> e<span class="op">,</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true"></a>            <span class="cn">None</span> <span class="op">=&gt;</span> <span class="kw">return</span><span class="op">,</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true"></a>        <span class="op">};</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(dyn_el) <span class="op">=</span> <span class="op">&amp;</span>el<span class="op">.</span><span class="pp">dyn_ref::</span><span class="op">&lt;</span>EventTarget<span class="op">&gt;</span>() <span class="op">{</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(window) <span class="op">=</span> <span class="pp">web_sys::</span>window() <span class="op">{</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(document) <span class="op">=</span> window<span class="op">.</span>document() <span class="op">{</span></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true"></a>                    <span class="co">// </span><span class="al">TODO</span><span class="co"> document selector to the target element</span></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true"></a>                    <span class="kw">let</span> tg_el <span class="op">=</span> document<span class="op">;</span></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true"></a></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true"></a>                    <span class="kw">let</span> cb <span class="op">=</span> <span class="pp">Closure::</span>new(<span class="kw">move</span> <span class="op">|</span>event<span class="op">:</span> <span class="pp">web_sys::</span>Event<span class="op">|</span> <span class="op">{</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true"></a>                        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(target_element) <span class="op">=</span> event<span class="op">.</span>target() <span class="op">{</span></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true"></a>                            <span class="kw">let</span> dyn_target_el<span class="op">:</span> <span class="dt">Option</span><span class="op">&lt;&amp;</span><span class="pp">web_sys::</span>Node<span class="op">&gt;</span> <span class="op">=</span></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true"></a>                                <span class="pp">wasm_bindgen::JsCast::</span>dyn_ref(<span class="op">&amp;</span>target_element)<span class="op">;</span></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true"></a>                            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(target_element) <span class="op">=</span> dyn_target_el <span class="op">{</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true"></a>                                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(potential_elements) <span class="op">=</span> tg_el<span class="op">.</span>query_selector_all(selector) <span class="op">{</span></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true"></a>                                    <span class="kw">let</span> <span class="kw">mut</span> has_match <span class="op">=</span> <span class="cn">false</span><span class="op">;</span></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true"></a>                                    <span class="kw">for</span> i <span class="kw">in</span> <span class="dv">0</span><span class="op">..</span>potential_elements<span class="op">.</span>length() <span class="op">{</span></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true"></a>                                        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> potential_elements<span class="op">.</span>get(i) <span class="op">{</span></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true"></a>                                            <span class="kw">if</span> target_element<span class="op">.</span>is_equal_node(<span class="cn">Some</span>(<span class="op">&amp;</span>el)) <span class="op">{</span></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true"></a>                                                has_match <span class="op">=</span> <span class="cn">true</span><span class="op">;</span></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true"></a>                                            <span class="op">}</span></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true"></a>                                            <span class="kw">break</span><span class="op">;</span></span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true"></a>                                        <span class="op">}</span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true"></a>                                    <span class="op">}</span></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true"></a></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true"></a>                                    <span class="kw">if</span> has_match <span class="op">{</span></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true"></a>                                        handler(event)<span class="op">;</span></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true"></a>                                    <span class="op">}</span></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true"></a>                                <span class="op">}</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true"></a>                            <span class="op">}</span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true"></a>                        <span class="op">}</span></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true"></a>                    <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true"></a></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true"></a>                    dyn_el</span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true"></a>                        <span class="op">.</span>add_event_listener_with_callback_and_bool(</span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true"></a>                            event<span class="op">,</span></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true"></a>                            cb<span class="op">.</span>as_ref()<span class="op">.</span>unchecked_ref()<span class="op">,</span></span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true"></a>                            use_capture<span class="op">,</span></span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true"></a>                        )</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true"></a>                        <span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true"></a>                    cb<span class="op">.</span>forget()<span class="op">;</span> <span class="co">// </span><span class="al">TODO</span><span class="co"> cycle collect</span></span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true"></a></span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true"></a>    <span class="co">/// Find child `Element`s from this node</span></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> qs_from(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> selector<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>Element<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> found_el <span class="op">=</span> <span class="cn">None</span><span class="op">;</span></span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>as_ref() <span class="op">{</span></span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true"></a>            found_el <span class="op">=</span> <span class="cn">Some</span>(Element <span class="op">{</span></span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true"></a>                el<span class="op">:</span> el<span class="op">.</span>query_selector(selector)<span class="op">.</span>ok()<span class="op">?,</span></span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true"></a>            <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true"></a>        found_el</span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true"></a></span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true"></a>    <span class="co">/// Sets the inner HTML of the `self.el` element</span></span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> set_inner_html(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> value<span class="op">:</span> <span class="dt">String</span>) <span class="op">{</span></span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true"></a>            el<span class="op">.</span>set_inner_html(<span class="op">&amp;</span>value)<span class="op">;</span></span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true"></a></span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true"></a>    <span class="co">/// Sets the text content of the `self.el` element</span></span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> set_text_content(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> value<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>as_ref() <span class="op">{</span></span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(node) <span class="op">=</span> <span class="op">&amp;</span>el<span class="op">.</span><span class="pp">dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>Node<span class="op">&gt;</span>() <span class="op">{</span></span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true"></a>                node<span class="op">.</span>set_text_content(<span class="cn">Some</span>(value))<span class="op">;</span></span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true"></a></span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true"></a>    <span class="co">/// Gets the text content of the `self.el` element</span></span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> text_content(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> text <span class="op">=</span> <span class="cn">None</span><span class="op">;</span></span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>as_ref() <span class="op">{</span></span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(node) <span class="op">=</span> <span class="op">&amp;</span>el<span class="op">.</span><span class="pp">dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>Node<span class="op">&gt;</span>() <span class="op">{</span></span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true"></a>                text <span class="op">=</span> node<span class="op">.</span>text_content()<span class="op">;</span></span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true"></a>        text</span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true"></a></span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true"></a>    <span class="co">/// Gets the parent of the `self.el` element</span></span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> parent_element(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>Element<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> parent <span class="op">=</span> <span class="cn">None</span><span class="op">;</span></span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>as_ref() <span class="op">{</span></span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(node) <span class="op">=</span> <span class="op">&amp;</span>el<span class="op">.</span><span class="pp">dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>Node<span class="op">&gt;</span>() <span class="op">{</span></span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(parent_node) <span class="op">=</span> node<span class="op">.</span>parent_element() <span class="op">{</span></span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true"></a>                    parent <span class="op">=</span> <span class="cn">Some</span>(parent_node<span class="op">.</span>into())<span class="op">;</span></span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true"></a>        parent</span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true"></a></span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true"></a>    <span class="co">/// Gets the parent of the `self.el` element</span></span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> append_child(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> child<span class="op">:</span> <span class="op">&amp;</span><span class="kw">mut</span> Element) <span class="op">{</span></span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>as_ref() <span class="op">{</span></span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(node) <span class="op">=</span> <span class="op">&amp;</span>el<span class="op">.</span><span class="pp">dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>Node<span class="op">&gt;</span>() <span class="op">{</span></span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">ref</span> child_el) <span class="op">=</span> child<span class="op">.</span>el <span class="op">{</span></span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true"></a>                    <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(child_node) <span class="op">=</span> child_el<span class="op">.</span><span class="pp">dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>Node<span class="op">&gt;</span>() <span class="op">{</span></span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true"></a>                        node<span class="op">.</span>append_child(child_node)<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true"></a>                    <span class="op">}</span></span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true"></a></span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true"></a>    <span class="co">/// Removes a class list item from the element</span></span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true"></a>    <span class="co">///</span></span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true"></a>    <span class="co">/// ```</span></span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true"></a>    <span class="co">/// e.class_list_remove(String::from(&quot;clickable&quot;));</span></span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true"></a>    <span class="co">/// // removes the class &#39;clickable&#39; from e.el</span></span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true"></a>    <span class="co">/// ```</span></span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> class_list_remove(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> value<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-197"><a href="#cb11-197" aria-hidden="true"></a>            el<span class="op">.</span>class_list()<span class="op">.</span>remove_1(value)<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb11-198"><a href="#cb11-198" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-199"><a href="#cb11-199" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-200"><a href="#cb11-200" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true"></a></span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> class_list_add(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> value<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true"></a>            el<span class="op">.</span>class_list()<span class="op">.</span>add_1(value)<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-207"><a href="#cb11-207" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-208"><a href="#cb11-208" aria-hidden="true"></a></span>
<span id="cb11-209"><a href="#cb11-209" aria-hidden="true"></a>    <span class="co">/// Given another `Element` it will remove that child from the DOM from this element</span></span>
<span id="cb11-210"><a href="#cb11-210" aria-hidden="true"></a>    <span class="co">/// Consumes `child` so it can&#39;t be used after it&#39;s removal.</span></span>
<span id="cb11-211"><a href="#cb11-211" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> remove_child(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> <span class="kw">mut</span> child<span class="op">:</span> Element) <span class="op">{</span></span>
<span id="cb11-212"><a href="#cb11-212" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(child_el) <span class="op">=</span> child<span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-213"><a href="#cb11-213" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-214"><a href="#cb11-214" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el_node) <span class="op">=</span> el<span class="op">.</span><span class="pp">dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>Node<span class="op">&gt;</span>() <span class="op">{</span></span>
<span id="cb11-215"><a href="#cb11-215" aria-hidden="true"></a>                    <span class="kw">let</span> child_node<span class="op">:</span> <span class="pp">web_sys::</span>Node <span class="op">=</span> child_el<span class="op">.</span>into()<span class="op">;</span></span>
<span id="cb11-216"><a href="#cb11-216" aria-hidden="true"></a>                    el_node<span class="op">.</span>remove_child(<span class="op">&amp;</span>child_node)<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb11-217"><a href="#cb11-217" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb11-218"><a href="#cb11-218" aria-hidden="true"></a>                <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-219"><a href="#cb11-219" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-220"><a href="#cb11-220" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-221"><a href="#cb11-221" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-222"><a href="#cb11-222" aria-hidden="true"></a></span>
<span id="cb11-223"><a href="#cb11-223" aria-hidden="true"></a>    <span class="co">/// Sets the whole class value for `self.el`</span></span>
<span id="cb11-224"><a href="#cb11-224" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> set_class_name(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> class_name<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb11-225"><a href="#cb11-225" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-226"><a href="#cb11-226" aria-hidden="true"></a>            el<span class="op">.</span>set_class_name(class_name)<span class="op">;</span></span>
<span id="cb11-227"><a href="#cb11-227" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-228"><a href="#cb11-228" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-229"><a href="#cb11-229" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-230"><a href="#cb11-230" aria-hidden="true"></a></span>
<span id="cb11-231"><a href="#cb11-231" aria-hidden="true"></a>    <span class="co">/// Sets the visibility for the element in `self.el`</span></span>
<span id="cb11-232"><a href="#cb11-232" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> set_visibility(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> visible<span class="op">:</span> <span class="dt">bool</span>) <span class="op">{</span></span>
<span id="cb11-233"><a href="#cb11-233" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-234"><a href="#cb11-234" aria-hidden="true"></a>            <span class="op">{</span></span>
<span id="cb11-235"><a href="#cb11-235" aria-hidden="true"></a>                <span class="kw">let</span> dyn_el<span class="op">:</span> <span class="dt">Option</span><span class="op">&lt;&amp;</span><span class="pp">web_sys::</span>HtmlElement<span class="op">&gt;</span> <span class="op">=</span> <span class="pp">wasm_bindgen::JsCast::</span>dyn_ref(<span class="op">&amp;</span>el)<span class="op">;</span></span>
<span id="cb11-236"><a href="#cb11-236" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> dyn_el <span class="op">{</span></span>
<span id="cb11-237"><a href="#cb11-237" aria-hidden="true"></a>                    el<span class="op">.</span>set_hidden(<span class="op">!</span>visible)<span class="op">;</span></span>
<span id="cb11-238"><a href="#cb11-238" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb11-239"><a href="#cb11-239" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-240"><a href="#cb11-240" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-241"><a href="#cb11-241" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-242"><a href="#cb11-242" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-243"><a href="#cb11-243" aria-hidden="true"></a></span>
<span id="cb11-244"><a href="#cb11-244" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> blur(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb11-245"><a href="#cb11-245" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-246"><a href="#cb11-246" aria-hidden="true"></a>            <span class="op">{</span></span>
<span id="cb11-247"><a href="#cb11-247" aria-hidden="true"></a>                <span class="kw">let</span> dyn_el<span class="op">:</span> <span class="dt">Option</span><span class="op">&lt;&amp;</span><span class="pp">web_sys::</span>HtmlElement<span class="op">&gt;</span> <span class="op">=</span> <span class="pp">wasm_bindgen::JsCast::</span>dyn_ref(<span class="op">&amp;</span>el)<span class="op">;</span></span>
<span id="cb11-248"><a href="#cb11-248" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> dyn_el <span class="op">{</span></span>
<span id="cb11-249"><a href="#cb11-249" aria-hidden="true"></a>                    <span class="co">// There isn&#39;t much we can do with the result here so ignore</span></span>
<span id="cb11-250"><a href="#cb11-250" aria-hidden="true"></a>                    el<span class="op">.</span>blur()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb11-251"><a href="#cb11-251" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb11-252"><a href="#cb11-252" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-253"><a href="#cb11-253" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-254"><a href="#cb11-254" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-255"><a href="#cb11-255" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-256"><a href="#cb11-256" aria-hidden="true"></a></span>
<span id="cb11-257"><a href="#cb11-257" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> focus(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb11-258"><a href="#cb11-258" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-259"><a href="#cb11-259" aria-hidden="true"></a>            <span class="op">{</span></span>
<span id="cb11-260"><a href="#cb11-260" aria-hidden="true"></a>                <span class="kw">let</span> dyn_el<span class="op">:</span> <span class="dt">Option</span><span class="op">&lt;&amp;</span><span class="pp">web_sys::</span>HtmlElement<span class="op">&gt;</span> <span class="op">=</span> <span class="pp">wasm_bindgen::JsCast::</span>dyn_ref(<span class="op">&amp;</span>el)<span class="op">;</span></span>
<span id="cb11-261"><a href="#cb11-261" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> dyn_el <span class="op">{</span></span>
<span id="cb11-262"><a href="#cb11-262" aria-hidden="true"></a>                    <span class="co">// There isn&#39;t much we can do with the result here so ignore</span></span>
<span id="cb11-263"><a href="#cb11-263" aria-hidden="true"></a>                    el<span class="op">.</span>focus()<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb11-264"><a href="#cb11-264" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb11-265"><a href="#cb11-265" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-266"><a href="#cb11-266" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-267"><a href="#cb11-267" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-268"><a href="#cb11-268" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-269"><a href="#cb11-269" aria-hidden="true"></a></span>
<span id="cb11-270"><a href="#cb11-270" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> dataset_set(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> key<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> value<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb11-271"><a href="#cb11-271" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-272"><a href="#cb11-272" aria-hidden="true"></a>            <span class="op">{</span></span>
<span id="cb11-273"><a href="#cb11-273" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="pp">wasm_bindgen::JsCast::dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>HtmlElement<span class="op">&gt;</span>(<span class="op">&amp;</span>el) <span class="op">{</span></span>
<span id="cb11-274"><a href="#cb11-274" aria-hidden="true"></a>                    el<span class="op">.</span>dataset()<span class="op">.</span>set(key<span class="op">,</span> value)<span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb11-275"><a href="#cb11-275" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb11-276"><a href="#cb11-276" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-277"><a href="#cb11-277" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-278"><a href="#cb11-278" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-279"><a href="#cb11-279" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-280"><a href="#cb11-280" aria-hidden="true"></a></span>
<span id="cb11-281"><a href="#cb11-281" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> dataset_get(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> key<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb11-282"><a href="#cb11-282" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> text <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb11-283"><a href="#cb11-283" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-284"><a href="#cb11-284" aria-hidden="true"></a>            <span class="op">{</span></span>
<span id="cb11-285"><a href="#cb11-285" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="pp">wasm_bindgen::JsCast::dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>HtmlElement<span class="op">&gt;</span>(<span class="op">&amp;</span>el) <span class="op">{</span></span>
<span id="cb11-286"><a href="#cb11-286" aria-hidden="true"></a>                    <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(value) <span class="op">=</span> el<span class="op">.</span>dataset()<span class="op">.</span>get(key) <span class="op">{</span></span>
<span id="cb11-287"><a href="#cb11-287" aria-hidden="true"></a>                        text <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb11-288"><a href="#cb11-288" aria-hidden="true"></a>                    <span class="op">}</span></span>
<span id="cb11-289"><a href="#cb11-289" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb11-290"><a href="#cb11-290" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-291"><a href="#cb11-291" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-292"><a href="#cb11-292" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-293"><a href="#cb11-293" aria-hidden="true"></a>        text</span>
<span id="cb11-294"><a href="#cb11-294" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-295"><a href="#cb11-295" aria-hidden="true"></a></span>
<span id="cb11-296"><a href="#cb11-296" aria-hidden="true"></a>    <span class="co">/// Sets the value for the element in `self.el` (The element must be an input)</span></span>
<span id="cb11-297"><a href="#cb11-297" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> set_value(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> value<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb11-298"><a href="#cb11-298" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-299"><a href="#cb11-299" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="pp">wasm_bindgen::JsCast::dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>HtmlInputElement<span class="op">&gt;</span>(<span class="op">&amp;</span>el) <span class="op">{</span></span>
<span id="cb11-300"><a href="#cb11-300" aria-hidden="true"></a>                el<span class="op">.</span>set_value(value)<span class="op">;</span></span>
<span id="cb11-301"><a href="#cb11-301" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-302"><a href="#cb11-302" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-303"><a href="#cb11-303" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-304"><a href="#cb11-304" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-305"><a href="#cb11-305" aria-hidden="true"></a></span>
<span id="cb11-306"><a href="#cb11-306" aria-hidden="true"></a>    <span class="co">/// Gets the value for the element in `self.el` (The element must be an input)</span></span>
<span id="cb11-307"><a href="#cb11-307" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> value(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb11-308"><a href="#cb11-308" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> v <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb11-309"><a href="#cb11-309" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-310"><a href="#cb11-310" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="pp">wasm_bindgen::JsCast::dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>HtmlInputElement<span class="op">&gt;</span>(<span class="op">&amp;</span>el) <span class="op">{</span></span>
<span id="cb11-311"><a href="#cb11-311" aria-hidden="true"></a>                v <span class="op">=</span> el<span class="op">.</span>value()<span class="op">;</span></span>
<span id="cb11-312"><a href="#cb11-312" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-313"><a href="#cb11-313" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-314"><a href="#cb11-314" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-315"><a href="#cb11-315" aria-hidden="true"></a>        v</span>
<span id="cb11-316"><a href="#cb11-316" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-317"><a href="#cb11-317" aria-hidden="true"></a></span>
<span id="cb11-318"><a href="#cb11-318" aria-hidden="true"></a>    <span class="co">/// Sets the checked state for the element in `self.el` (The element must be an input)</span></span>
<span id="cb11-319"><a href="#cb11-319" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> set_checked(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> checked<span class="op">:</span> <span class="dt">bool</span>) <span class="op">{</span></span>
<span id="cb11-320"><a href="#cb11-320" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-321"><a href="#cb11-321" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="pp">wasm_bindgen::JsCast::dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>HtmlInputElement<span class="op">&gt;</span>(<span class="op">&amp;</span>el) <span class="op">{</span></span>
<span id="cb11-322"><a href="#cb11-322" aria-hidden="true"></a>                el<span class="op">.</span>set_checked(checked)<span class="op">;</span></span>
<span id="cb11-323"><a href="#cb11-323" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-324"><a href="#cb11-324" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-325"><a href="#cb11-325" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-326"><a href="#cb11-326" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-327"><a href="#cb11-327" aria-hidden="true"></a></span>
<span id="cb11-328"><a href="#cb11-328" aria-hidden="true"></a>    <span class="co">/// Gets the checked state for the element in `self.el` (The element must be an input)</span></span>
<span id="cb11-329"><a href="#cb11-329" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> checked(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb11-330"><a href="#cb11-330" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> checked <span class="op">=</span> <span class="cn">false</span><span class="op">;</span></span>
<span id="cb11-331"><a href="#cb11-331" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>el<span class="op">.</span>take() <span class="op">{</span></span>
<span id="cb11-332"><a href="#cb11-332" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(el) <span class="op">=</span> <span class="pp">wasm_bindgen::JsCast::dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>HtmlInputElement<span class="op">&gt;</span>(<span class="op">&amp;</span>el) <span class="op">{</span></span>
<span id="cb11-333"><a href="#cb11-333" aria-hidden="true"></a>                checked <span class="op">=</span> el<span class="op">.</span>checked()<span class="op">;</span></span>
<span id="cb11-334"><a href="#cb11-334" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb11-335"><a href="#cb11-335" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>el <span class="op">=</span> <span class="cn">Some</span>(el)<span class="op">;</span></span>
<span id="cb11-336"><a href="#cb11-336" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb11-337"><a href="#cb11-337" aria-hidden="true"></a>        checked</span>
<span id="cb11-338"><a href="#cb11-338" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb11-339"><a href="#cb11-339" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>scheduler.rs</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a><span class="co">/// Schedule messages to the Controller and View</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::controller::</span>Controller<span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::</span>exit<span class="op">;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::view::</span>View<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::</span>Message<span class="op">;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::cell::</span>RefCell<span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::rc::</span>Rc<span class="op">;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true"></a><span class="co">/// Creates an event loop that starts each time a message is added</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> Scheduler <span class="op">{</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true"></a>    controller<span class="op">:</span> Rc<span class="op">&lt;</span>RefCell<span class="op">&lt;</span><span class="dt">Option</span><span class="op">&lt;</span>Controller<span class="op">&gt;&gt;&gt;,</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true"></a>    view<span class="op">:</span> Rc<span class="op">&lt;</span>RefCell<span class="op">&lt;</span><span class="dt">Option</span><span class="op">&lt;</span>View<span class="op">&gt;&gt;&gt;,</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true"></a>    events<span class="op">:</span> RefCell<span class="op">&lt;</span><span class="dt">Vec</span><span class="op">&lt;</span>Message<span class="op">&gt;&gt;,</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true"></a>    running<span class="op">:</span> RefCell<span class="op">&lt;</span><span class="dt">bool</span><span class="op">&gt;,</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true"></a><span class="kw">fn</span> deadlock() <span class="op">-&gt;</span> <span class="op">!</span> <span class="op">{</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true"></a>    exit(<span class="st">&quot;This might be a deadlock&quot;</span>)<span class="op">;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true"></a><span class="kw">impl</span> Scheduler <span class="op">{</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true"></a>    <span class="co">/// Construct a new `Scheduler`</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> new() <span class="op">-&gt;</span> Scheduler <span class="op">{</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true"></a>        Scheduler <span class="op">{</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true"></a>            controller<span class="op">:</span> <span class="pp">Rc::</span>new(<span class="pp">RefCell::</span>new(<span class="cn">None</span>))<span class="op">,</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true"></a>            view<span class="op">:</span> <span class="pp">Rc::</span>new(<span class="pp">RefCell::</span>new(<span class="cn">None</span>))<span class="op">,</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true"></a>            events<span class="op">:</span> <span class="pp">RefCell::</span>new(<span class="dt">Vec</span><span class="pp">::</span>new())<span class="op">,</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true"></a>            running<span class="op">:</span> <span class="pp">RefCell::</span>new(<span class="cn">false</span>)<span class="op">,</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> set_controller(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> controller<span class="op">:</span> Controller) <span class="op">{</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(<span class="kw">mut</span> controller_data) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>controller<span class="op">.</span>try_borrow_mut() <span class="op">{</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true"></a>            <span class="op">*</span>controller_data <span class="op">=</span> <span class="cn">Some</span>(controller)<span class="op">;</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true"></a>            deadlock()</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> set_view(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> view<span class="op">:</span> View) <span class="op">{</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(<span class="kw">mut</span> view_data) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>view<span class="op">.</span>try_borrow_mut() <span class="op">{</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true"></a>            <span class="op">*</span>view_data <span class="op">=</span> <span class="cn">Some</span>(view)<span class="op">;</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true"></a>            deadlock()</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true"></a></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true"></a>    <span class="co">/// Add a new message onto the event stack</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true"></a>    <span class="co">///</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true"></a>    <span class="co">/// Triggers running the event loop if it&#39;s not already running</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> add_message(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> message<span class="op">:</span> Message) <span class="op">{</span></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true"></a>        <span class="kw">let</span> running <span class="op">=</span> <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(running) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>running<span class="op">.</span>try_borrow() <span class="op">{</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true"></a>            <span class="op">*</span>running</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true"></a>            deadlock()</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true"></a>        <span class="op">};</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(<span class="kw">mut</span> events) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>events<span class="op">.</span>try_borrow_mut() <span class="op">{</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true"></a>            events<span class="op">.</span>push(message)<span class="op">;</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true"></a>            deadlock()</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true"></a>        <span class="kw">if</span> <span class="op">!</span>running <span class="op">{</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>run()<span class="op">;</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true"></a></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true"></a>    <span class="co">/// Start the event loop, taking messages from the stack to run</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true"></a>    <span class="kw">fn</span> run(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true"></a>        <span class="kw">let</span> events_len <span class="op">=</span> <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(events) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>events<span class="op">.</span>try_borrow() <span class="op">{</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true"></a>            events<span class="op">.</span>len()</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true"></a>            deadlock()</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true"></a>        <span class="op">};</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true"></a>        <span class="kw">if</span> events_len <span class="op">==</span> <span class="dv">0</span> <span class="op">{</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(<span class="kw">mut</span> running) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>running<span class="op">.</span>try_borrow_mut() <span class="op">{</span></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true"></a>                <span class="op">*</span>running <span class="op">=</span> <span class="cn">false</span><span class="op">;</span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true"></a>            <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true"></a>                deadlock()</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(<span class="kw">mut</span> running) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>running<span class="op">.</span>try_borrow_mut() <span class="op">{</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true"></a>                <span class="op">*</span>running <span class="op">=</span> <span class="cn">true</span><span class="op">;</span></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true"></a>            <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true"></a>                deadlock()</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>next_message()<span class="op">;</span></span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true"></a></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true"></a>    <span class="kw">fn</span> next_message(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true"></a>        <span class="kw">let</span> event <span class="op">=</span> <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(<span class="kw">mut</span> events) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>events<span class="op">.</span>try_borrow_mut() <span class="op">{</span></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true"></a>            events<span class="op">.</span>pop()</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true"></a>            deadlock()</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true"></a>        <span class="op">};</span></span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(event) <span class="op">=</span> event <span class="op">{</span></span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true"></a>            <span class="kw">match</span> event <span class="op">{</span></span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true"></a>                <span class="pp">Message::</span>Controller(e) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true"></a>                    <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(<span class="kw">mut</span> controller) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>controller<span class="op">.</span>try_borrow_mut() <span class="op">{</span></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true"></a>                        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">ref</span> <span class="kw">mut</span> ag) <span class="op">=</span> <span class="op">*</span>controller <span class="op">{</span></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true"></a>                            ag<span class="op">.</span>call(e)<span class="op">;</span></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true"></a>                        <span class="op">}</span></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true"></a>                    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true"></a>                        deadlock()</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true"></a>                    <span class="op">}</span></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true"></a>                <span class="pp">Message::</span>View(e) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true"></a>                    <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(<span class="kw">mut</span> view) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>view<span class="op">.</span>try_borrow_mut() <span class="op">{</span></span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true"></a>                        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">ref</span> <span class="kw">mut</span> ag) <span class="op">=</span> <span class="op">*</span>view <span class="op">{</span></span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true"></a>                            ag<span class="op">.</span>call(e)<span class="op">;</span></span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true"></a>                        <span class="op">}</span></span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true"></a>                    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true"></a>                        deadlock()</span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true"></a>                    <span class="op">}</span></span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>run()<span class="op">;</span></span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(<span class="kw">mut</span> running) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>running<span class="op">.</span>try_borrow_mut() <span class="op">{</span></span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true"></a>            <span class="op">*</span>running <span class="op">=</span> <span class="cn">false</span><span class="op">;</span></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true"></a>            deadlock()</span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true"></a></span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true"></a><span class="kw">impl</span> <span class="bu">Drop</span> <span class="kw">for</span> Scheduler <span class="op">{</span></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true"></a>    <span class="kw">fn</span> drop(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true"></a>        exit(<span class="st">&quot;calling drop on Scheduler&quot;</span>)<span class="op">;</span></span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>store.rs</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="co">/// Stores items into localstorage</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">js_sys::</span>JSON<span class="op">;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">wasm_bindgen::prelude::</span><span class="op">*;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a><span class="co">/// Stores items into localstorage</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> Store <span class="op">{</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a>    local_storage<span class="op">:</span> <span class="pp">web_sys::</span>Storage<span class="op">,</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a>    data<span class="op">:</span> ItemList<span class="op">,</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a>    name<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true"></a><span class="kw">impl</span> Store <span class="op">{</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true"></a>    <span class="co">/// Creates a new store with `name` as the localstorage value name</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> new(name<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>Store<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true"></a>        <span class="kw">let</span> window <span class="op">=</span> <span class="pp">web_sys::</span>window()<span class="op">?;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(<span class="cn">Some</span>(local_storage)) <span class="op">=</span> window<span class="op">.</span>local_storage() <span class="op">{</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true"></a>            <span class="kw">let</span> <span class="kw">mut</span> store <span class="op">=</span> Store <span class="op">{</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true"></a>                local_storage<span class="op">,</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true"></a>                data<span class="op">:</span> <span class="pp">ItemList::</span>new()<span class="op">,</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true"></a>                name<span class="op">:</span> <span class="dt">String</span><span class="pp">::</span>from(name)<span class="op">,</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true"></a>            <span class="op">};</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true"></a>            store<span class="op">.</span>fetch_local_storage()<span class="op">;</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true"></a>            <span class="cn">Some</span>(store)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true"></a>            <span class="cn">None</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true"></a>    <span class="co">/// Read the local ItemList from localStorage.</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true"></a>    <span class="co">/// Returns an &amp;Option&lt;ItemList&gt; of the stored database</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true"></a>    <span class="co">/// Caches the store into `self.data` to reduce calls to JS</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true"></a>    <span class="co">///</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true"></a>    <span class="co">/// Uses mut here as the return is something we might want to manipulate</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true"></a>    <span class="co">///</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true"></a>    <span class="kw">fn</span> fetch_local_storage(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>()<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> item_list <span class="op">=</span> <span class="pp">ItemList::</span>new()<span class="op">;</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true"></a>        <span class="co">// If we have an existing cached value, return early.</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(<span class="cn">Some</span>(value)) <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>local_storage<span class="op">.</span>get_item(<span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>name) <span class="op">{</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true"></a>            <span class="kw">let</span> data <span class="op">=</span> <span class="pp">JSON::</span>parse(<span class="op">&amp;</span>value)<span class="op">.</span>ok()<span class="op">?;</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true"></a>            <span class="kw">let</span> iter <span class="op">=</span> <span class="pp">js_sys::</span>try_iter(<span class="op">&amp;</span>data)<span class="op">.</span>ok()<span class="op">??;</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true"></a>            <span class="kw">for</span> item <span class="kw">in</span> iter <span class="op">{</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true"></a>                <span class="kw">let</span> item <span class="op">=</span> item<span class="op">.</span>ok()<span class="op">?;</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true"></a>                <span class="kw">let</span> item_array<span class="op">:</span> <span class="op">&amp;</span><span class="pp">js_sys::</span>Array <span class="op">=</span> <span class="pp">wasm_bindgen::JsCast::</span>dyn_ref(<span class="op">&amp;</span>item)<span class="op">?;</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true"></a>                <span class="kw">let</span> title <span class="op">=</span> item_array<span class="op">.</span>shift()<span class="op">.</span>as_string()<span class="op">?;</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true"></a>                <span class="kw">let</span> completed <span class="op">=</span> item_array<span class="op">.</span>shift()<span class="op">.</span>as_bool()<span class="op">?;</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true"></a>                <span class="kw">let</span> id <span class="op">=</span> item_array<span class="op">.</span>shift()<span class="op">.</span>as_string()<span class="op">?;</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true"></a>                <span class="kw">let</span> temp_item <span class="op">=</span> Item <span class="op">{</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true"></a>                    title<span class="op">,</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true"></a>                    completed<span class="op">,</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true"></a>                    id<span class="op">,</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true"></a>                <span class="op">};</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true"></a>                item_list<span class="op">.</span>push(temp_item)<span class="op">;</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>data <span class="op">=</span> item_list<span class="op">;</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true"></a>        <span class="cn">Some</span>(())</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true"></a></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true"></a>    <span class="co">/// Write the local ItemList to localStorage.</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true"></a>    <span class="kw">fn</span> sync_local_storage(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true"></a>        <span class="kw">let</span> array <span class="op">=</span> <span class="pp">js_sys::Array::</span>new()<span class="op">;</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true"></a>        <span class="kw">for</span> item <span class="kw">in</span> <span class="kw">self</span><span class="op">.</span>data<span class="op">.</span>iter() <span class="op">{</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true"></a>            <span class="kw">let</span> child <span class="op">=</span> <span class="pp">js_sys::Array::</span>new()<span class="op">;</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true"></a>            child<span class="op">.</span>push(<span class="op">&amp;</span><span class="pp">JsValue::</span>from(<span class="op">&amp;</span>item<span class="op">.</span>title))<span class="op">;</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true"></a>            child<span class="op">.</span>push(<span class="op">&amp;</span><span class="pp">JsValue::</span>from(item<span class="op">.</span>completed))<span class="op">;</span></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true"></a>            child<span class="op">.</span>push(<span class="op">&amp;</span><span class="pp">JsValue::</span>from(<span class="op">&amp;</span>item<span class="op">.</span>id))<span class="op">;</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true"></a></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true"></a>            array<span class="op">.</span>push(<span class="op">&amp;</span><span class="pp">JsValue::</span>from(child))<span class="op">;</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(storage_string) <span class="op">=</span> <span class="pp">JSON::</span>stringify(<span class="op">&amp;</span><span class="pp">JsValue::</span>from(array)) <span class="op">{</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true"></a>            <span class="kw">let</span> storage_string<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> storage_string<span class="op">.</span>into()<span class="op">;</span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>local_storage</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true"></a>                <span class="op">.</span>set_item(<span class="op">&amp;</span><span class="kw">self</span><span class="op">.</span>name<span class="op">,</span> <span class="op">&amp;</span>storage_string)</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true"></a>                <span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true"></a></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true"></a>    <span class="co">/// Find items with properties matching those on query.</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true"></a>    <span class="co">/// `ItemQuery` query Query to match</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true"></a>    <span class="co">///</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true"></a>    <span class="co">/// ```</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true"></a>    <span class="co">///  let data = db.find(ItemQuery::Completed {completed: true});</span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true"></a>    <span class="co">///  // data will contain items whose completed properties are true</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true"></a>    <span class="co">/// ```</span></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> find(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> query<span class="op">:</span> ItemQuery) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>ItemListSlice<span class="op">&lt;</span><span class="ot">&#39;_</span><span class="op">&gt;&gt;</span> <span class="op">{</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true"></a>        <span class="cn">Some</span>(</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>data</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true"></a>                <span class="op">.</span>iter()</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true"></a>                <span class="op">.</span>filter(<span class="op">|</span>todo<span class="op">|</span> query<span class="op">.</span>matches(todo))</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true"></a>                <span class="op">.</span>collect()<span class="op">,</span></span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true"></a>        )</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true"></a></span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true"></a>    <span class="co">/// Update an item in the Store.</span></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true"></a>    <span class="co">///</span></span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true"></a>    <span class="co">/// `ItemUpdate` update Record with an id and a property to update</span></span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> update(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> update<span class="op">:</span> ItemUpdate) <span class="op">{</span></span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true"></a>        <span class="kw">let</span> id <span class="op">=</span> update<span class="op">.</span>id()<span class="op">;</span></span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>data<span class="op">.</span>iter_mut()<span class="op">.</span>for_each(<span class="op">|</span>todo<span class="op">|</span> <span class="op">{</span></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true"></a>            <span class="kw">if</span> id <span class="op">==</span> todo<span class="op">.</span>id <span class="op">{</span></span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true"></a>                todo<span class="op">.</span>update(<span class="op">&amp;</span>update)<span class="op">;</span></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true"></a>        <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>sync_local_storage()<span class="op">;</span></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true"></a></span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true"></a>    <span class="co">/// Insert an item into the Store.</span></span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true"></a>    <span class="co">///</span></span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true"></a>    <span class="co">/// `Item` item Item to insert</span></span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> insert(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> item<span class="op">:</span> Item) <span class="op">{</span></span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>data<span class="op">.</span>push(item)<span class="op">;</span></span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>sync_local_storage()<span class="op">;</span></span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true"></a></span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true"></a>    <span class="co">/// Remove items from the Store based on a query.</span></span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true"></a>    <span class="co">/// query is an `ItemQuery` query Query matching the items to remove</span></span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> remove(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> query<span class="op">:</span> ItemQuery) <span class="op">{</span></span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>data<span class="op">.</span>retain(<span class="op">|</span>todo<span class="op">|</span> <span class="op">!</span>query<span class="op">.</span>matches(todo))<span class="op">;</span></span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>sync_local_storage()<span class="op">;</span></span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true"></a></span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true"></a>    <span class="co">/// Count total, active, and completed todos.</span></span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> count(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>(<span class="dt">usize</span><span class="op">,</span> <span class="dt">usize</span><span class="op">,</span> <span class="dt">usize</span>)<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>find(<span class="pp">ItemQuery::</span>EmptyItemQuery)<span class="op">.</span>map(<span class="op">|</span>data<span class="op">|</span> <span class="op">{</span></span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true"></a>            <span class="kw">let</span> total <span class="op">=</span> data<span class="op">.</span>length()<span class="op">;</span></span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true"></a></span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true"></a>            <span class="kw">let</span> <span class="kw">mut</span> completed <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true"></a>            <span class="kw">for</span> item <span class="kw">in</span> data<span class="op">.</span>iter() <span class="op">{</span></span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true"></a>                <span class="kw">if</span> item<span class="op">.</span>completed <span class="op">{</span></span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true"></a>                    completed <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true"></a>            (total<span class="op">,</span> total <span class="op">-</span> completed<span class="op">,</span> completed)</span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true"></a>        <span class="op">}</span>)</span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-137"><a href="#cb13-137" aria-hidden="true"></a></span>
<span id="cb13-138"><a href="#cb13-138" aria-hidden="true"></a><span class="co">/// Represents a todo item</span></span>
<span id="cb13-139"><a href="#cb13-139" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> Item <span class="op">{</span></span>
<span id="cb13-140"><a href="#cb13-140" aria-hidden="true"></a>    <span class="kw">pub</span> id<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb13-141"><a href="#cb13-141" aria-hidden="true"></a>    <span class="kw">pub</span> title<span class="op">:</span> <span class="dt">String</span><span class="op">,</span></span>
<span id="cb13-142"><a href="#cb13-142" aria-hidden="true"></a>    <span class="kw">pub</span> completed<span class="op">:</span> <span class="dt">bool</span><span class="op">,</span></span>
<span id="cb13-143"><a href="#cb13-143" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-144"><a href="#cb13-144" aria-hidden="true"></a></span>
<span id="cb13-145"><a href="#cb13-145" aria-hidden="true"></a><span class="kw">impl</span> Item <span class="op">{</span></span>
<span id="cb13-146"><a href="#cb13-146" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> update(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> update<span class="op">:</span> <span class="op">&amp;</span>ItemUpdate) <span class="op">{</span></span>
<span id="cb13-147"><a href="#cb13-147" aria-hidden="true"></a>        <span class="kw">match</span> update <span class="op">{</span></span>
<span id="cb13-148"><a href="#cb13-148" aria-hidden="true"></a>            <span class="pp">ItemUpdate::</span>Title <span class="op">{</span> title<span class="op">,</span> <span class="op">..</span> <span class="op">}</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb13-149"><a href="#cb13-149" aria-hidden="true"></a>                <span class="kw">self</span><span class="op">.</span>title <span class="op">=</span> title<span class="op">.</span>to_string()<span class="op">;</span></span>
<span id="cb13-150"><a href="#cb13-150" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb13-151"><a href="#cb13-151" aria-hidden="true"></a>            <span class="pp">ItemUpdate::</span>Completed <span class="op">{</span> completed<span class="op">,</span> <span class="op">..</span> <span class="op">}</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb13-152"><a href="#cb13-152" aria-hidden="true"></a>                <span class="kw">self</span><span class="op">.</span>completed <span class="op">=</span> <span class="op">*</span>completed<span class="op">;</span></span>
<span id="cb13-153"><a href="#cb13-153" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb13-154"><a href="#cb13-154" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb13-155"><a href="#cb13-155" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-156"><a href="#cb13-156" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-157"><a href="#cb13-157" aria-hidden="true"></a></span>
<span id="cb13-158"><a href="#cb13-158" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">trait</span> ItemListTrait<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-159"><a href="#cb13-159" aria-hidden="true"></a>    <span class="kw">fn</span> new() <span class="op">-&gt;</span> <span class="dt">Self</span><span class="op">;</span></span>
<span id="cb13-160"><a href="#cb13-160" aria-hidden="true"></a>    <span class="kw">fn</span> get(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> i<span class="op">:</span> <span class="dt">usize</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;&amp;</span>T<span class="op">&gt;;</span></span>
<span id="cb13-161"><a href="#cb13-161" aria-hidden="true"></a>    <span class="kw">fn</span> length(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">usize</span><span class="op">;</span></span>
<span id="cb13-162"><a href="#cb13-162" aria-hidden="true"></a>    <span class="kw">fn</span> push(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> item<span class="op">:</span> T)<span class="op">;</span></span>
<span id="cb13-163"><a href="#cb13-163" aria-hidden="true"></a>    <span class="kw">fn</span> iter(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="pp">std::slice::</span>Iter<span class="op">&lt;</span><span class="ot">&#39;_</span><span class="op">,</span> T<span class="op">&gt;;</span></span>
<span id="cb13-164"><a href="#cb13-164" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-165"><a href="#cb13-165" aria-hidden="true"></a></span>
<span id="cb13-166"><a href="#cb13-166" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> ItemList <span class="op">{</span></span>
<span id="cb13-167"><a href="#cb13-167" aria-hidden="true"></a>    list<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>Item<span class="op">&gt;,</span></span>
<span id="cb13-168"><a href="#cb13-168" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-169"><a href="#cb13-169" aria-hidden="true"></a><span class="kw">impl</span> ItemList <span class="op">{</span></span>
<span id="cb13-170"><a href="#cb13-170" aria-hidden="true"></a>    <span class="kw">fn</span> retain<span class="op">&lt;</span>F<span class="op">&gt;</span>(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> f<span class="op">:</span> F)</span>
<span id="cb13-171"><a href="#cb13-171" aria-hidden="true"></a>    <span class="kw">where</span></span>
<span id="cb13-172"><a href="#cb13-172" aria-hidden="true"></a>        F<span class="op">:</span> <span class="bu">FnMut</span>(<span class="op">&amp;</span>Item) <span class="op">-&gt;</span> <span class="dt">bool</span><span class="op">,</span></span>
<span id="cb13-173"><a href="#cb13-173" aria-hidden="true"></a>    <span class="op">{</span></span>
<span id="cb13-174"><a href="#cb13-174" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>list<span class="op">.</span>retain(f)<span class="op">;</span></span>
<span id="cb13-175"><a href="#cb13-175" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-176"><a href="#cb13-176" aria-hidden="true"></a>    <span class="kw">fn</span> iter_mut(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">-&gt;</span> <span class="pp">std::slice::</span>IterMut<span class="op">&lt;</span><span class="ot">&#39;_</span><span class="op">,</span> Item<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-177"><a href="#cb13-177" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>list<span class="op">.</span>iter_mut()</span>
<span id="cb13-178"><a href="#cb13-178" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-179"><a href="#cb13-179" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-180"><a href="#cb13-180" aria-hidden="true"></a><span class="kw">impl</span> ItemListTrait<span class="op">&lt;</span>Item<span class="op">&gt;</span> <span class="kw">for</span> ItemList <span class="op">{</span></span>
<span id="cb13-181"><a href="#cb13-181" aria-hidden="true"></a>    <span class="kw">fn</span> new() <span class="op">-&gt;</span> ItemList <span class="op">{</span></span>
<span id="cb13-182"><a href="#cb13-182" aria-hidden="true"></a>        ItemList <span class="op">{</span> list<span class="op">:</span> <span class="dt">Vec</span><span class="pp">::</span>new() <span class="op">}</span></span>
<span id="cb13-183"><a href="#cb13-183" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-184"><a href="#cb13-184" aria-hidden="true"></a>    <span class="kw">fn</span> get(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> i<span class="op">:</span> <span class="dt">usize</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;&amp;</span>Item<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-185"><a href="#cb13-185" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>list<span class="op">.</span>get(i)</span>
<span id="cb13-186"><a href="#cb13-186" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-187"><a href="#cb13-187" aria-hidden="true"></a>    <span class="kw">fn</span> length(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">usize</span> <span class="op">{</span></span>
<span id="cb13-188"><a href="#cb13-188" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>list<span class="op">.</span>len()</span>
<span id="cb13-189"><a href="#cb13-189" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-190"><a href="#cb13-190" aria-hidden="true"></a>    <span class="kw">fn</span> push(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> item<span class="op">:</span> Item) <span class="op">{</span></span>
<span id="cb13-191"><a href="#cb13-191" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>list<span class="op">.</span>push(item)</span>
<span id="cb13-192"><a href="#cb13-192" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-193"><a href="#cb13-193" aria-hidden="true"></a>    <span class="kw">fn</span> iter(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="pp">std::slice::</span>Iter<span class="op">&lt;</span><span class="ot">&#39;_</span><span class="op">,</span> Item<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-194"><a href="#cb13-194" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>list<span class="op">.</span>iter()</span>
<span id="cb13-195"><a href="#cb13-195" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-196"><a href="#cb13-196" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-197"><a href="#cb13-197" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::iter::</span><span class="bu">FromIterator</span><span class="op">;</span></span>
<span id="cb13-198"><a href="#cb13-198" aria-hidden="true"></a><span class="kw">impl</span> <span class="bu">FromIterator</span><span class="op">&lt;</span>Item<span class="op">&gt;</span> <span class="kw">for</span> ItemList <span class="op">{</span></span>
<span id="cb13-199"><a href="#cb13-199" aria-hidden="true"></a>    <span class="kw">fn</span> from_iter<span class="op">&lt;</span>I<span class="op">:</span> <span class="bu">IntoIterator</span><span class="op">&lt;</span>Item <span class="op">=</span> Item<span class="op">&gt;&gt;</span>(iter<span class="op">:</span> I) <span class="op">-&gt;</span> <span class="dt">Self</span> <span class="op">{</span></span>
<span id="cb13-200"><a href="#cb13-200" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> c <span class="op">=</span> <span class="pp">ItemList::</span>new()<span class="op">;</span></span>
<span id="cb13-201"><a href="#cb13-201" aria-hidden="true"></a>        <span class="kw">for</span> i <span class="kw">in</span> iter <span class="op">{</span></span>
<span id="cb13-202"><a href="#cb13-202" aria-hidden="true"></a>            c<span class="op">.</span>push(i)<span class="op">;</span></span>
<span id="cb13-203"><a href="#cb13-203" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb13-204"><a href="#cb13-204" aria-hidden="true"></a></span>
<span id="cb13-205"><a href="#cb13-205" aria-hidden="true"></a>        c</span>
<span id="cb13-206"><a href="#cb13-206" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-207"><a href="#cb13-207" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-208"><a href="#cb13-208" aria-hidden="true"></a></span>
<span id="cb13-209"><a href="#cb13-209" aria-hidden="true"></a><span class="co">/// A borrowed set of Items filtered from the store</span></span>
<span id="cb13-210"><a href="#cb13-210" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> ItemListSlice<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-211"><a href="#cb13-211" aria-hidden="true"></a>    list<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;&amp;</span><span class="ot">&#39;a</span> Item<span class="op">&gt;,</span></span>
<span id="cb13-212"><a href="#cb13-212" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-213"><a href="#cb13-213" aria-hidden="true"></a></span>
<span id="cb13-214"><a href="#cb13-214" aria-hidden="true"></a><span class="kw">impl</span><span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> ItemListTrait<span class="op">&lt;&amp;</span><span class="ot">&#39;a</span> Item<span class="op">&gt;</span> <span class="kw">for</span> ItemListSlice<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-215"><a href="#cb13-215" aria-hidden="true"></a>    <span class="kw">fn</span> new() <span class="op">-&gt;</span> ItemListSlice<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-216"><a href="#cb13-216" aria-hidden="true"></a>        ItemListSlice <span class="op">{</span> list<span class="op">:</span> <span class="dt">Vec</span><span class="pp">::</span>new() <span class="op">}</span></span>
<span id="cb13-217"><a href="#cb13-217" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-218"><a href="#cb13-218" aria-hidden="true"></a>    <span class="kw">fn</span> get(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> i<span class="op">:</span> <span class="dt">usize</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;&amp;&amp;</span><span class="ot">&#39;a</span> Item<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-219"><a href="#cb13-219" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>list<span class="op">.</span>get(i)</span>
<span id="cb13-220"><a href="#cb13-220" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-221"><a href="#cb13-221" aria-hidden="true"></a>    <span class="kw">fn</span> length(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">usize</span> <span class="op">{</span></span>
<span id="cb13-222"><a href="#cb13-222" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>list<span class="op">.</span>len()</span>
<span id="cb13-223"><a href="#cb13-223" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-224"><a href="#cb13-224" aria-hidden="true"></a>    <span class="kw">fn</span> push(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> item<span class="op">:</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> Item) <span class="op">{</span></span>
<span id="cb13-225"><a href="#cb13-225" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>list<span class="op">.</span>push(item)</span>
<span id="cb13-226"><a href="#cb13-226" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-227"><a href="#cb13-227" aria-hidden="true"></a>    <span class="kw">fn</span> iter(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="pp">std::slice::</span>Iter<span class="op">&lt;</span><span class="ot">&#39;_</span><span class="op">,</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> Item<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-228"><a href="#cb13-228" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>list<span class="op">.</span>iter()</span>
<span id="cb13-229"><a href="#cb13-229" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-230"><a href="#cb13-230" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-231"><a href="#cb13-231" aria-hidden="true"></a></span>
<span id="cb13-232"><a href="#cb13-232" aria-hidden="true"></a><span class="kw">impl</span><span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="bu">FromIterator</span><span class="op">&lt;&amp;</span><span class="ot">&#39;a</span> Item<span class="op">&gt;</span> <span class="kw">for</span> ItemListSlice<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb13-233"><a href="#cb13-233" aria-hidden="true"></a>    <span class="kw">fn</span> from_iter<span class="op">&lt;</span>I<span class="op">:</span> <span class="bu">IntoIterator</span><span class="op">&lt;</span>Item <span class="op">=</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> Item<span class="op">&gt;&gt;</span>(iter<span class="op">:</span> I) <span class="op">-&gt;</span> <span class="dt">Self</span> <span class="op">{</span></span>
<span id="cb13-234"><a href="#cb13-234" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> c <span class="op">=</span> <span class="pp">ItemListSlice::</span>new()<span class="op">;</span></span>
<span id="cb13-235"><a href="#cb13-235" aria-hidden="true"></a>        <span class="kw">for</span> i <span class="kw">in</span> iter <span class="op">{</span></span>
<span id="cb13-236"><a href="#cb13-236" aria-hidden="true"></a>            c<span class="op">.</span>push(i)<span class="op">;</span></span>
<span id="cb13-237"><a href="#cb13-237" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb13-238"><a href="#cb13-238" aria-hidden="true"></a>        c</span>
<span id="cb13-239"><a href="#cb13-239" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-240"><a href="#cb13-240" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-241"><a href="#cb13-241" aria-hidden="true"></a></span>
<span id="cb13-242"><a href="#cb13-242" aria-hidden="true"></a><span class="kw">impl</span> <span class="bu">From</span><span class="op">&lt;</span>ItemListSlice<span class="op">&lt;</span><span class="ot">&#39;_</span><span class="op">&gt;&gt;</span> <span class="kw">for</span> ItemList <span class="op">{</span></span>
<span id="cb13-243"><a href="#cb13-243" aria-hidden="true"></a>    <span class="kw">fn</span> from(s<span class="op">:</span> ItemListSlice<span class="op">&lt;</span><span class="ot">&#39;_</span><span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="dt">Self</span> <span class="op">{</span></span>
<span id="cb13-244"><a href="#cb13-244" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> i <span class="op">=</span> <span class="pp">ItemList::</span>new()<span class="op">;</span></span>
<span id="cb13-245"><a href="#cb13-245" aria-hidden="true"></a>        <span class="kw">let</span> items <span class="op">=</span> s<span class="op">.</span>list<span class="op">.</span>into_iter()<span class="op">;</span></span>
<span id="cb13-246"><a href="#cb13-246" aria-hidden="true"></a>        <span class="kw">for</span> j <span class="kw">in</span> items <span class="op">{</span></span>
<span id="cb13-247"><a href="#cb13-247" aria-hidden="true"></a>            <span class="co">// </span><span class="al">TODO</span><span class="co"> neaten this cloning?</span></span>
<span id="cb13-248"><a href="#cb13-248" aria-hidden="true"></a>            <span class="kw">let</span> item <span class="op">=</span> Item <span class="op">{</span></span>
<span id="cb13-249"><a href="#cb13-249" aria-hidden="true"></a>                id<span class="op">:</span> j<span class="op">.</span>id<span class="op">.</span>clone()<span class="op">,</span></span>
<span id="cb13-250"><a href="#cb13-250" aria-hidden="true"></a>                completed<span class="op">:</span> j<span class="op">.</span>completed<span class="op">,</span></span>
<span id="cb13-251"><a href="#cb13-251" aria-hidden="true"></a>                title<span class="op">:</span> j<span class="op">.</span>title<span class="op">.</span>clone()<span class="op">,</span></span>
<span id="cb13-252"><a href="#cb13-252" aria-hidden="true"></a>            <span class="op">};</span></span>
<span id="cb13-253"><a href="#cb13-253" aria-hidden="true"></a>            i<span class="op">.</span>push(item)<span class="op">;</span></span>
<span id="cb13-254"><a href="#cb13-254" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb13-255"><a href="#cb13-255" aria-hidden="true"></a>        i</span>
<span id="cb13-256"><a href="#cb13-256" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-257"><a href="#cb13-257" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-258"><a href="#cb13-258" aria-hidden="true"></a></span>
<span id="cb13-259"><a href="#cb13-259" aria-hidden="true"></a><span class="co">/// Represents a search into the store</span></span>
<span id="cb13-260"><a href="#cb13-260" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">enum</span> ItemQuery <span class="op">{</span></span>
<span id="cb13-261"><a href="#cb13-261" aria-hidden="true"></a>    Id <span class="op">{</span> id<span class="op">:</span> <span class="dt">String</span> <span class="op">},</span></span>
<span id="cb13-262"><a href="#cb13-262" aria-hidden="true"></a>    Completed <span class="op">{</span> completed<span class="op">:</span> <span class="dt">bool</span> <span class="op">},</span></span>
<span id="cb13-263"><a href="#cb13-263" aria-hidden="true"></a>    EmptyItemQuery<span class="op">,</span></span>
<span id="cb13-264"><a href="#cb13-264" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-265"><a href="#cb13-265" aria-hidden="true"></a></span>
<span id="cb13-266"><a href="#cb13-266" aria-hidden="true"></a><span class="kw">impl</span> ItemQuery <span class="op">{</span></span>
<span id="cb13-267"><a href="#cb13-267" aria-hidden="true"></a>    <span class="kw">fn</span> matches(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> item<span class="op">:</span> <span class="op">&amp;</span>Item) <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb13-268"><a href="#cb13-268" aria-hidden="true"></a>        <span class="kw">match</span> <span class="op">*</span><span class="kw">self</span> <span class="op">{</span></span>
<span id="cb13-269"><a href="#cb13-269" aria-hidden="true"></a>            <span class="pp">ItemQuery::</span>EmptyItemQuery <span class="op">=&gt;</span> <span class="cn">true</span><span class="op">,</span></span>
<span id="cb13-270"><a href="#cb13-270" aria-hidden="true"></a>            <span class="pp">ItemQuery::</span>Id <span class="op">{</span> <span class="kw">ref</span> id <span class="op">}</span> <span class="op">=&gt;</span> <span class="op">&amp;</span>item<span class="op">.</span>id <span class="op">==</span> id<span class="op">,</span></span>
<span id="cb13-271"><a href="#cb13-271" aria-hidden="true"></a>            <span class="pp">ItemQuery::</span>Completed <span class="op">{</span> completed <span class="op">}</span> <span class="op">=&gt;</span> item<span class="op">.</span>completed <span class="op">==</span> completed<span class="op">,</span></span>
<span id="cb13-272"><a href="#cb13-272" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb13-273"><a href="#cb13-273" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-274"><a href="#cb13-274" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-275"><a href="#cb13-275" aria-hidden="true"></a></span>
<span id="cb13-276"><a href="#cb13-276" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">enum</span> ItemUpdate <span class="op">{</span></span>
<span id="cb13-277"><a href="#cb13-277" aria-hidden="true"></a>    Title <span class="op">{</span> id<span class="op">:</span> <span class="dt">String</span><span class="op">,</span> title<span class="op">:</span> <span class="dt">String</span> <span class="op">},</span></span>
<span id="cb13-278"><a href="#cb13-278" aria-hidden="true"></a>    Completed <span class="op">{</span> id<span class="op">:</span> <span class="dt">String</span><span class="op">,</span> completed<span class="op">:</span> <span class="dt">bool</span> <span class="op">},</span></span>
<span id="cb13-279"><a href="#cb13-279" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb13-280"><a href="#cb13-280" aria-hidden="true"></a></span>
<span id="cb13-281"><a href="#cb13-281" aria-hidden="true"></a><span class="kw">impl</span> ItemUpdate <span class="op">{</span></span>
<span id="cb13-282"><a href="#cb13-282" aria-hidden="true"></a>    <span class="kw">fn</span> id(<span class="op">&amp;</span><span class="kw">self</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb13-283"><a href="#cb13-283" aria-hidden="true"></a>        <span class="kw">match</span> <span class="kw">self</span> <span class="op">{</span></span>
<span id="cb13-284"><a href="#cb13-284" aria-hidden="true"></a>            <span class="pp">ItemUpdate::</span>Title <span class="op">{</span> id<span class="op">,</span> <span class="op">..</span> <span class="op">}</span> <span class="op">=&gt;</span> id<span class="op">.</span>clone()<span class="op">,</span></span>
<span id="cb13-285"><a href="#cb13-285" aria-hidden="true"></a>            <span class="pp">ItemUpdate::</span>Completed <span class="op">{</span> id<span class="op">,</span> <span class="op">..</span> <span class="op">}</span> <span class="op">=&gt;</span> id<span class="op">.</span>clone()<span class="op">,</span></span>
<span id="cb13-286"><a href="#cb13-286" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb13-287"><a href="#cb13-287" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb13-288"><a href="#cb13-288" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>template.rs</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a><span class="co">/// Handles constructing template strings from data</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::store::</span><span class="op">{</span>ItemList<span class="op">,</span> ItemListTrait<span class="op">};</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">askama::</span>Template <span class="kw">as</span> AskamaTemplate<span class="op">;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a><span class="at">#[</span>derive<span class="at">(</span>AskamaTemplate<span class="at">)]</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a><span class="at">#[</span>template<span class="at">(</span>path <span class="op">=</span> <span class="st">&quot;row.html&quot;</span><span class="at">)]</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a><span class="kw">struct</span> RowTemplate<span class="op">&lt;</span><span class="ot">&#39;a</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a>    id<span class="op">:</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> <span class="dt">str</span><span class="op">,</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true"></a>    title<span class="op">:</span> <span class="op">&amp;</span><span class="ot">&#39;a</span> <span class="dt">str</span><span class="op">,</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true"></a>    completed<span class="op">:</span> <span class="dt">bool</span><span class="op">,</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true"></a><span class="at">#[</span>derive<span class="at">(</span>AskamaTemplate<span class="at">)]</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true"></a><span class="at">#[</span>template<span class="at">(</span>path <span class="op">=</span> <span class="st">&quot;itemsLeft.html&quot;</span><span class="at">)]</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true"></a><span class="kw">struct</span> ItemsLeftTemplate <span class="op">{</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true"></a>    active_todos<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> Template <span class="op">{}</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true"></a><span class="kw">impl</span> Template <span class="op">{</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true"></a>    <span class="co">/// Format the contents of a todo list.</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true"></a>    <span class="co">///</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true"></a>    <span class="co">/// items `ItemList` contains keys you want to find in the template to replace.</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true"></a>    <span class="co">/// Returns the contents for a todo list</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true"></a>    <span class="co">///</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> item_list(items<span class="op">:</span> ItemList) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> output <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>from(<span class="st">&quot;&quot;</span>)<span class="op">;</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true"></a>        <span class="kw">for</span> item <span class="kw">in</span> items<span class="op">.</span>iter() <span class="op">{</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true"></a>            <span class="kw">let</span> row <span class="op">=</span> RowTemplate <span class="op">{</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true"></a>                id<span class="op">:</span> <span class="op">&amp;</span>item<span class="op">.</span>id<span class="op">,</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true"></a>                completed<span class="op">:</span> item<span class="op">.</span>completed<span class="op">,</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true"></a>                title<span class="op">:</span> <span class="op">&amp;</span>item<span class="op">.</span>title<span class="op">,</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true"></a>            <span class="op">};</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(res) <span class="op">=</span> row<span class="op">.</span>render() <span class="op">{</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true"></a>                output<span class="op">.</span>push_str(<span class="op">&amp;</span>res)<span class="op">;</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true"></a>        output</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true"></a></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true"></a>    <span class="co">///</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true"></a>    <span class="co">/// Format the contents of an &quot;items left&quot; indicator.</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true"></a>    <span class="co">///</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true"></a>    <span class="co">/// `active_todos` Number of active todos</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true"></a>    <span class="co">///</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true"></a>    <span class="co">/// Returns the contents for an &quot;items left&quot; indicator</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> item_counter(active_todos<span class="op">:</span> <span class="dt">usize</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true"></a>        <span class="kw">let</span> items_left <span class="op">=</span> ItemsLeftTemplate <span class="op">{</span> active_todos <span class="op">};</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(res) <span class="op">=</span> items_left<span class="op">.</span>render() <span class="op">{</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true"></a>            res</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true"></a>            <span class="dt">String</span><span class="pp">::</span>new()</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>view.rs</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="co">/// Presentation layer</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::controller::</span>ControllerMessage<span class="op">;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::element::</span>Element<span class="op">;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::</span>exit<span class="op">;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::store::</span>ItemList<span class="op">;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::</span><span class="op">{</span>Message<span class="op">,</span> Scheduler<span class="op">};</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::cell::</span>RefCell<span class="op">;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">std::rc::</span>Rc<span class="op">;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true"></a><span class="kw">use</span> <span class="kw">crate</span><span class="pp">::template::</span>Template<span class="op">;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true"></a><span class="kw">const</span> ENTER_KEY<span class="op">:</span> <span class="dt">u32</span> <span class="op">=</span> <span class="dv">13</span><span class="op">;</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true"></a><span class="kw">const</span> ESCAPE_KEY<span class="op">:</span> <span class="dt">u32</span> <span class="op">=</span> <span class="dv">27</span><span class="op">;</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true"></a><span class="kw">use</span> <span class="pp">wasm_bindgen::prelude::</span><span class="op">*;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true"></a><span class="co">/// Messages that represent the methods to be called on the View</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">enum</span> ViewMessage <span class="op">{</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true"></a>    UpdateFilterButtons(<span class="dt">String</span>)<span class="op">,</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true"></a>    ClearNewTodo()<span class="op">,</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true"></a>    ShowItems(ItemList)<span class="op">,</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true"></a>    SetItemsLeft(<span class="dt">usize</span>)<span class="op">,</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true"></a>    SetClearCompletedButtonVisibility(<span class="dt">bool</span>)<span class="op">,</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true"></a>    SetCompleteAllCheckbox(<span class="dt">bool</span>)<span class="op">,</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true"></a>    SetMainVisibility(<span class="dt">bool</span>)<span class="op">,</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true"></a>    RemoveItem(<span class="dt">String</span>)<span class="op">,</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true"></a>    EditItemDone(<span class="dt">String</span><span class="op">,</span> <span class="dt">String</span>)<span class="op">,</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true"></a>    SetItemComplete(<span class="dt">String</span><span class="op">,</span> <span class="dt">bool</span>)<span class="op">,</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true"></a><span class="kw">fn</span> item_id(<span class="kw">mut</span> element<span class="op">:</span> Element) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span><span class="dt">String</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true"></a>    element<span class="op">.</span>parent_element()<span class="op">.</span>map(<span class="op">|</span><span class="kw">mut</span> parent<span class="op">|</span> <span class="op">{</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> res <span class="op">=</span> <span class="cn">None</span><span class="op">;</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true"></a>        <span class="kw">let</span> parent_id <span class="op">=</span> parent<span class="op">.</span>dataset_get(<span class="st">&quot;id&quot;</span>)<span class="op">;</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true"></a>        <span class="kw">if</span> <span class="op">!</span>parent_id<span class="op">.</span>is_empty() <span class="op">{</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true"></a>            res <span class="op">=</span> <span class="cn">Some</span>(parent_id)<span class="op">;</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true"></a>        <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">mut</span> ep) <span class="op">=</span> parent<span class="op">.</span>parent_element() <span class="op">{</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true"></a>            res <span class="op">=</span> <span class="cn">Some</span>(ep<span class="op">.</span>dataset_get(<span class="st">&quot;id&quot;</span>))<span class="op">;</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true"></a>        res<span class="op">.</span>unwrap()</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true"></a>    <span class="op">}</span>)</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true"></a></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true"></a><span class="co">/// Presentation layer</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true"></a><span class="at">#[</span>wasm_bindgen<span class="at">]</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true"></a><span class="kw">pub</span> <span class="kw">struct</span> View <span class="op">{</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true"></a>    sched<span class="op">:</span> RefCell<span class="op">&lt;</span>Rc<span class="op">&lt;</span>Scheduler<span class="op">&gt;&gt;,</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true"></a>    todo_list<span class="op">:</span> Element<span class="op">,</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true"></a>    todo_item_counter<span class="op">:</span> Element<span class="op">,</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true"></a>    clear_completed<span class="op">:</span> Element<span class="op">,</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true"></a>    main<span class="op">:</span> Element<span class="op">,</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true"></a>    toggle_all<span class="op">:</span> Element<span class="op">,</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true"></a>    new_todo<span class="op">:</span> Element<span class="op">,</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true"></a>    callbacks<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span>(<span class="pp">web_sys::</span>EventTarget<span class="op">,</span> <span class="dt">String</span><span class="op">,</span> Closure<span class="op">&lt;</span><span class="kw">dyn</span> <span class="bu">FnMut</span>()<span class="op">&gt;</span>)<span class="op">&gt;,</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true"></a></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true"></a><span class="kw">impl</span> View <span class="op">{</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true"></a>    <span class="co">/// Construct a new view</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> new(sched<span class="op">:</span> Rc<span class="op">&lt;</span>Scheduler<span class="op">&gt;</span>) <span class="op">-&gt;</span> <span class="dt">Option</span><span class="op">&lt;</span>View<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true"></a>        <span class="kw">let</span> todo_list <span class="op">=</span> <span class="pp">Element::</span>qs(<span class="st">&quot;.todo-list&quot;</span>)<span class="op">?;</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true"></a>        <span class="kw">let</span> todo_item_counter <span class="op">=</span> <span class="pp">Element::</span>qs(<span class="st">&quot;.todo-count&quot;</span>)<span class="op">?;</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true"></a>        <span class="kw">let</span> clear_completed <span class="op">=</span> <span class="pp">Element::</span>qs(<span class="st">&quot;.clear-completed&quot;</span>)<span class="op">?;</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true"></a>        <span class="kw">let</span> main <span class="op">=</span> <span class="pp">Element::</span>qs(<span class="st">&quot;.main&quot;</span>)<span class="op">?;</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true"></a>        <span class="kw">let</span> toggle_all <span class="op">=</span> <span class="pp">Element::</span>qs(<span class="st">&quot;.toggle-all&quot;</span>)<span class="op">?;</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true"></a>        <span class="kw">let</span> new_todo <span class="op">=</span> <span class="pp">Element::</span>qs(<span class="st">&quot;.new-todo&quot;</span>)<span class="op">?;</span></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true"></a>        <span class="cn">Some</span>(View <span class="op">{</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true"></a>            sched<span class="op">:</span> <span class="pp">RefCell::</span>new(sched)<span class="op">,</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true"></a>            todo_list<span class="op">,</span></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true"></a>            todo_item_counter<span class="op">,</span></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true"></a>            clear_completed<span class="op">,</span></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true"></a>            main<span class="op">,</span></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true"></a>            toggle_all<span class="op">,</span></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true"></a>            new_todo<span class="op">,</span></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true"></a>            callbacks<span class="op">:</span> <span class="dt">Vec</span><span class="pp">::</span>new()<span class="op">,</span></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true"></a>        <span class="op">}</span>)</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true"></a></span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> init(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true"></a>        <span class="kw">let</span> window <span class="op">=</span> <span class="kw">match</span> <span class="pp">web_sys::</span>window() <span class="op">{</span></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true"></a>            <span class="cn">Some</span>(w) <span class="op">=&gt;</span> w<span class="op">,</span></span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true"></a>            <span class="cn">None</span> <span class="op">=&gt;</span> <span class="kw">return</span><span class="op">,</span></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true"></a>        <span class="op">};</span></span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true"></a>        <span class="kw">let</span> document <span class="op">=</span> <span class="kw">match</span> window<span class="op">.</span>document() <span class="op">{</span></span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true"></a>            <span class="cn">Some</span>(d) <span class="op">=&gt;</span> d<span class="op">,</span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true"></a>            <span class="cn">None</span> <span class="op">=&gt;</span> <span class="kw">return</span><span class="op">,</span></span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true"></a>        <span class="op">};</span></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true"></a>        <span class="kw">let</span> sched <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>sched<span class="op">.</span>clone()<span class="op">;</span></span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true"></a>        <span class="kw">let</span> set_page <span class="op">=</span> <span class="pp">Closure::</span><span class="op">&lt;</span><span class="kw">dyn</span> <span class="bu">FnMut</span>()<span class="op">&gt;</span><span class="pp">::</span>new(<span class="kw">move</span> <span class="op">||</span> <span class="op">{</span></span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(location) <span class="op">=</span> document<span class="op">.</span>location() <span class="op">{</span></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(hash) <span class="op">=</span> location<span class="op">.</span>hash() <span class="op">{</span></span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true"></a>                    <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(sched) <span class="op">=</span> <span class="op">&amp;</span>(sched<span class="op">.</span>try_borrow_mut()) <span class="op">{</span></span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true"></a>                        sched<span class="op">.</span>add_message(<span class="pp">Message::</span>Controller(<span class="pp">ControllerMessage::</span>SetPage(hash)))<span class="op">;</span></span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true"></a>                    <span class="op">}</span></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true"></a>        <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true"></a></span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true"></a>        <span class="kw">let</span> window_et<span class="op">:</span> <span class="pp">web_sys::</span>EventTarget <span class="op">=</span> window<span class="op">.</span>into()<span class="op">;</span></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true"></a>        window_et</span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true"></a>            <span class="op">.</span>add_event_listener_with_callback(<span class="st">&quot;hashchange&quot;</span><span class="op">,</span> set_page<span class="op">.</span>as_ref()<span class="op">.</span>unchecked_ref())</span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true"></a>            <span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true"></a>        set_page<span class="op">.</span>forget()<span class="op">;</span> <span class="co">// Cycle collect this</span></span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true"></a>                           <span class="co">//self.callbacks.push((window_et, &quot;hashchange&quot;.to_string(), set_page));</span></span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>bind_add_item()<span class="op">;</span></span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>bind_edit_item_save()<span class="op">;</span></span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>bind_edit_item_cancel()<span class="op">;</span></span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>bind_remove_item()<span class="op">;</span></span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>bind_toggle_item()<span class="op">;</span></span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>bind_edit_item()<span class="op">;</span></span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>bind_remove_completed()<span class="op">;</span></span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>bind_toggle_all()<span class="op">;</span></span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true"></a></span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true"></a>    <span class="kw">fn</span> bind_edit_item(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>todo_list<span class="op">.</span>delegate(</span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true"></a>            <span class="st">&quot;li label&quot;</span><span class="op">,</span></span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true"></a>            <span class="st">&quot;dblclick&quot;</span><span class="op">,</span></span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true"></a>            <span class="op">|</span>e<span class="op">:</span> <span class="pp">web_sys::</span>Event<span class="op">|</span> <span class="op">{</span></span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(target) <span class="op">=</span> e<span class="op">.</span>target() <span class="op">{</span></span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true"></a>                    <span class="pp">View::</span>edit_item(target<span class="op">.</span>into())<span class="op">;</span></span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true"></a>            <span class="op">},</span></span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true"></a>            <span class="cn">false</span><span class="op">,</span></span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true"></a>        )<span class="op">;</span></span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true"></a></span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true"></a>    <span class="co">/// Put an item into edit mode.</span></span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true"></a>    <span class="kw">fn</span> edit_item(<span class="kw">mut</span> el<span class="op">:</span> Element) <span class="op">{</span></span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">mut</span> parent_element) <span class="op">=</span> el<span class="op">.</span>parent_element() <span class="op">{</span></span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">mut</span> list_item) <span class="op">=</span> parent_element<span class="op">.</span>parent_element() <span class="op">{</span></span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true"></a>                list_item<span class="op">.</span>class_list_add(<span class="st">&quot;editing&quot;</span>)<span class="op">;</span></span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">mut</span> input) <span class="op">=</span> <span class="pp">Element::</span>create_element(<span class="st">&quot;input&quot;</span>) <span class="op">{</span></span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true"></a>                    input<span class="op">.</span>set_class_name(<span class="st">&quot;edit&quot;</span>)<span class="op">;</span></span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true"></a>                    <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(text) <span class="op">=</span> el<span class="op">.</span>text_content() <span class="op">{</span></span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true"></a>                        input<span class="op">.</span>set_value(<span class="op">&amp;</span>text)<span class="op">;</span></span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true"></a>                    <span class="op">}</span></span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true"></a>                    list_item<span class="op">.</span>append_child(<span class="op">&amp;</span><span class="kw">mut</span> input)<span class="op">;</span></span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true"></a>                    input<span class="op">.</span>focus()<span class="op">;</span></span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true"></a></span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true"></a>    <span class="co">/// Used by scheduler to convert a `ViewMessage` into a function call on the `View`</span></span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true"></a>    <span class="kw">pub</span> <span class="kw">fn</span> call(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> method_name<span class="op">:</span> ViewMessage) <span class="op">{</span></span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true"></a>        <span class="kw">use</span> <span class="kw">self</span><span class="pp">::ViewMessage::</span><span class="op">*;</span></span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true"></a>        <span class="kw">match</span> method_name <span class="op">{</span></span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true"></a>            UpdateFilterButtons(route) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>update_filter_buttons(<span class="op">&amp;</span>route)<span class="op">,</span></span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true"></a>            ClearNewTodo() <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>clear_new_todo()<span class="op">,</span></span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true"></a>            ShowItems(item_list) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>show_items(item_list)<span class="op">,</span></span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true"></a>            SetItemsLeft(count) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>set_items_left(count)<span class="op">,</span></span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true"></a>            SetClearCompletedButtonVisibility(visible) <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true"></a>                <span class="kw">self</span><span class="op">.</span>set_clear_completed_button_visibility(visible)</span>
<span id="cb15-153"><a href="#cb15-153" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb15-154"><a href="#cb15-154" aria-hidden="true"></a>            SetCompleteAllCheckbox(complete) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>set_complete_all_checkbox(complete)<span class="op">,</span></span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true"></a>            SetMainVisibility(complete) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>set_main_visibility(complete)<span class="op">,</span></span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true"></a>            RemoveItem(id) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>remove_item(<span class="op">&amp;</span>id)<span class="op">,</span></span>
<span id="cb15-157"><a href="#cb15-157" aria-hidden="true"></a>            EditItemDone(id<span class="op">,</span> title) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>edit_item_done(<span class="op">&amp;</span>id<span class="op">,</span> <span class="op">&amp;</span>title)<span class="op">,</span></span>
<span id="cb15-158"><a href="#cb15-158" aria-hidden="true"></a>            SetItemComplete(id<span class="op">,</span> completed) <span class="op">=&gt;</span> <span class="kw">self</span><span class="op">.</span>set_item_complete(<span class="op">&amp;</span>id<span class="op">,</span> completed)<span class="op">,</span></span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb15-160"><a href="#cb15-160" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-161"><a href="#cb15-161" aria-hidden="true"></a></span>
<span id="cb15-162"><a href="#cb15-162" aria-hidden="true"></a>    <span class="co">/// Populate the todo list with a list of items.</span></span>
<span id="cb15-163"><a href="#cb15-163" aria-hidden="true"></a>    <span class="kw">fn</span> show_items(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> items<span class="op">:</span> ItemList) <span class="op">{</span></span>
<span id="cb15-164"><a href="#cb15-164" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>todo_list<span class="op">.</span>set_inner_html(<span class="pp">Template::</span>item_list(items))<span class="op">;</span></span>
<span id="cb15-165"><a href="#cb15-165" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-166"><a href="#cb15-166" aria-hidden="true"></a></span>
<span id="cb15-167"><a href="#cb15-167" aria-hidden="true"></a>    <span class="co">/// Gets the selector to find a todo item in the DOM</span></span>
<span id="cb15-168"><a href="#cb15-168" aria-hidden="true"></a>    <span class="kw">fn</span> get_selector_string(id<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb15-169"><a href="#cb15-169" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> selector <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>from(<span class="st">&quot;[data-id=</span><span class="sc">\&quot;</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb15-170"><a href="#cb15-170" aria-hidden="true"></a>        selector<span class="op">.</span>push_str(id)<span class="op">;</span></span>
<span id="cb15-171"><a href="#cb15-171" aria-hidden="true"></a>        selector<span class="op">.</span>push_str(<span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">]&quot;</span>)<span class="op">;</span></span>
<span id="cb15-172"><a href="#cb15-172" aria-hidden="true"></a>        selector</span>
<span id="cb15-173"><a href="#cb15-173" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-174"><a href="#cb15-174" aria-hidden="true"></a></span>
<span id="cb15-175"><a href="#cb15-175" aria-hidden="true"></a>    <span class="co">/// Remove an item from the view.</span></span>
<span id="cb15-176"><a href="#cb15-176" aria-hidden="true"></a>    <span class="kw">fn</span> remove_item(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> id<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb15-177"><a href="#cb15-177" aria-hidden="true"></a>        <span class="kw">let</span> elem <span class="op">=</span> <span class="pp">Element::</span>qs(<span class="op">&amp;</span><span class="pp">View::</span>get_selector_string(id))<span class="op">;</span></span>
<span id="cb15-178"><a href="#cb15-178" aria-hidden="true"></a></span>
<span id="cb15-179"><a href="#cb15-179" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(elem) <span class="op">=</span> elem <span class="op">{</span></span>
<span id="cb15-180"><a href="#cb15-180" aria-hidden="true"></a>            <span class="kw">self</span><span class="op">.</span>todo_list<span class="op">.</span>remove_child(elem)<span class="op">;</span></span>
<span id="cb15-181"><a href="#cb15-181" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb15-182"><a href="#cb15-182" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-183"><a href="#cb15-183" aria-hidden="true"></a></span>
<span id="cb15-184"><a href="#cb15-184" aria-hidden="true"></a>    <span class="co">/// Set the number in the &#39;items left&#39; display.</span></span>
<span id="cb15-185"><a href="#cb15-185" aria-hidden="true"></a>    <span class="kw">fn</span> set_items_left(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> items_left<span class="op">:</span> <span class="dt">usize</span>) <span class="op">{</span></span>
<span id="cb15-186"><a href="#cb15-186" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>todo_item_counter</span>
<span id="cb15-187"><a href="#cb15-187" aria-hidden="true"></a>            <span class="op">.</span>set_inner_html(<span class="pp">Template::</span>item_counter(items_left))<span class="op">;</span></span>
<span id="cb15-188"><a href="#cb15-188" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-189"><a href="#cb15-189" aria-hidden="true"></a></span>
<span id="cb15-190"><a href="#cb15-190" aria-hidden="true"></a>    <span class="co">/// Set the visibility of the &quot;Clear completed&quot; button.</span></span>
<span id="cb15-191"><a href="#cb15-191" aria-hidden="true"></a>    <span class="kw">fn</span> set_clear_completed_button_visibility(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> visible<span class="op">:</span> <span class="dt">bool</span>) <span class="op">{</span></span>
<span id="cb15-192"><a href="#cb15-192" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>clear_completed<span class="op">.</span>set_visibility(visible)<span class="op">;</span></span>
<span id="cb15-193"><a href="#cb15-193" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-194"><a href="#cb15-194" aria-hidden="true"></a></span>
<span id="cb15-195"><a href="#cb15-195" aria-hidden="true"></a>    <span class="co">/// Set the visibility of the main content and footer.</span></span>
<span id="cb15-196"><a href="#cb15-196" aria-hidden="true"></a>    <span class="kw">fn</span> set_main_visibility(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> visible<span class="op">:</span> <span class="dt">bool</span>) <span class="op">{</span></span>
<span id="cb15-197"><a href="#cb15-197" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>main<span class="op">.</span>set_visibility(visible)<span class="op">;</span></span>
<span id="cb15-198"><a href="#cb15-198" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-199"><a href="#cb15-199" aria-hidden="true"></a></span>
<span id="cb15-200"><a href="#cb15-200" aria-hidden="true"></a>    <span class="co">/// Set the checked state of the Complete All checkbox.</span></span>
<span id="cb15-201"><a href="#cb15-201" aria-hidden="true"></a>    <span class="kw">fn</span> set_complete_all_checkbox(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span><span class="op">,</span> checked<span class="op">:</span> <span class="dt">bool</span>) <span class="op">{</span></span>
<span id="cb15-202"><a href="#cb15-202" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>toggle_all<span class="op">.</span>set_checked(checked)<span class="op">;</span></span>
<span id="cb15-203"><a href="#cb15-203" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-204"><a href="#cb15-204" aria-hidden="true"></a></span>
<span id="cb15-205"><a href="#cb15-205" aria-hidden="true"></a>    <span class="co">/// Change the appearance of the filter buttons based on the route.</span></span>
<span id="cb15-206"><a href="#cb15-206" aria-hidden="true"></a>    <span class="kw">fn</span> update_filter_buttons(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> route<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb15-207"><a href="#cb15-207" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">mut</span> el) <span class="op">=</span> <span class="pp">Element::</span>qs(<span class="st">&quot;.filters .selected&quot;</span>) <span class="op">{</span></span>
<span id="cb15-208"><a href="#cb15-208" aria-hidden="true"></a>            el<span class="op">.</span>set_class_name(<span class="st">&quot;&quot;</span>)<span class="op">;</span></span>
<span id="cb15-209"><a href="#cb15-209" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb15-210"><a href="#cb15-210" aria-hidden="true"></a></span>
<span id="cb15-211"><a href="#cb15-211" aria-hidden="true"></a>        <span class="kw">let</span> <span class="kw">mut</span> selector <span class="op">=</span> <span class="dt">String</span><span class="pp">::</span>from(<span class="st">&quot;.filters [href=</span><span class="sc">\&quot;</span><span class="st">&quot;</span>)<span class="op">;</span></span>
<span id="cb15-212"><a href="#cb15-212" aria-hidden="true"></a>        selector<span class="op">.</span>push_str(route)<span class="op">;</span></span>
<span id="cb15-213"><a href="#cb15-213" aria-hidden="true"></a>        selector<span class="op">.</span>push_str(<span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">]&quot;</span>)<span class="op">;</span></span>
<span id="cb15-214"><a href="#cb15-214" aria-hidden="true"></a></span>
<span id="cb15-215"><a href="#cb15-215" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">mut</span> el) <span class="op">=</span> <span class="pp">Element::</span>qs(<span class="op">&amp;</span>selector) <span class="op">{</span></span>
<span id="cb15-216"><a href="#cb15-216" aria-hidden="true"></a>            el<span class="op">.</span>set_class_name(<span class="st">&quot;selected&quot;</span>)<span class="op">;</span></span>
<span id="cb15-217"><a href="#cb15-217" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb15-218"><a href="#cb15-218" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-219"><a href="#cb15-219" aria-hidden="true"></a></span>
<span id="cb15-220"><a href="#cb15-220" aria-hidden="true"></a>    <span class="co">/// Clear the new todo input</span></span>
<span id="cb15-221"><a href="#cb15-221" aria-hidden="true"></a>    <span class="kw">fn</span> clear_new_todo(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb15-222"><a href="#cb15-222" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>new_todo<span class="op">.</span>set_value(<span class="st">&quot;&quot;</span>)<span class="op">;</span></span>
<span id="cb15-223"><a href="#cb15-223" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-224"><a href="#cb15-224" aria-hidden="true"></a></span>
<span id="cb15-225"><a href="#cb15-225" aria-hidden="true"></a>    <span class="co">/// Render an item as either completed or not.</span></span>
<span id="cb15-226"><a href="#cb15-226" aria-hidden="true"></a>    <span class="kw">fn</span> set_item_complete(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> id<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> completed<span class="op">:</span> <span class="dt">bool</span>) <span class="op">{</span></span>
<span id="cb15-227"><a href="#cb15-227" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">mut</span> list_item) <span class="op">=</span> <span class="pp">Element::</span>qs(<span class="op">&amp;</span><span class="pp">View::</span>get_selector_string(id)) <span class="op">{</span></span>
<span id="cb15-228"><a href="#cb15-228" aria-hidden="true"></a>            <span class="kw">let</span> class_name <span class="op">=</span> <span class="kw">if</span> completed <span class="op">{</span> <span class="st">&quot;completed&quot;</span> <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="st">&quot;&quot;</span> <span class="op">};</span></span>
<span id="cb15-229"><a href="#cb15-229" aria-hidden="true"></a>            list_item<span class="op">.</span>set_class_name(class_name)<span class="op">;</span></span>
<span id="cb15-230"><a href="#cb15-230" aria-hidden="true"></a></span>
<span id="cb15-231"><a href="#cb15-231" aria-hidden="true"></a>            <span class="co">// In case it was toggled from an event and not by clicking the checkbox</span></span>
<span id="cb15-232"><a href="#cb15-232" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">mut</span> el) <span class="op">=</span> list_item<span class="op">.</span>qs_from(<span class="st">&quot;input&quot;</span>) <span class="op">{</span></span>
<span id="cb15-233"><a href="#cb15-233" aria-hidden="true"></a>                el<span class="op">.</span>set_checked(completed)<span class="op">;</span></span>
<span id="cb15-234"><a href="#cb15-234" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb15-235"><a href="#cb15-235" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb15-236"><a href="#cb15-236" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-237"><a href="#cb15-237" aria-hidden="true"></a></span>
<span id="cb15-238"><a href="#cb15-238" aria-hidden="true"></a>    <span class="co">/// Bring an item out of edit mode.</span></span>
<span id="cb15-239"><a href="#cb15-239" aria-hidden="true"></a>    <span class="kw">fn</span> edit_item_done(<span class="op">&amp;</span><span class="kw">self</span><span class="op">,</span> id<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span><span class="op">,</span> title<span class="op">:</span> <span class="op">&amp;</span><span class="dt">str</span>) <span class="op">{</span></span>
<span id="cb15-240"><a href="#cb15-240" aria-hidden="true"></a>        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">mut</span> list_item) <span class="op">=</span> <span class="pp">Element::</span>qs(<span class="op">&amp;</span><span class="pp">View::</span>get_selector_string(id)) <span class="op">{</span></span>
<span id="cb15-241"><a href="#cb15-241" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(input) <span class="op">=</span> list_item<span class="op">.</span>qs_from(<span class="st">&quot;input.edit&quot;</span>) <span class="op">{</span></span>
<span id="cb15-242"><a href="#cb15-242" aria-hidden="true"></a>                list_item<span class="op">.</span>class_list_remove(<span class="st">&quot;editing&quot;</span>)<span class="op">;</span></span>
<span id="cb15-243"><a href="#cb15-243" aria-hidden="true"></a></span>
<span id="cb15-244"><a href="#cb15-244" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(<span class="kw">mut</span> list_item_label) <span class="op">=</span> list_item<span class="op">.</span>qs_from(<span class="st">&quot;label&quot;</span>) <span class="op">{</span></span>
<span id="cb15-245"><a href="#cb15-245" aria-hidden="true"></a>                    list_item_label<span class="op">.</span>set_text_content(title)<span class="op">;</span></span>
<span id="cb15-246"><a href="#cb15-246" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb15-247"><a href="#cb15-247" aria-hidden="true"></a></span>
<span id="cb15-248"><a href="#cb15-248" aria-hidden="true"></a>                list_item<span class="op">.</span>remove_child(input)<span class="op">;</span></span>
<span id="cb15-249"><a href="#cb15-249" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb15-250"><a href="#cb15-250" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb15-251"><a href="#cb15-251" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-252"><a href="#cb15-252" aria-hidden="true"></a></span>
<span id="cb15-253"><a href="#cb15-253" aria-hidden="true"></a>    <span class="kw">fn</span> bind_add_item(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb15-254"><a href="#cb15-254" aria-hidden="true"></a>        <span class="kw">let</span> sched <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>sched<span class="op">.</span>clone()<span class="op">;</span></span>
<span id="cb15-255"><a href="#cb15-255" aria-hidden="true"></a>        <span class="kw">let</span> cb <span class="op">=</span> <span class="kw">move</span> <span class="op">|</span>event<span class="op">:</span> <span class="pp">web_sys::</span>Event<span class="op">|</span> <span class="op">{</span></span>
<span id="cb15-256"><a href="#cb15-256" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(target) <span class="op">=</span> event<span class="op">.</span>target() <span class="op">{</span></span>
<span id="cb15-257"><a href="#cb15-257" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(input_el) <span class="op">=</span></span>
<span id="cb15-258"><a href="#cb15-258" aria-hidden="true"></a>                    <span class="pp">wasm_bindgen::JsCast::dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>HtmlInputElement<span class="op">&gt;</span>(<span class="op">&amp;</span>target)</span>
<span id="cb15-259"><a href="#cb15-259" aria-hidden="true"></a>                <span class="op">{</span></span>
<span id="cb15-260"><a href="#cb15-260" aria-hidden="true"></a>                    <span class="kw">let</span> v <span class="op">=</span> input_el<span class="op">.</span>value()<span class="op">;</span> <span class="co">// </span><span class="al">TODO</span><span class="co"> remove with nll</span></span>
<span id="cb15-261"><a href="#cb15-261" aria-hidden="true"></a>                    <span class="kw">let</span> title <span class="op">=</span> v<span class="op">.</span>trim()<span class="op">;</span></span>
<span id="cb15-262"><a href="#cb15-262" aria-hidden="true"></a>                    <span class="kw">if</span> <span class="op">!</span>title<span class="op">.</span>is_empty() <span class="op">{</span></span>
<span id="cb15-263"><a href="#cb15-263" aria-hidden="true"></a>                        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(sched) <span class="op">=</span> <span class="op">&amp;</span>(sched<span class="op">.</span>try_borrow_mut()) <span class="op">{</span></span>
<span id="cb15-264"><a href="#cb15-264" aria-hidden="true"></a>                            sched<span class="op">.</span>add_message(<span class="pp">Message::</span>Controller(<span class="pp">ControllerMessage::</span>AddItem(</span>
<span id="cb15-265"><a href="#cb15-265" aria-hidden="true"></a>                                <span class="dt">String</span><span class="pp">::</span>from(title)<span class="op">,</span></span>
<span id="cb15-266"><a href="#cb15-266" aria-hidden="true"></a>                            )))<span class="op">;</span></span>
<span id="cb15-267"><a href="#cb15-267" aria-hidden="true"></a>                        <span class="op">}</span></span>
<span id="cb15-268"><a href="#cb15-268" aria-hidden="true"></a>                    <span class="op">}</span></span>
<span id="cb15-269"><a href="#cb15-269" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb15-270"><a href="#cb15-270" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb15-271"><a href="#cb15-271" aria-hidden="true"></a>        <span class="op">};</span></span>
<span id="cb15-272"><a href="#cb15-272" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>new_todo<span class="op">.</span>add_event_listener(<span class="st">&quot;change&quot;</span><span class="op">,</span> cb)<span class="op">;</span></span>
<span id="cb15-273"><a href="#cb15-273" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-274"><a href="#cb15-274" aria-hidden="true"></a></span>
<span id="cb15-275"><a href="#cb15-275" aria-hidden="true"></a>    <span class="kw">fn</span> bind_remove_completed(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb15-276"><a href="#cb15-276" aria-hidden="true"></a>        <span class="kw">let</span> sched <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>sched<span class="op">.</span>clone()<span class="op">;</span></span>
<span id="cb15-277"><a href="#cb15-277" aria-hidden="true"></a>        <span class="kw">let</span> handler <span class="op">=</span> <span class="kw">move</span> <span class="op">|</span>_<span class="op">|</span> <span class="op">{</span></span>
<span id="cb15-278"><a href="#cb15-278" aria-hidden="true"></a>            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(sched) <span class="op">=</span> <span class="op">&amp;</span>(sched<span class="op">.</span>try_borrow_mut()) <span class="op">{</span></span>
<span id="cb15-279"><a href="#cb15-279" aria-hidden="true"></a>                sched<span class="op">.</span>add_message(<span class="pp">Message::</span>Controller(<span class="pp">ControllerMessage::</span>RemoveCompleted()))<span class="op">;</span></span>
<span id="cb15-280"><a href="#cb15-280" aria-hidden="true"></a>            <span class="op">}</span></span>
<span id="cb15-281"><a href="#cb15-281" aria-hidden="true"></a>        <span class="op">};</span></span>
<span id="cb15-282"><a href="#cb15-282" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>clear_completed<span class="op">.</span>add_event_listener(<span class="st">&quot;click&quot;</span><span class="op">,</span> handler)<span class="op">;</span></span>
<span id="cb15-283"><a href="#cb15-283" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-284"><a href="#cb15-284" aria-hidden="true"></a></span>
<span id="cb15-285"><a href="#cb15-285" aria-hidden="true"></a>    <span class="kw">fn</span> bind_toggle_all(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb15-286"><a href="#cb15-286" aria-hidden="true"></a>        <span class="kw">let</span> sched <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>sched<span class="op">.</span>clone()<span class="op">;</span></span>
<span id="cb15-287"><a href="#cb15-287" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>toggle_all</span>
<span id="cb15-288"><a href="#cb15-288" aria-hidden="true"></a>            <span class="op">.</span>add_event_listener(<span class="st">&quot;click&quot;</span><span class="op">,</span> <span class="kw">move</span> <span class="op">|</span>event<span class="op">:</span> <span class="pp">web_sys::</span>Event<span class="op">|</span> <span class="op">{</span></span>
<span id="cb15-289"><a href="#cb15-289" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(target) <span class="op">=</span> event<span class="op">.</span>target() <span class="op">{</span></span>
<span id="cb15-290"><a href="#cb15-290" aria-hidden="true"></a>                    <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(input_el) <span class="op">=</span></span>
<span id="cb15-291"><a href="#cb15-291" aria-hidden="true"></a>                        <span class="pp">wasm_bindgen::JsCast::dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>HtmlInputElement<span class="op">&gt;</span>(<span class="op">&amp;</span>target)</span>
<span id="cb15-292"><a href="#cb15-292" aria-hidden="true"></a>                    <span class="op">{</span></span>
<span id="cb15-293"><a href="#cb15-293" aria-hidden="true"></a>                        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(sched) <span class="op">=</span> <span class="op">&amp;</span>(sched<span class="op">.</span>try_borrow_mut()) <span class="op">{</span></span>
<span id="cb15-294"><a href="#cb15-294" aria-hidden="true"></a>                            sched<span class="op">.</span>add_message(<span class="pp">Message::</span>Controller(<span class="pp">ControllerMessage::</span>ToggleAll(</span>
<span id="cb15-295"><a href="#cb15-295" aria-hidden="true"></a>                                input_el<span class="op">.</span>checked()<span class="op">,</span></span>
<span id="cb15-296"><a href="#cb15-296" aria-hidden="true"></a>                            )))<span class="op">;</span></span>
<span id="cb15-297"><a href="#cb15-297" aria-hidden="true"></a>                        <span class="op">}</span></span>
<span id="cb15-298"><a href="#cb15-298" aria-hidden="true"></a>                    <span class="op">}</span></span>
<span id="cb15-299"><a href="#cb15-299" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb15-300"><a href="#cb15-300" aria-hidden="true"></a>            <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb15-301"><a href="#cb15-301" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-302"><a href="#cb15-302" aria-hidden="true"></a></span>
<span id="cb15-303"><a href="#cb15-303" aria-hidden="true"></a>    <span class="kw">fn</span> bind_remove_item(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb15-304"><a href="#cb15-304" aria-hidden="true"></a>        <span class="kw">let</span> sched <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>sched<span class="op">.</span>clone()<span class="op">;</span></span>
<span id="cb15-305"><a href="#cb15-305" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>todo_list<span class="op">.</span>delegate(</span>
<span id="cb15-306"><a href="#cb15-306" aria-hidden="true"></a>            <span class="st">&quot;.destroy&quot;</span><span class="op">,</span></span>
<span id="cb15-307"><a href="#cb15-307" aria-hidden="true"></a>            <span class="st">&quot;click&quot;</span><span class="op">,</span></span>
<span id="cb15-308"><a href="#cb15-308" aria-hidden="true"></a>            <span class="kw">move</span> <span class="op">|</span>e<span class="op">:</span> <span class="pp">web_sys::</span>Event<span class="op">|</span> <span class="op">{</span></span>
<span id="cb15-309"><a href="#cb15-309" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(target) <span class="op">=</span> e<span class="op">.</span>target() <span class="op">{</span></span>
<span id="cb15-310"><a href="#cb15-310" aria-hidden="true"></a>                    <span class="kw">let</span> el<span class="op">:</span> Element <span class="op">=</span> target<span class="op">.</span>into()<span class="op">;</span></span>
<span id="cb15-311"><a href="#cb15-311" aria-hidden="true"></a>                    <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(item_id) <span class="op">=</span> item_id(el) <span class="op">{</span></span>
<span id="cb15-312"><a href="#cb15-312" aria-hidden="true"></a>                        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(sched) <span class="op">=</span> <span class="op">&amp;</span>(sched<span class="op">.</span>try_borrow_mut()) <span class="op">{</span></span>
<span id="cb15-313"><a href="#cb15-313" aria-hidden="true"></a>                            sched<span class="op">.</span>add_message(<span class="pp">Message::</span>Controller(<span class="pp">ControllerMessage::</span>RemoveItem(</span>
<span id="cb15-314"><a href="#cb15-314" aria-hidden="true"></a>                                item_id<span class="op">,</span></span>
<span id="cb15-315"><a href="#cb15-315" aria-hidden="true"></a>                            )))<span class="op">;</span></span>
<span id="cb15-316"><a href="#cb15-316" aria-hidden="true"></a>                        <span class="op">}</span></span>
<span id="cb15-317"><a href="#cb15-317" aria-hidden="true"></a>                    <span class="op">}</span></span>
<span id="cb15-318"><a href="#cb15-318" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb15-319"><a href="#cb15-319" aria-hidden="true"></a>            <span class="op">},</span></span>
<span id="cb15-320"><a href="#cb15-320" aria-hidden="true"></a>            <span class="cn">false</span><span class="op">,</span></span>
<span id="cb15-321"><a href="#cb15-321" aria-hidden="true"></a>        )<span class="op">;</span></span>
<span id="cb15-322"><a href="#cb15-322" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-323"><a href="#cb15-323" aria-hidden="true"></a></span>
<span id="cb15-324"><a href="#cb15-324" aria-hidden="true"></a>    <span class="kw">fn</span> bind_toggle_item(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb15-325"><a href="#cb15-325" aria-hidden="true"></a>        <span class="kw">let</span> sched <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>sched<span class="op">.</span>clone()<span class="op">;</span></span>
<span id="cb15-326"><a href="#cb15-326" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>todo_list<span class="op">.</span>delegate(</span>
<span id="cb15-327"><a href="#cb15-327" aria-hidden="true"></a>            <span class="st">&quot;.toggle&quot;</span><span class="op">,</span></span>
<span id="cb15-328"><a href="#cb15-328" aria-hidden="true"></a>            <span class="st">&quot;click&quot;</span><span class="op">,</span></span>
<span id="cb15-329"><a href="#cb15-329" aria-hidden="true"></a>            <span class="kw">move</span> <span class="op">|</span>e<span class="op">:</span> <span class="pp">web_sys::</span>Event<span class="op">|</span> <span class="op">{</span></span>
<span id="cb15-330"><a href="#cb15-330" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(target) <span class="op">=</span> e<span class="op">.</span>target() <span class="op">{</span></span>
<span id="cb15-331"><a href="#cb15-331" aria-hidden="true"></a>                    <span class="kw">let</span> <span class="kw">mut</span> el<span class="op">:</span> Element <span class="op">=</span> target<span class="op">.</span>into()<span class="op">;</span></span>
<span id="cb15-332"><a href="#cb15-332" aria-hidden="true"></a>                    <span class="kw">let</span> checked <span class="op">=</span> el<span class="op">.</span>checked()<span class="op">;</span></span>
<span id="cb15-333"><a href="#cb15-333" aria-hidden="true"></a>                    <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(item_id) <span class="op">=</span> item_id(el) <span class="op">{</span></span>
<span id="cb15-334"><a href="#cb15-334" aria-hidden="true"></a>                        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(sched) <span class="op">=</span> <span class="op">&amp;</span>(sched<span class="op">.</span>try_borrow_mut()) <span class="op">{</span></span>
<span id="cb15-335"><a href="#cb15-335" aria-hidden="true"></a>                            sched<span class="op">.</span>add_message(<span class="pp">Message::</span>Controller(<span class="pp">ControllerMessage::</span>ToggleItem(</span>
<span id="cb15-336"><a href="#cb15-336" aria-hidden="true"></a>                                item_id<span class="op">,</span> checked<span class="op">,</span></span>
<span id="cb15-337"><a href="#cb15-337" aria-hidden="true"></a>                            )))<span class="op">;</span></span>
<span id="cb15-338"><a href="#cb15-338" aria-hidden="true"></a>                        <span class="op">}</span></span>
<span id="cb15-339"><a href="#cb15-339" aria-hidden="true"></a>                    <span class="op">}</span></span>
<span id="cb15-340"><a href="#cb15-340" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb15-341"><a href="#cb15-341" aria-hidden="true"></a>            <span class="op">},</span></span>
<span id="cb15-342"><a href="#cb15-342" aria-hidden="true"></a>            <span class="cn">false</span><span class="op">,</span></span>
<span id="cb15-343"><a href="#cb15-343" aria-hidden="true"></a>        )<span class="op">;</span></span>
<span id="cb15-344"><a href="#cb15-344" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-345"><a href="#cb15-345" aria-hidden="true"></a></span>
<span id="cb15-346"><a href="#cb15-346" aria-hidden="true"></a>    <span class="kw">fn</span> bind_edit_item_save(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb15-347"><a href="#cb15-347" aria-hidden="true"></a>        <span class="kw">let</span> sched <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>sched<span class="op">.</span>clone()<span class="op">;</span></span>
<span id="cb15-348"><a href="#cb15-348" aria-hidden="true"></a></span>
<span id="cb15-349"><a href="#cb15-349" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>todo_list<span class="op">.</span>delegate(</span>
<span id="cb15-350"><a href="#cb15-350" aria-hidden="true"></a>            <span class="st">&quot;li .edit&quot;</span><span class="op">,</span></span>
<span id="cb15-351"><a href="#cb15-351" aria-hidden="true"></a>            <span class="st">&quot;blur&quot;</span><span class="op">,</span></span>
<span id="cb15-352"><a href="#cb15-352" aria-hidden="true"></a>            <span class="kw">move</span> <span class="op">|</span>e<span class="op">:</span> <span class="pp">web_sys::</span>Event<span class="op">|</span> <span class="op">{</span></span>
<span id="cb15-353"><a href="#cb15-353" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(target) <span class="op">=</span> e<span class="op">.</span>target() <span class="op">{</span></span>
<span id="cb15-354"><a href="#cb15-354" aria-hidden="true"></a>                    <span class="kw">let</span> <span class="kw">mut</span> target_el<span class="op">:</span> Element <span class="op">=</span> target<span class="op">.</span>into()<span class="op">;</span></span>
<span id="cb15-355"><a href="#cb15-355" aria-hidden="true"></a>                    <span class="kw">if</span> target_el<span class="op">.</span>dataset_get(<span class="st">&quot;iscancelled&quot;</span>) <span class="op">!=</span> <span class="st">&quot;true&quot;</span> <span class="op">{</span></span>
<span id="cb15-356"><a href="#cb15-356" aria-hidden="true"></a>                        <span class="kw">let</span> val <span class="op">=</span> target_el<span class="op">.</span>value()<span class="op">;</span></span>
<span id="cb15-357"><a href="#cb15-357" aria-hidden="true"></a>                        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(item) <span class="op">=</span> item_id(target_el) <span class="op">{</span></span>
<span id="cb15-358"><a href="#cb15-358" aria-hidden="true"></a>                            <span class="co">// </span><span class="al">TODO</span><span class="co"> refactor back into fn</span></span>
<span id="cb15-359"><a href="#cb15-359" aria-hidden="true"></a>                            <span class="co">// Was: &amp;self.add_message(ControllerMessage::SetPage(hash));</span></span>
<span id="cb15-360"><a href="#cb15-360" aria-hidden="true"></a>                            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(sched) <span class="op">=</span> <span class="op">&amp;</span>(sched<span class="op">.</span>try_borrow_mut()) <span class="op">{</span></span>
<span id="cb15-361"><a href="#cb15-361" aria-hidden="true"></a>                                sched<span class="op">.</span>add_message(<span class="pp">Message::</span>Controller(</span>
<span id="cb15-362"><a href="#cb15-362" aria-hidden="true"></a>                                    <span class="pp">ControllerMessage::</span>EditItemSave(item<span class="op">,</span> val)<span class="op">,</span></span>
<span id="cb15-363"><a href="#cb15-363" aria-hidden="true"></a>                                ))<span class="op">;</span></span>
<span id="cb15-364"><a href="#cb15-364" aria-hidden="true"></a>                            <span class="op">}</span></span>
<span id="cb15-365"><a href="#cb15-365" aria-hidden="true"></a>                            <span class="co">// </span><span class="al">TODO</span><span class="co"> refactor back into fn</span></span>
<span id="cb15-366"><a href="#cb15-366" aria-hidden="true"></a>                        <span class="op">}</span></span>
<span id="cb15-367"><a href="#cb15-367" aria-hidden="true"></a>                    <span class="op">}</span></span>
<span id="cb15-368"><a href="#cb15-368" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb15-369"><a href="#cb15-369" aria-hidden="true"></a>            <span class="op">},</span></span>
<span id="cb15-370"><a href="#cb15-370" aria-hidden="true"></a>            <span class="cn">true</span><span class="op">,</span></span>
<span id="cb15-371"><a href="#cb15-371" aria-hidden="true"></a>        )<span class="op">;</span></span>
<span id="cb15-372"><a href="#cb15-372" aria-hidden="true"></a></span>
<span id="cb15-373"><a href="#cb15-373" aria-hidden="true"></a>        <span class="co">// Remove the cursor from the input when you hit enter just like if it were a real form</span></span>
<span id="cb15-374"><a href="#cb15-374" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>todo_list<span class="op">.</span>delegate(</span>
<span id="cb15-375"><a href="#cb15-375" aria-hidden="true"></a>            <span class="st">&quot;li .edit&quot;</span><span class="op">,</span></span>
<span id="cb15-376"><a href="#cb15-376" aria-hidden="true"></a>            <span class="st">&quot;keypress&quot;</span><span class="op">,</span></span>
<span id="cb15-377"><a href="#cb15-377" aria-hidden="true"></a>            <span class="op">|</span>e<span class="op">:</span> <span class="pp">web_sys::</span>Event<span class="op">|</span> <span class="op">{</span></span>
<span id="cb15-378"><a href="#cb15-378" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(key_e) <span class="op">=</span> <span class="pp">wasm_bindgen::JsCast::dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>KeyboardEvent<span class="op">&gt;</span>(<span class="op">&amp;</span>e) <span class="op">{</span></span>
<span id="cb15-379"><a href="#cb15-379" aria-hidden="true"></a>                    <span class="kw">if</span> key_e<span class="op">.</span>key_code() <span class="op">==</span> ENTER_KEY <span class="op">{</span></span>
<span id="cb15-380"><a href="#cb15-380" aria-hidden="true"></a>                        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(target) <span class="op">=</span> e<span class="op">.</span>target() <span class="op">{</span></span>
<span id="cb15-381"><a href="#cb15-381" aria-hidden="true"></a>                            <span class="kw">let</span> <span class="kw">mut</span> el<span class="op">:</span> Element <span class="op">=</span> target<span class="op">.</span>into()<span class="op">;</span></span>
<span id="cb15-382"><a href="#cb15-382" aria-hidden="true"></a>                            el<span class="op">.</span>blur()<span class="op">;</span></span>
<span id="cb15-383"><a href="#cb15-383" aria-hidden="true"></a>                        <span class="op">}</span></span>
<span id="cb15-384"><a href="#cb15-384" aria-hidden="true"></a>                    <span class="op">}</span></span>
<span id="cb15-385"><a href="#cb15-385" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb15-386"><a href="#cb15-386" aria-hidden="true"></a>            <span class="op">},</span></span>
<span id="cb15-387"><a href="#cb15-387" aria-hidden="true"></a>            <span class="cn">false</span><span class="op">,</span></span>
<span id="cb15-388"><a href="#cb15-388" aria-hidden="true"></a>        )<span class="op">;</span></span>
<span id="cb15-389"><a href="#cb15-389" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-390"><a href="#cb15-390" aria-hidden="true"></a></span>
<span id="cb15-391"><a href="#cb15-391" aria-hidden="true"></a>    <span class="kw">fn</span> bind_edit_item_cancel(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb15-392"><a href="#cb15-392" aria-hidden="true"></a>        <span class="kw">let</span> sched <span class="op">=</span> <span class="kw">self</span><span class="op">.</span>sched<span class="op">.</span>clone()<span class="op">;</span></span>
<span id="cb15-393"><a href="#cb15-393" aria-hidden="true"></a>        <span class="kw">self</span><span class="op">.</span>todo_list<span class="op">.</span>delegate(</span>
<span id="cb15-394"><a href="#cb15-394" aria-hidden="true"></a>            <span class="st">&quot;li .edit&quot;</span><span class="op">,</span></span>
<span id="cb15-395"><a href="#cb15-395" aria-hidden="true"></a>            <span class="st">&quot;keyup&quot;</span><span class="op">,</span></span>
<span id="cb15-396"><a href="#cb15-396" aria-hidden="true"></a>            <span class="kw">move</span> <span class="op">|</span>e<span class="op">:</span> <span class="pp">web_sys::</span>Event<span class="op">|</span> <span class="op">{</span></span>
<span id="cb15-397"><a href="#cb15-397" aria-hidden="true"></a>                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(key_e) <span class="op">=</span> <span class="pp">wasm_bindgen::JsCast::dyn_ref::</span><span class="op">&lt;</span><span class="pp">web_sys::</span>KeyboardEvent<span class="op">&gt;</span>(<span class="op">&amp;</span>e) <span class="op">{</span></span>
<span id="cb15-398"><a href="#cb15-398" aria-hidden="true"></a>                    <span class="kw">if</span> key_e<span class="op">.</span>key_code() <span class="op">==</span> ESCAPE_KEY <span class="op">{</span></span>
<span id="cb15-399"><a href="#cb15-399" aria-hidden="true"></a>                        <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(target) <span class="op">=</span> e<span class="op">.</span>target() <span class="op">{</span></span>
<span id="cb15-400"><a href="#cb15-400" aria-hidden="true"></a>                            <span class="kw">let</span> <span class="kw">mut</span> el<span class="op">:</span> Element <span class="op">=</span> target<span class="op">.</span>into()<span class="op">;</span></span>
<span id="cb15-401"><a href="#cb15-401" aria-hidden="true"></a>                            el<span class="op">.</span>dataset_set(<span class="st">&quot;iscanceled&quot;</span><span class="op">,</span> <span class="st">&quot;true&quot;</span>)<span class="op">;</span></span>
<span id="cb15-402"><a href="#cb15-402" aria-hidden="true"></a>                            el<span class="op">.</span>blur()<span class="op">;</span></span>
<span id="cb15-403"><a href="#cb15-403" aria-hidden="true"></a>                            <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Some</span>(item_id) <span class="op">=</span> item_id(el) <span class="op">{</span></span>
<span id="cb15-404"><a href="#cb15-404" aria-hidden="true"></a>                                <span class="kw">if</span> <span class="kw">let</span> <span class="cn">Ok</span>(sched) <span class="op">=</span> <span class="op">&amp;</span>(sched<span class="op">.</span>try_borrow_mut()) <span class="op">{</span></span>
<span id="cb15-405"><a href="#cb15-405" aria-hidden="true"></a>                                    sched<span class="op">.</span>add_message(<span class="pp">Message::</span>Controller(</span>
<span id="cb15-406"><a href="#cb15-406" aria-hidden="true"></a>                                        <span class="pp">ControllerMessage::</span>EditItemCancel(item_id)<span class="op">,</span></span>
<span id="cb15-407"><a href="#cb15-407" aria-hidden="true"></a>                                    ))<span class="op">;</span></span>
<span id="cb15-408"><a href="#cb15-408" aria-hidden="true"></a>                                <span class="op">}</span></span>
<span id="cb15-409"><a href="#cb15-409" aria-hidden="true"></a>                            <span class="op">}</span></span>
<span id="cb15-410"><a href="#cb15-410" aria-hidden="true"></a>                        <span class="op">}</span></span>
<span id="cb15-411"><a href="#cb15-411" aria-hidden="true"></a>                    <span class="op">}</span></span>
<span id="cb15-412"><a href="#cb15-412" aria-hidden="true"></a>                <span class="op">}</span></span>
<span id="cb15-413"><a href="#cb15-413" aria-hidden="true"></a>            <span class="op">},</span></span>
<span id="cb15-414"><a href="#cb15-414" aria-hidden="true"></a>            <span class="cn">false</span><span class="op">,</span></span>
<span id="cb15-415"><a href="#cb15-415" aria-hidden="true"></a>        )<span class="op">;</span></span>
<span id="cb15-416"><a href="#cb15-416" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-417"><a href="#cb15-417" aria-hidden="true"></a><span class="op">}</span></span>
<span id="cb15-418"><a href="#cb15-418" aria-hidden="true"></a></span>
<span id="cb15-419"><a href="#cb15-419" aria-hidden="true"></a><span class="kw">impl</span> <span class="bu">Drop</span> <span class="kw">for</span> View <span class="op">{</span></span>
<span id="cb15-420"><a href="#cb15-420" aria-hidden="true"></a>    <span class="kw">fn</span> drop(<span class="op">&amp;</span><span class="kw">mut</span> <span class="kw">self</span>) <span class="op">{</span></span>
<span id="cb15-421"><a href="#cb15-421" aria-hidden="true"></a>        <span class="kw">for</span> callback <span class="kw">in</span> <span class="kw">self</span><span class="op">.</span>callbacks<span class="op">.</span>drain(<span class="op">..</span>) <span class="op">{</span></span>
<span id="cb15-422"><a href="#cb15-422" aria-hidden="true"></a>            callback</span>
<span id="cb15-423"><a href="#cb15-423" aria-hidden="true"></a>                <span class="op">.</span><span class="dv">0</span></span>
<span id="cb15-424"><a href="#cb15-424" aria-hidden="true"></a>                <span class="op">.</span>remove_event_listener_with_callback(</span>
<span id="cb15-425"><a href="#cb15-425" aria-hidden="true"></a>                    callback<span class="op">.</span><span class="dv">1</span><span class="op">.</span>as_str()<span class="op">,</span></span>
<span id="cb15-426"><a href="#cb15-426" aria-hidden="true"></a>                    callback<span class="op">.</span><span class="dv">2</span><span class="op">.</span>as_ref()<span class="op">.</span>unchecked_ref()<span class="op">,</span></span>
<span id="cb15-427"><a href="#cb15-427" aria-hidden="true"></a>                )</span>
<span id="cb15-428"><a href="#cb15-428" aria-hidden="true"></a>                <span class="op">.</span>unwrap()<span class="op">;</span></span>
<span id="cb15-429"><a href="#cb15-429" aria-hidden="true"></a>        <span class="op">}</span></span>
<span id="cb15-430"><a href="#cb15-430" aria-hidden="true"></a>        exit(<span class="st">&quot;calling drop on view&quot;</span>)<span class="op">;</span></span>
<span id="cb15-431"><a href="#cb15-431" aria-hidden="true"></a>    <span class="op">}</span></span>
<span id="cb15-432"><a href="#cb15-432" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<ul>
<li>build</li>
</ul>
<p>Adding in TODO MVC example using web-sys</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a><span class="kw">extern</span> <span class="kw">crate</span> askama<span class="op">;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a>    <span class="pp">askama::</span>rerun_if_templates_changed()<span class="op">;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a><span class="op">}</span></span></code></pre></div>
<h3 id="running-the-demo">Running the demo</h3>
<p>"<em>Currently it’s required to use the –target no-modules or –target web flag with wasm-bindgen to run threaded code. This is because the WebAssembly file imports memory instead of exporting it, so we need to hook initialization of the wasm module at this time to provide the appropriate memory object. This demo uses –target no-modules, because Firefox does not support modules in workers.</em></p>
<p><em>With –target no-modules you’ll be able to use importScripts inside of each web worker to import the shim JS generated by wasm-bindgen as well as calling the wasm_bindgen initialization function with the shared memory instance from the main thread. The expected usage is that WebAssembly on the main thread will post its memory object to all other threads to get instantiated with.</em>"<br />
_ <a href="https://rustwasm.github.io/wasm-bindgen/examples/raytrace-parallel.html" target="_blank">wasm-bindgen Guide</a></p>
<h2 id="build-and-serve">build and serve</h2>
<blockquote>
<p>This example requires to <em>not</em> create ES modules, therefore we pass the flag <code>--target no-modules</code></p>
</blockquote>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="ex">wasm-pack</span> build --target no-modules --no-typescript --out-dir www/pkg</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a><span class="ex">http</span> www</span></code></pre></div>
<p>open <code>index.html</code></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a><span class="ex">firefox</span> http://localhost:8000/html/</span></code></pre></div>
<p>NOTE:</p>
<p><em> Size</p>
<p>The size of the project hasn’t undergone much work to make it optimised yet.</p>
<pre><code>~96kb release build
~76kb optimised with binaryen
~28kb brotli compressed</code></pre>
<p></em> <a href="https://rustwasm.github.io/wasm-bindgen/examples/todomvc.html">wasm-bindgen guide</a> —</p>
<h2 id="whats-next">What’s next?</h2>
<p>Were are done for now.</p>
</main>
<script src="https://lerina.github.io/js/toc.js"></script>
<script>
let anchor= document.createElement('a');
anchor.href="javascript:closeNav()"; //void(0)"; //anchor[0].onclick = closeNav();
anchor.className = "closebtn";  
anchor.innerHTML="&times;";
document.getElementById("TOC").prepend(anchor);

let navCrumbs= document.createElement('div');
navCrumbs.className = "hover-nav";
navCrumbs.innerHTML = `
<div class="hover-nav">
<ul>
<li><a href="../../../../index.html">⇦ home</a></li>
<li><a href="../index.html">hello_world</a></li>
</ul>
</div>`;
document.getElementById("TOC").prepend(navCrumbs); 
</script>
</body>
</html>
